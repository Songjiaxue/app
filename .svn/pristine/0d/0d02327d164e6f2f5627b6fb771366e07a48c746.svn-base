;~function () {
    var app = function () {
        this.submitBtn = $('[data-selector="regi-btn"]');
        this.tel = $('[data-selector="tel"]');
        this.code = $('[data-selector="code"]');
        this.pwd = $('[data-selector="password"]');
        this.pwdAg = $('[data-selector="password-again"]');
    };
    app.prototype.init = function () {
        this.submit();
    };
    app.prototype.submit = function () {
        var self = this;
        self.submitBtn.on('tap' , function () {
            var code = self.code.val(),
                pwd = self.pwd.val(),
                pwdag = self.pwdAg.val(),
                tel = self.tel.val();
            if( tel.length != 11 ) return $.api.toast('手机号不正确');
            if( pwd !== pwdag ) return $.api.toast('两次输入的密码不同');
            if(!code) return $.api.toast('验证码未填写');
            if(code.length != 6) return $.api.toast('验证码不正确');
            self.ajax({
                tel : tel,
                password : pwd,
                code : code
            });
        });
    };
    app.prototype.ajax = function (data) {
        $.ajax({
            url : 'member/login/reg',
            data : data
        }).then(function (err,ret) {
            if(!!err) return $.api.toast(err);
            localStorage.token = ret.data.token;
            $.api.sendEvent('login',{
                msg : ret.msg
            });
            setTimeout(function () {
                $.openWin({
                    name : 'root'
                });
            },500);
        });
    };
    $.userRegi = function () {
        return new app();
    }
}();
"use strict";!function(){var t=function(){this.host="http://api.mlb.kfw001.com",this.md5="kfw001_com"};t.prototype.sendEvent=function(t,e){return!!t&&(e=e?e:"",void api.sendEvent({name:t,extra:e}))},t.prototype.listenerEvent=function(t,e){return!!t&&(e="function"==typeof e?e:function(){},void api.addEventListener({name:t},function(t){e(t.value)}))},t.prototype.statusSize=function(){var t=0,e=api.systemType,i=api.systemVersion;if("ios"==e){var n=parseInt(i,10),a=api.fullScreen,o=api.iOS7StatusBarAppearance;n>=7&&!a&&o&&(t=20)}return"android"==e&&(i=parseFloat(i),i>=4.4)?t=20:t},t.prototype.switchPageIndex=function(t,e,i){return!!t&&(e="number"==typeof e?e:0,void api.setFrameGroupIndex({name:t,index:e,scroll:i||!1}))},t.prototype.hidePageGroup=function(t){return!!t&&void api.setFrameGroupAttr({name:t,hidden:!0})},t.prototype.toast=function(t,e,i){return!!t&&void api.toast({msg:t,duration:e||2e3,location:i||"bottom"})},t.prototype.closeWin=function(t,e,i){return t?void api.closeWin({name:t}):api.closeWin()},t.prototype.scrolltobottom=function(t,e){return t=t||!0,e="function"==typeof e?e:function(){},t?void api.addEventListener({name:"scrolltobottom",extra:{threshold:30}},function(t,i){e(t,i)}):api.removeEventListener({name:"scrolltobottom"})},t.prototype.getPicture=function(t,e){api.getPicture({sourceType:t||"type",encodingType:"jpg",mediaValue:"pic",destinationType:"url",allowEdit:!0,quality:50,targetWidth:100,saveToPhotoAlbum:!1},function(t,i){e(t)})},$.api=new t}($||($={})),function(){var t=function(){};return t.prototype.swipe=function(){var t=new Swipe($(".js-slider")[0],{startSlide:0,speed:400,auto:3e3,continuous:!0,disableScroll:!1,stopPropagation:!1,callback:function(t,e){var i=$(e).siblings().length+1;t||(t=i),$(".js-banner-bar").width(t*(100/i)+"%")}});return t},t.prototype.call=function(t){return"undefined"!=typeof t.tel&&t.tel?void $.confirm("是否拨打电话？","确定致电： "+t.tel+" ?",function(e){return!!e&&void api.call({type:"tel",number:t.tel})}):$.api.toast("您拨打的电话是空号")},t.prototype.closeWin=function(){$.api.closeWin()},t.prototype.openShareAction=function(){var t=$.shareAction();t.init().open(function(t,e,i){if(t)return!1;var n=$.qq();switch(n.init(),e){case 2:n.shareUrlToQFriend({},function(){$.api.toast("分享成功")});break;case 3:n.shareUrlToQZone({},function(){$.api.toast("分享成功")});break;default:$.api.toast("尚未完善，请期待下一个版本~~~")}})},t.prototype.openPhotoBrowser=function(t){var e=api.require("photoBrowser");e.open({images:t.images,placeholderImg:"widget://images/cover.jpg",bgColor:"#000"},function(i,n){if(t.images.length<=i.index+1)return $.api.toast("1秒后自动关闭"),setTimeout(function(){e.close()},1e3),!1})},t.prototype.oval=function(){$('[data-selector="widget"]').show()},t.prototype["switch"]=function(t,e,i){var n=this;switch(t){case"call":n.call(e);break;case"bbsSwitchGroup":$.homeBbs().sendEvent(e||0);break;case"openNewWin":$.openWin(e);break;case"closeWin":n.closeWin(e);break;case"openShareAction":n.openShareAction(e);break;case"qqLogin":$.userLogin().qqLogin();break;case"sendSMSCode":$.userCommon().sendSMSCode(t,e,i);break;case"openPhotoBrowser":n.openPhotoBrowser(e);break;case"deleteOrder":$.coinOrder()["delete"](e);break;default:$.api.toast(t+"这个事件没有被定义")}},$.app=new t}($||($={})),function(){$.init=function(){$.main()}}(),function(){var t=function(){this.$container=$(".js-container"),this.$container.on("tap","[data-event]",function(){var t=$(this),e=t.data("event"),i=t.data("params")||!1;$.app["switch"](e,i,t)})};t.prototype.success=function(){var t=$[i]();t.init()},t.prototype.error=function(){$.api.toast("入口函数$."+i+"不存在")};var e=new t,i=$("body").data("main");return $.main=function(){return"function"==typeof $[i]?e.success():e.error()}}(),function(){var t=function(){this.id=api.pageParam.id,this.$radio=$('input[type="radio"]'),this.$info=$('[data-selector="info"]'),this.$pay=$('[data-selector="pay"]'),this.pay_type=1,this.aliPay=api.require("aliPay")};return t.prototype.init=function(){this.main()},t.prototype.main=function(){var t=this;async.waterfall([function(e){t.ajax(e)},function(e,i){t.appendHtml(e,i)},function(e,i){t.event(i)}],function(t,e){if($.echo(),t)return $.api.toast(t)})},t.prototype.ajax=function(t){var e=this;$.ajax({url:"mall/order/confirm",data:{order_id:e.id}}).then(t)},t.prototype.appendHtml=function(t,e){var i=this;e(null,i.$info.html(i.html(t.data)))},t.prototype.html=function(t){var e="";return"object"!=typeof t?e:(e+='<div class="head" data-echo-background="',e+=t.logo,e+='"></div><div class="info"><div class="info-in"><div class="money">应付款：<span>¥',e+=t.offer_money||"出现错误",e+='</span></div><div class="code">订单编号：',e+=t.order_sn||"00000000000000000000",e+="</div></div> </div>")},t.prototype.event=function(t){var e=this;e.$radio.on("change",function(){var t=$(this);e.pay_type=t.val(),$(".radio").removeClass("active"),t.parent().addClass("active")}),e.$pay.on("tap",function(){e._pay()}),t()},t.prototype._pay=function(){var t=this;async.waterfall([function(e){t.ajax_pay(e)},function(e,i){switch(t.pay_type){case 1:t.aliPayOrder(e,i);break;default:i("暂未实现")}}],function(t,e){return t?$.api.toast(t):void alert(JSON.stringify(e))})},t.prototype.ajax_pay=function(t){var e=this;$.ajax({url:"mall/pay/start",data:{order_id:e.id,pay_type:e.pay_type}}).then(t)},t.prototype.aliPayOrder=function(t,e){var i=this;i.aliPay.payOrder({orderInfo:t.data},function(t,i){e(i,t)})},$.pay=function(){return new t}}(),~function(){var t=function(){this.nav=$(".nav-item"),this.navGroup=$('[data-selector="nav"]'),this.title=$('[data-selector="title"]'),this._up_nav=$('[data-selector="up-nav-group"]'),this.my_up_nav=$('[data-selector="my-up-nav-group"]'),this.columnApi="bbs/Article/column",this.bbsPageGroup,this.officialContext=$('[data-selector="official-context"]'),this.page=1,this.size=10,this.load=$("._load"),this.loading=$("._loading"),this._undefined=$("._undefined"),this.detailsContext=$('[data-selector="details-context"]'),this.assessContext=$('[data-selector="assess-context"]'),this.emtionsBtn=$('[data-selector="emotions-btn"]'),this.emtionsTarget=$('[data-selector="emtions-target"]'),this.closeEdit=$('[data-selector="close-edit"]'),this.sendEdit=$('[data-selector="send-edit"]'),this.detailsEdit=$('[data-selector="details-edit"]'),this.openEditBox=$('[data-selector="open-edit-box"]'),this.emtions()};return t.prototype.init=function(){var t=this;async.waterfall([function(e){t.getArticleDetails(e)},function(e,i){t.htmlBbsDetails(e,i)}],function(e,i){return $.echo(),t.loading.hide(),e?t.notFind():void t.assessMain()})},t.prototype.getArticleDetails=function(t){var e=api.pageParam.id;return t=$.callback(t),"undefined"==typeof e?t("id不存在"):void $.ajax({url:"sit"==api.pageParam.type?"bbs/topic/detail":"bbs/article/detail",data:"sit"==api.pageParam.type?{topic_id:e}:{article_id:e}}).then(t)},t.prototype.returnArticleHtml=function(t){var e="";return t=t.data,"sit"==api.pageParam.type?(e+='<div class="details-title"><div class="head" data-echo-background="',e+=t.avatar||"../../images/img.png",e+='"></div><div class="nickname">',e+=t.nick||"佚名",e+="</div></div>","undefined"!=typeof t.cover&&(e+='<div class="details-img"><div class="img-group"><div class="img-item" data-echo-background="',e+=t.cover,e+='"></div></div>',"undefined"!=typeof t.thumbs&&t.thumbs.length&&(e+='<div class="img-more" data-event="openPhotoBrowser" data-params=\'{"images":[',t.thumbs.forEach(function(t){e+='"',e+=t.path,e+='",'}),e+='"'+t.cover+'"',e+=']}\'><i class="icon-picture"></i><span>点击查看所有图片</span></div></div>')),e+='<div class="details-desc">',e+=t.content,e+='</div><div class="details-tools"><div class="details-tools-in"><div class="details-tools-left"><div class="details-tools-time">',e+=t.ago||"冰河世纪",e+='</div><div class="details-tools-report">举报</div></div><div class="details-tools-right"><div class="details-tools-love"><span>(',e+=t.good||0,e+=')</span></div><div class="details-tools-share"><i class="icon-love"></i></div></div></div></div>'):(e+='<div class="details-title"><div class="nickname">',e+=t.title,e+='</div></div><div class="details-author"><div class="time">',e+="作者:",e+='</div><div class="name">',e+=t.writer||"佚名",e+='</div></div><div class="details-img pr">',e+=t.content,e+='</div><div class="details-tools"><div class="details-tools-in"><div class="details-tools-left"><div class="details-tools-time">',e+=t.ago,e+='</div><div class="details-tools-report">举报</div></div><div class="details-tools-right"><div class="details-tools-love"><span>(',e+=t.good,e+=')</span></div><div class="details-tools-share"><i class="icon-love"></i></div></div></div></div>'),e},t.prototype.htmlBbsDetails=function(t,e){var i=this;i.detailsContext.html(i.returnArticleHtml(t)),e(null,t)},t.prototype.assessMain=function(){var t=this;$.api.scrolltobottom(!1),async.waterfall([function(e){t.getAssessData(e)},function(e,i){return t.page-1?void t.appendAssess(e,i):t.htmlAssess(e,i)}],function(e,i){return $.echo(),i.data.info.length<t.size?t.appendNotFind():void $.api.scrolltobottom(!0,function(){t.page+=1,t.assessMain()})})},t.prototype.getAssessData=function(t){var e=this,i=api.pageParam.id;t=$.callback(t),$.ajax({url:"sit"==api.pageParam.type?"bbs/topic/comment":"bbs/article/comment",data:"sit"==api.pageParam.type?{topic_id:i,page:e.page||1}:{article_id:i,page:e.page||1},cache:!1}).then(t)},t.prototype.htmlAssess=function(t,e){var i=this;i.assessContext.html(i.assessItemHtml(t)),e(null,t)},t.prototype.appendAssess=function(t,e){var i=this;i.assessContext.append(i.assessItemHtml(t)),e(null,t)},t.prototype.assessItemHtml=function(t){var e=this,i="";return t=t.data.info,t.forEach(function(t,e){i+='<div class="details-assess-item"><div class="assess-title"><div class="head" data-echo-background="',i+=t.avatar||"../../images/img.png",i+='"></div><div class="nickname">',i+=t.nick,i+='</div><div class="report">投诉</div></div><div class="assess-desc">',i+=t.content?AnalyticEmotion(t.content):t.content,i+='</div><div class="assess-time">',i+=t.ago||"冰河世纪",i+="</div></div>"}),"undefined"!=typeof t&&t.length||(i='<div class="details-assess-no"></div>',e.load.remove()),i},t.prototype.appendNotFind=function(t){return t?void this.load.html('<i class="icon-spin3 animate-spin"></i>'):this.load.html("后面没有了")},t.prototype.notFind=function(){this._undefined.show()},t.prototype.emtions=function(){var t=this;t.emtionsBtn.SinaEmotion(t.emtionsTarget),t.openEditBox.on("tap",function(){alert("openEditBox"),t.edittarget()}),t.closeEdit.on("tap",function(){t.edittarget()}),t.sendEdit.on("tap",function(){t.sendTalk()})},t.prototype.edittarget=function(){var t=this;return t.detailsEdit.hasClass("show")?void t.detailsEdit.removeClass("show"):t.detailsEdit.addClass("show")},t.prototype.sendTalk=function(){var t=this,e=t.emtionsTarget.val(),i=api.pageParam.id;return e?void $.ajax({url:"sit"==api.pageParam.type?"bbs/topic/talk":"bbs/article/talk",data:"sit"==api.pageParam.type?{topic_id:i,content:e}:{article_id:i,content:e},success:function(e){alert(e.msg),t.edittarget()},error:function(t){$.api.toast(t)}}):$.alert("您没有输入任何内容")},$.bbsDetails=function(){return new t}}(),~function(){var t=function(){};return t.prototype.init=function(){},$.bbsEdit=function(){return new t}}(),~function(){var t=function(){this.pullRefresh=$.pullRefresh(),this.nav=$(".nav-item"),this.navGroup=$('[data-selector="nav"]'),this.title=$('[data-selector="title"]'),this._up_nav=$('[data-selector="up-nav-group"]'),this.my_up_nav=$('[data-selector="my-up-nav-group"]'),this.columnApi="bbs/Article/column",this.bbsPageGroup,this.officialContext=$('[data-selector="official-context"]'),this.page=1,this.size=10,this.load=$("._load"),this.loading=$("._loading"),this._undefined=$("._undefined"),this.detailsContext=$('[data-selector="details-context"]'),this.assessContext=$('[data-selector="assess-context"]')};t.prototype.init=function(){var t=this;t.refresh(),t.officialMain()},t.prototype.refresh=function(){var t=this;t.pullRefresh.set(function(){t.page=1,t.appendNotFind(!0),async.waterfall([function(e){t.officialMain(e)}],function(){$.api.toast("刷新成功"),setTimeout(function(){api.refreshHeaderLoadDone()},500)})})},t.prototype.officialMain=function(t){var e=this;t="function"==typeof t?t:function(){},e.scrolltobottom(!1),async.waterfall([function(t){e.getLists(t)},function(t,i){return e.page-1?void e.appendOfficial(t,i):e.htmlOfficial(t,i)}],function(i,n){return $.echo(),t(),e.loading.hide(),i&&$.api.toast("error:"+i),"undefined"!=typeof n.data.info&&n.data.info.length?n.data.info.length<e.size?e.appendNotFind():(e.page+=1,void e.scrolltobottom(!0)):e.notFind()})},t.prototype.getLists=function(t){var e=this;$.ajax({url:"bbs/article/list",data:{page:e.page,column_id:api.pageParam.id||0,size:e.size||10}}).then(t)},t.prototype.bbsOfficialListsHtml=function(t){t=t.data.info||[];var e=this,i="";return t.forEach(function(t,n){i+='<div class="lists-item ',e.page-1&&(i+="animated fadeIn"),i+='" data-event="openNewWin" data-params=\'{"name":"',i+=t.is_link?"win_url":"win_bbs_details",i+='","param":{"url":"',i+=t.link,i+='","id":"',i+=t.id,i+='","type":"official"}}\'><div class="lists-head"><div class="head" data-echo-background="',i+=t.head||"../../images/img.png",i+='"></div><div class="nickname">',i+=t.writer,i+='</div></div><div class="lists-img" data-echo-background="',i+=t.thumb,i+='"></div><div class="lists-desc">',i+=t.description,i+='</div><div class="lists-tools"><div class="tools-group"><div class="tools-item">',i+=t.ago||"冰河世纪",i+='</div></div><div class="tools-group"><div class="tools-item"><div class="icon icon-share"></div></div><div class="tools-item ml15"><div class="icon icon-love "></div>',i+='<div class="pink">（',i+=t.good||"0",i+='）</div></div></div></div><div class="lists-review">',i+='<div class="review-warp"><div class="review-icon icon-mes"></div><div class="review-context">',t.comment=t.comment||[],t.comment.forEach(function(t){i+='<div class="review-item">',i+=t.nick+" : "+t.content,i+="</div> "}),i+='<div class="review-item">查看全部评论（',i+=t.comment_count||"0",i+="）</div></div></div></div></div>"}),i},t.prototype.appendOfficial=function(t,e){var i=this;i.officialContext.append(i.bbsOfficialListsHtml(t)),e(null,t)},t.prototype.htmlOfficial=function(t,e){var i=this;i.officialContext.html(i.bbsOfficialListsHtml(t)),e(null,t)},t.prototype.appendNotFind=function(t){return t?void this.load.html('<i class="icon-spin3 animate-spin"></i>'):this.load.html("后面没有了")},t.prototype.notFind=function(){this._undefined.show()},t.prototype.scrolltobottom=function(t){var e=this;return t?void api.addEventListener({name:"scrolltobottom",extra:{threshold:30}},function(t,i){e.officialMain()}):api.removeEventListener({name:"scrolltobottom"})},$.bbsOfficial=function(){return new t}}(),~function(){var t=function(){this.nav=$(".nav-item"),this.navGroup=$('[data-selector="nav"]'),this.title=$('[data-selector="title"]'),this._up_nav=$('[data-selector="up-nav-group"]'),this.my_up_nav=$('[data-selector="my-up-nav-group"]'),this.columnApi="bbs/Article/column",this.bbsPageGroup,this.officialContext=$('[data-selector="official-context"]'),this.page=1,this.size=10,this.load=$("._load"),this.loading=$("._loading"),this._undefined=$("._undefined"),this.detailsContext=$('[data-selector="details-context"]'),this.assessContext=$('[data-selector="assess-context"]')};t.prototype.init=function(){var t=this;return t.sitMainReFresh(),api.pageParam.id?(t.loading.hide(),void t._undefined.show()):t.sitMainAll()},t.prototype.sitMainReFresh=function(){var t=this;api.setCustomRefreshHeaderInfo({bgColor:"#f2f2f2",image:{pull:"widget://res/pull/pull.png",transform:["widget://res/pull/pull.png","widget://res/pull/pull2.png"],load:["widget://res/pull/pull.png","widget://res/pull/pull2.png"]}},function(){t.page=1,async.waterfall([function(e){t.sitMainAll(e)}],function(){return api.pageParam.id?($.api.toast("请登陆后再试"),void setTimeout(function(){api.refreshHeaderLoadDone()},500)):($.api.toast("刷新成功"),setTimeout(function(){api.refreshHeaderLoadDone()},500),t.sitMainAll())})})},t.prototype.sitMainAll=function(t){var e=this;t="function"==typeof t?t:function(){},async.waterfall([function(t){e.getSitLists(t)},function(t,i){e.htmlMainLists(t,i)}],function(i,n){return t(),e.loading.hide(),$.echo(),i&&$.api.toast("error:"+i),"undefined"!=typeof n.data.info&&n.data.info.length?void(n.data.info.length<e.size&&e.appendNotFind()):e.notFind()})},t.prototype.getSitLists=function(t){$.ajax({url:"bbs/topic/list"}).then(t)},t.prototype.sitMainHtml=function(t){var e="";return t=t.data.info||[],t.forEach(function(t,i){e+='<div class="list-item"',e+=' data-event="openNewWin" data-params=\'{"name":"win_bbs_details","param":{"id":"',e+=t.id,e+='","type":"sit"}}\'><div class="list-item-head"><div class="head-left" data-echo-background="',e+=t.avatar,e+='"></div><div class="head-right">',e+=t.nick,e+='</div></div><div class="list-item-content"><div class="content-top">',e+=t.content,e+="</div>",t.cover&&(e+='<div class="content-center" data-echo-background="',e+=t.cover,e+='"></div>'),e+='<div class="content-bottom"><div class="content-bottom-left">',e+=t.ago,e+='</div><div class="content-bottom-right"><div class="right-item"><div class="icon icon-love"></div><div class="text">赞</div></div><div class="right-item">',e+='<div class="icon icon-talk"></div><div class="text">评论</div></div></div></div></div></div>'}),e},t.prototype.htmlMainLists=function(t,e){var i=this;i.officialContext.html(i.sitMainHtml(t)),e(null,t)},t.prototype.appendNotFind=function(t){return t?void this.load.html('<i class="icon-spin3 animate-spin"></i>'):this.load.html("后面没有了")},t.prototype.notFind=function(){this._undefined.show()},$.bbsOther=function(){return new t}}(),~function(){var t=function(){this.nav=$(".nav-item"),this.navGroup=$('[data-selector="nav"]'),this.title=$('[data-selector="title"]'),this._up_nav=$('[data-selector="up-nav-group"]'),this.my_up_nav=$('[data-selector="my-up-nav-group"]'),this.columnApi="bbs/Article/column",this.bbsPageGroup,this.officialContext=$('[data-selector="official-context"]'),this.page=1,this.size=10,this.load=$("._load"),this.loading=$("._loading"),this._undefined=$("._undefined"),this.detailsContext=$('[data-selector="details-context"]'),this.assessContext=$('[data-selector="assess-context"]')};t.prototype.init=function(){var t=this;async.waterfall([function(e){t.getColumn(e)},function(e,i){t.resetBbsPageGroup(e,i)},function(e,i){t.appendColumn(e,i)}],function(e,i){t.switchNav(),t.resetNav()})},t.prototype.getColumn=function(t){var e=this;t="function"==typeof t?t:function(){},$.ajax({url:e.columnApi}).then(t)},t.prototype.columnHtml=function(t){var e="";return t.forEach(function(t,i){e+=0==i?'<div class="nav-item active" data-event="bbsSwitchGroup" data-params="':'<div class="nav-item" data-event="bbsSwitchGroup" data-params="',e+=i,e+='">',e+=t.name,e+="</div>"}),e},t.prototype.appendColumn=function(t,e){var i=this;i._up_nav.html(i.columnHtml(t)),e(null)},t.prototype.resetBbsPageGroup=function(t,e){var i=this;t="undefined"!=typeof t.data.info?t.data.info:[],i.bbsPageGroup=[],t.forEach(function(t,e){i.bbsPageGroup.push({name:"bbs-"+e,url:"widget://html/bbs/bbs-official.html",bgColor:"#f2f2f2",vScrollBarEnabled:!1,hScrollBarEnabled:!1,customRefreshHeader:"UIPullRefresh",bounces:!0,pageParam:{id:t.id}})});for(var n=0;n<4;n++)i.bbsPageGroup.push({name:"bbs-"+(t.length+n),url:"widget://html/bbs/bbs-other.html",customRefreshHeader:"UIPullRefresh",bounces:!0,bgColor:"#f2f2f2",vScrollBarEnabled:!1,hScrollBarEnabled:!1,pageParam:{id:n}});$.api.sendEvent("changeBbsPageGroup",{pageGroup:i.bbsPageGroup}),e(null,t)},t.prototype.resetNav=function(){var t=this;t.title.eq(1).data("params",t.bbsPageGroup.length-4);for(var e=t.my_up_nav.find(".nav-item"),i=0;i<e.length;i++)e.eq(i).data("params",t.bbsPageGroup.length-4+i);t.nav=$(".nav-item")},t.prototype.switchNav=function(){var t=this;$.api.listenerEvent("bbsSwitchNav",function(e){t.switchNavItem(e.index)})},t.prototype.switchNavItem=function(t){var e=this,i=e.navGroup.eq(0).find(".nav-item").length;e.nav.removeClass("active").eq(t).addClass("active"),e.navGroup.removeClass("show"),e.title.removeClass("active"),t=Math.floor(t/i),e.navGroup.eq(t).addClass("show"),e.title.eq(t).addClass("active")},t.prototype.sendEvent=function(t){$.api.sendEvent("bbsSwitchGroup",{index:t})},$.homeBbs=function(){return new t}}(),~function(){var t=function(){this.shop_id=api.pageParam.shop_id||"undefined",this.id=api.pageParam.id||"undefined",this.type=1,this.number=1,this.defaultAddressHtml="",this.$address=$('[data-selector="address"]'),this.$beauty=$('[data-selector="beauty"]'),this.$changeNumber=$('[data-selector="change-number"]'),this.$number=$('[data-selector="number"]'),this.$price=$('[data-selector="all-price"]'),this.$submit=$('[data-selector="submit"]')};return t.prototype.init=function(){this.main()},t.prototype.main=function(){var t=this;async.waterfall([function(e){t.ajax(e)},function(e,i){t.setHtml(e,i)},function(e,i){t._event(e,i)}],function(t,e){if($.echo(),t)return $.api.toast(t)})},t.prototype.setHtml=function(t,e){var i=this,n=t.data;i.$address.html(i._defaultAddressHtml(n)),i.$beauty.html(i._storeInfoHtml(n)),e(null,t)},t.prototype._defaultAddressHtml=function(t){var e=this,i="";return"undefined"==typeof t.shop?"":(t=t.shop,i+='<div class="beauty-address"><div class="info"><div class="nick">',i+=t.name,i+='</div><div class="tel">',i+=t.phone,i+='</div></div><div class="address-info">',i+=t.address,i+="</div></div>",i+='<div class="icon gt icon-gt"></div>',e.defaultAddressHtml=i,i)},t.prototype._storeInfoHtml=function(t){var e="";return"undefined"==typeof t.shop?e:(e+='<div class="title icon-gt"><div class="head" data-echo-background="',e+=t.shop.logo,e+='"></div> <p>',e+=t.shop.name,e+="</p></div>","undefined"==typeof t.goods?e:(t.goods.forEach(function(t){e+='<div class="context"><div class="head" data-echo-background="',e+=t.thumb,e+='"></div><div class="info"><div class="info-title">',e+=t.title,e+='</div><div class="info-desc">无描述</div><div class="info-price">¥',e+=t.offer_money,e+="</div></div></div>"}),e))},t.prototype._event=function(t,e){var i=this;e=$.callback(e);var n=parseInt(t.data.goods[0].max_buy),a=parseInt(t.data.goods[0].offer_money);i.$price.html("¥"+i.number*a),i.$changeNumber.on("tap",function(){var t=$(this).data("params");"less"==t&&i.number>0&&(i.number-=1),"add"==t&&i.number<n&&(i.number+=1),i.$number.val(i.number),i.$price.html("¥"+i.number*a)}),i.$number.on("change",function(){var t=$(this);t.val()>n&&(i.number=n),t.val(i.number),i.$price.html("¥"+i.number*a)}),i.$submit.on("tap",function(){async.waterfall([function(t){i.order_ajax(t)}],function(t,e){return t?$.api.toast(t):void $.app["switch"]("openNewWin",{name:"win_pay",param:{id:"undefined"==typeof e.data?"undefined":e.data}})})}),e()},t.prototype.ajax=function(t){var e=this;$.ajax({url:"mall/order/cart",data:{shop_id:e.shop_id,type:e.type,goods:'{"'+e.id+'":"'+e.number+'"}'}}).then(t)},t.prototype.order_ajax=function(t){var e=this;$.ajax({url:"mall/order/make",data:{shop_id:e.shop_id,type:1,goods:'{"'+e.id+'":"'+e.number+'"}'}}).then(t)},$.beautyCreateOrder=function(){return new t}}(),~function(){var t=function(){this.id=api.pageParam.id,this.shop_id=api.pageParam.shop_id||"undefined",this.wrap=$(".main.index")};return t.prototype.init=function(){var t=this;t.main()},t.prototype.main=function(){var t=this;async.waterfall([function(e){t.ajax(e)},function(e,i){t.setHtml(e,i)}],function(e,i){t.swipe()})},t.prototype.swipe=function(){$.app.swipe()},t.prototype.setHtml=function(t,e){var i=this,n="";n+=i._swipeHtml(t),n+=i._titleHtml(t),n+=i._tagHtml(t),n+=i._inforHtml(t),n+=i._assessHtml(t),n+=i._footerHtml(t),e(null,i.wrap.append(n))},t.prototype._swipeHtml=function(t){var e="",i=t.data;return"undefined"!=typeof i.thumb_url&&i.thumb_url.length?(e+='<div class="banner"><div class="banner-warp js-slider swipe"><div class="banner-group swipe-wrap">',i.thumb_url.forEach(function(t){e+='<div class="banner-item" style="background-image: url(\'',e+=t.path||0,e+="')\"></div>"}),e+="</div></div></div>"):'<div class="banner"><div class="banner-warp js-slider swipe"><div class="banner-group swipe-wrap"><div class="banner-item" style="background-image: url(\'../../images/info-banner.jpg\')"></div></div> </div> </div>'},t.prototype._titleHtml=function(t){var e=t.data,i="";return i+='<div class="details-title"><div class="price fl">¥ ',i+=e.offer_money||"",i+='</div><div class="price old fl">¥ ',i+=e.original_price||"",i+='</div><div class="price over fl">已售',i+=e.sales||0,i+="件</div></div>",i+='<div class="cargo-title">',i+=e.title||"",i+="</div>"},t.prototype._tagHtml=function(t){var e=t.data,i="";return i+='<div class="ui-tool-wrap"><div class="ui-tool"><div class="ui-tool-in clamp">美乐吧承诺：一旦发现商家宰客、欺客，经查明属实，将直接返现金2000元</div></div></div>',e.is_new||e.is_hot?(i+='<div class="ui-tool-wrap"><div class="ui-tool icon-gt border"><div class="ui-tool-in">',i+='<div class="ui-tool-group">',i+=e.is_new?'<div class="ui-tool-item"><div class="ui-tool-icon">新</div><div class="ui-tool-desc">新品推荐 </div></div>':"",i+=e.is_hot?'<div class="ui-tool-item"><div class="ui-tool-icon">热</div><div class="ui-tool-desc">热卖产品</div></div>':"",i+="</div></div></div></div>"):i},t.prototype._inforHtml=function(t){var e=t.data,i="";return"undefined"==typeof e.content?i:(i+='<div class="ui-tool-wrap"><div class="ui-tool icon-gt border"><div class="ui-tool-in"><div class="ui-tool-group">',i+='<div class="ui-tool-item"><div class="ui-tool-desc">详情</div></div></div></div></div>',i+='<div class="ui-tool-infor"><div class="ui-tool-infor-in">',i+=e.content||"",i+="</div></div></div>")},t.prototype._assessHtml=function(t){var e=t.data,i="";return"undefined"==e.comment?i:(i+='<div class="ui-tool-wrap" data-event="openNewWin" data-params=\'{"name":"win_coin_assess","param":{"id":"',i+=e.id,i+='"}}\'><div class="ui-tool icon-gt border"><div class="ui-tool-in"><div class="ui-tool-group">',i+='<div class="ui-tool-item"><div class="ui-tool-desc">宝贝评价（',i+=e.comment.length||0,i+="）</div></div></div></div></div>",e.comment.length?(i+='<div class="main assess"><div class="lists"><div class="lists-group">',e.comment.forEach(function(t){i+='<div class="lists-item"><div class="title"><div class="head" data-echo-background="',i+=t.avatar,i+='"></div><div class="nickname">',i+=t.nick||"佚名",i+='</div></div><div class="desc">',i+=t.content,i+="</div>",i+='<div class="end">',i+=t.ago,i+="</div></div>"}),i+="</div></div></div>",i+="</div>"):i+="</div>")},t.prototype._footerHtml=function(t){var e=this,i=t.data,n="";return n+='<div class="footer"><div class="footer-group"><div class="footer-item" data-event="',n+=e.shop_id!==i.shop_id?"closeWin":"openNewWin",n+='" data-params=\'{"name":"win_beauty_home","param":{"id","',n+=i.shop_id,n+='"}}\'><div class="icon icon-cargo-home"></div><p>店铺</p></div>',n+='<div class="footer-item"><div class="icon icon-cargo-share"></div><p>分享</p></div>',n+='<div class="footer-item" data-event="call" data-params=\'{"tel","+8613082807225"}\'><div class="icon icon-coin-tel"></div><p>联系</p></div>',n+='<div class="footer-item" data-event="openNewWin" data-params=\'{"name":"',n+=1==i.type?"win_beauty_create_order":3==i.type?"win_item_create_order":"win_coin_create_order",n+='","param":{"id":"',n+=i.id,n+='","shop_id":"',n+=i.shop_id,n+="\"}}'>立即购买</div></div></div>"},t.prototype.ajax=function(t){var e=this;t=$.callback(t),$.ajax({url:"mall/goods/detail",data:{goods_id:e.id},cache:!1}).then(t)},$.beautyDetails=function(){return new t}}(),~function(){var t=function(){this.id=api.pageParam.id,this.$shopAds=$('[data-selector="shop-ads"]'),this.$item=$('[data-selector="item"]'),this.$goods=$('[data-selector="goods"]')};return t.prototype.init=function(){var t=this;t.ads(),t.mian()},t.prototype.mian=function(){var t=this;t._item(),t._goods()},t.prototype._item=function(){var t=this;async.waterfall([function(e){t.append_item(api.pageParam.item,e)}],function(e){return e?(t.$item.remove(),void t.$item.next('[class*="-title"]').remove()):$.echo()})},t.prototype.html=function(t){var e=this,i="";return t.forEach(function(t,n){return!(n>1)&&(i+='<div class="exhibit-item" data-event="openNewWin" data-params=\'{"name":"win_beauty_details","param":{"id":"',i+=t.id,i+='","shop_id":"',i+=e.id,i+='"}}\'><div class="img" data-echo-background="',i+=t.thumb,void(i+='"></div></div>'))}),i},t.prototype.append_item=function(t,e){var i=this;return e=$.callback(e),"undefined"!=typeof t&&t.length?(i.$item.html(i.html(t)),void e()):e("数据不存在")},t.prototype._goods=function(){var t=this;async.waterfall([function(e){t.append_goods(api.pageParam.goods,e)}],function(e,i){return e?(t.$item.remove(),void t.$item.next('[class*="-title"]').remove()):$.echo()})},t.prototype.append_goods=function(t,e){var i=this;return e=$.callback(e),"undefined"!=typeof t&&t.length?(i.$goods.html(i.html(t)),void e()):e("数据不存在")},t.prototype.ads=function(){var t=this;async.waterfall([function(e){t.ajax_shop_ads(e)},function(e,i){t.changeShopAds(e,i)}],function(e,i){return e?t.$shopAds.remove():void $.echo()})},t.prototype.ajax_shop_ads=function(t){var e=this;t=$.callback(t),$.ajax({url:"ads/index/shop",data:{id:e.is}}).then(t)},t.prototype.changeShopAds=function(t,e){var i=this;return e=$.callback(e),"undefined"!=typeof t.data&&"undefined"!=typeof t.data.info&&t.data.info.length?(i.$shopAds.attr("data-echo-background",t.data.info[0].thumb),void e()):e("数据不存在")},$.beautyHomeIndex=function(){return new t}}(),~function(){var t=function(){this.id=api.pageParam.id,this.$thumb=$('[data-selector="thumb"]'),this.$nav=$('[data-selector="nav-item"]'),this.$title=$('[data-selector="title"]')};return t.prototype.init=function(){var t=this;t.main()},t.prototype.ajax=function(t){var e=this;t=$.callback(t),$.ajax({url:"mall/shop/index",data:{shop_id:e.id}}).then(t)},t.prototype.main=function(){var t=this;async.waterfall([function(e){t.ajax(e)},function(e,i){t.one(e,i)}],function(e){if($.echo(),t.switchPage(),e)return $.api.toast(e)})},t.prototype.one=function(t,e){var i=this;e=$.callback(e),i.$thumb.attr("data-echo-background",t.data.info.thumbs[0].path),i.$title.text(t.data.info.name||"..."),i.openPageGroup(t),e()},t.prototype.openPageGroup=function(t){var e=this;t=$.extend({},t.data,api.pageParam),api.openFrameGroup({name:"beauty-home-group",background:"#ededed",scrollEnabled:!0,rect:{x:0,y:183+$.api.statusSize(),w:"auto",h:"auto"},index:0,frames:[{name:"beauty-home-index",url:"widget://html/beauty/beauty-home-index.html",bgColor:"#ededed",pageParam:t},{name:"beauty-home-service",url:"widget://html/beauty/beauty-home-service.html",bgColor:"#ededed",pageParam:t},{name:"beauty-home-benefit",url:"widget://html/beauty/beauty-home-benefit.html",bgColor:"#ededed",pageParam:t},{name:"beauty-home-business",url:"widget://html/beauty/beauty-home-business.html",bgColor:"#ededed",pageParam:t}]},function(t,i){e.$nav.removeClass("active").eq(t.index).addClass("active")})},t.prototype.switchPage=function(){var t=this;t.$nav.on("tap",function(){var t=$(this).index();$.api.switchPageIndex("beauty-home-group",t,!0)})},$.beautyHome=function(){return new t}}(),~function(){var t=function(){this.size=10,this.page=1,this.zone_id="",this.$loadMore=$("._load-more"),this.pullRefresh=$.pullRefresh(),this.homeIndex=$.homeIndex(),this.scroll=$.scroll()};return t.prototype.init=function(){this.main(),this.refresh()},t.prototype.main=function(){var t=this;t.page=1,t.one()},t.prototype.refresh=function(){var t=this;t.pullRefresh.set(function(){t.main()})},t.prototype.one=function(){var t=this;t.pullRefresh.close(),t.scroll.removeListenerToBottom(),async.waterfall([function(e){t.ajax(e)},function(e,i){t.homeIndex.beauty_html(e,i)},function(e,i){t.iScroll(e,i)}],function(e,i){return $.echo(),e?$.api.toast(e):void(t.page+=1)})},t.prototype.iScroll=function(t,e){var i=this;return e=$.callback(e),!t.data.info.length||t.data.info.length<i.size?(i.$loadMore.text("后面没有了"),e()):(i.$loadMore.text("努力加载中"),
i.scroll.addListenerToBottom(function(){i.one()}),void e())},t.prototype.ajax=function(t){var e=this,i=JSON.parse(localStorage.city);t=$.callback(t),$.ajax({url:"mall/shop/list",data:$.extend({},"object"==typeof i?{longitude:i.lon,latitude:i.lat,city_id:i.city.id}:{longitude:0,latitude:0,city_id:0},{page:e.page,size:e.size,zone_id:e.zone_id})}).then(t)},$.beautyIndex=function(){return new t}}(),~function(){var t=function(){};return t.prototype.init=function(){},$.homeBeauty=function(){return new t}}(),~function(){return $.config={pullRefresh:{},threshold:30}}(),~function(){var t=function(){this.id=api.pageParam.id,this.type=api.pageParam.type,this.page=1,this.size=10,this.pullRefresh=$.pullRefresh(),this.scroll=$.scroll(),this.$loadMore=$("._load-more"),this.$assess=$('[data-selector="details-assess"]')};return t.prototype.init=function(){this.main(),this.refresh()},t.prototype.main=function(){this.page=1,this.one()},t.prototype.refresh=function(){var t=this;t.pullRefresh.set(function(){t.main()})},t.prototype.one=function(){var t=this;t.scroll.removeListenerToBottom(),t.pullRefresh.close(),async.waterfall([function(e){t.ajax(e)},function(e,i){t.innerHtml(e,i)},function(e,i){t.iScroll(e,i)}],function(e){return $.echo(),e?$.api.toast(e):void(t.page+=1)})},t.prototype.iScroll=function(t,e){var i=this;return e=$.callback(e),!t.data.info.length||t.data.info.length<i.size?(i.$loadMore.text("后面没有了"),e()):(i.$loadMore.text("努力加载中"),i.scroll.addListenerToBottom(function(){i.one()}),void e())},t.prototype._itemHtml=function(t){var e="",i="undefined"!=typeof t.data.info&&t.data.info.length?t.data.info:[];return i.forEach(function(t){e+='<div class="lists-item"><div class="title"><div class="head" data-echo-background="',e+=t.avatar,e+='"></div><div class="nickname">',e+=t.nick,e+='</div></div><div class="desc">',e+=t.content,e+='</div><div class="end">',e+=t.ago,e+=" - 产品类型 : ",e+="积分商品",e+="</div></div>"}),e},t.prototype.innerHtml=function(t,e){var i=this;e=$.callback(e),1==i.page&&i.$assess.html(i._itemHtml(t)),1!=i.page&&i.$assess.append(i._itemHtml(t)),e(null,t)},t.prototype.ajax=function(t){var e=this;t=$.callback(t),$.ajax({url:"mall/point/comment",cache:!1,data:{goods_id:e.id,type:e.type,page:e.page,size:e.size}}).then(t)},$.coinAssessItem=function(){return new t}}(),~function(){var t=function(){this.id=api.pageParam.id,this.$item=$('[data-selector="nav-item"]')};return t.prototype.init=function(){var t=this;t.openFrameGroup(),t.event()},t.prototype.event=function(){var t=this;t.$item.on("tap",function(){var t=$(this).index();$.api.switchPageIndex("coin-assess-group",t,!0)})},t.prototype.changeItem=function(t){var e=this;e.$item.eq(t).addClass("active").siblings("").removeClass("active")},t.prototype.openFrameGroup=function(){var t=this;api.openFrameGroup({name:"coin-assess-group",background:"#f2f2f2",scrollEnabled:!0,rect:{x:0,y:90+$.api.statusSize(),w:"auto",h:"auto"},index:0,frames:[{name:"coin-assess-group-1",url:"widget://html/coin/coin-assess-item.html",bgColor:"#f2f2f2",customRefreshHeader:"UIPullRefresh",bounces:!0,vScrollBarEnabled:!1,hScrollBarEnabled:!1,pageParam:{type:0,id:t.id}},{name:"coin-assess-group-2",url:"widget://html/coin/coin-assess-item.html",bgColor:"#f2f2f2",customRefreshHeader:"UIPullRefresh",bounces:!0,vScrollBarEnabled:!1,hScrollBarEnabled:!1,pageParam:{type:1,id:t.id}},{name:"coin-assess-group-1",url:"widget://html/coin/coin-assess-item.html",bgColor:"#f2f2f2",customRefreshHeader:"UIPullRefresh",bounces:!0,vScrollBarEnabled:!1,hScrollBarEnabled:!1,pageParam:{type:2,id:t.id}},{name:"coin-assess-group-2",url:"widget://html/coin/coin-assess-item.html",bgColor:"#f2f2f2",customRefreshHeader:"UIPullRefresh",bounces:!0,vScrollBarEnabled:!1,hScrollBarEnabled:!1,pageParam:{type:3,id:t.id}}]},function(e,i){return!i&&void t.changeItem(e.index)})},$.coinAssess=function(){return new t}}(),~function(){var t=function(){};return t.prototype.init=function(){},$.coinChase=function(){return new t}}(),~function(){var t=function(){this.id=api.pageParam.id,this.$thumb=$('[data-selector="thumb-banner"]'),this.$info=$('[data-selector="details-info"]'),this.$title=$('[data-selector="details-title"]'),this.$tag=$('[data-selector="details-tag"]'),this.$content=$('[data-selector="details-content"]'),this.$assess=$('[data-selector="details-assess"]'),this.$assessCount=$('[data-selector="assess-count"]')};return t.prototype.init=function(){var t=this;t.main()},t.prototype.main=function(){var t=this;async.waterfall([function(e){t.ajax(e)},function(e,i){t.setThumb(e,i)},function(e,i){t.setInfo(e,i)},function(e,i){t.setTitle(e,i)},function(e,i){t.setTag(e,i)},function(e,i){t.setContent(e,i)},function(e,i){t.setAssess(e,i)}],function(t,e){return t?$.api.toast(t):($.echo(),void $.app.swipe())})},t.prototype.setThumb=function(t,e){var i=this;i.$thumb.html(i.thumbBannerHtml(t)),e(null,t)},t.prototype.thumbBannerHtml=function(t){var e=t.data.thumb_url||[],i="";return i+='<div class="banner-warp js-slider swipe"><div class="banner-group swipe-wrap">',e.forEach(function(t){i+='<div class="banner-item" data-echo-background="',i+=t.path,i+='"></div>'}),i+="</div></div>"},t.prototype.setInfo=function(t,e){var i=this;i.$info.html(i.infoHtml(t)),e(null,t)},t.prototype.infoHtml=function(t){var e="",i=t.data;return e+='<div class="price fl icon icon-score">',e+=i.offer_point,e+='</div><div class="price over fl small">已售',e+=i.sales,e+='</div><div class="price over fl small">剩余',e+=i.stock,e+="</div>"},t.prototype.setTitle=function(t,e){var i=this;i.$title.text(t.data.title),e(null,t)},t.prototype.setTag=function(t,e){var i=this;i.$tag.html(i.tagHtml(t)),e(null,t)},t.prototype.tagHtml=function(t){var e="",i=t.data;return e+='<div class="ui-tool icon-gt border"><div class="ui-tool-in"><div class="ui-tool-group">',i.is_new&&(e+='<div class="ui-tool-item"><div class="ui-tool-icon">新</div><div class="ui-tool-desc">新品推荐</div></div>'),i.is_hot&&(e+='<div class="ui-tool-item"><div class="ui-tool-icon">热</div><div class="ui-tool-desc">热门兑换</div></div>'),e+="</div></div></div>"},t.prototype.setContent=function(t,e){var i=this;e=$.callback(e),i.$content.html(t.data.content||""),e(null,t)},t.prototype.setAssessAount=function(t){var e=this,i='<div class="ui-tool-item" data-event="openNewWin" data-params=\'{"name":"win_coin_assess","param":{"id":"';i+=e.id,i+='"}}\'><div class="ui-tool-desc">宝贝评价（',i+=t.data.comment_count,i+="）</div></div>",e.$assessCount.html(i)},t.prototype.setAssess=function(t,e){var i=this;e=$.callback(e),i.setAssessAount(t),i.$assess.html(i.assessHtml(t)),e(null,t)},t.prototype.assessHtml=function(t){var e="",i="undefined"!=typeof t.data.comment&&t.data.comment.length?t.data.comment:[];return i.forEach(function(t){e+='<div class="lists-item"><div class="title"><div class="head" data-echo-background="',e+=t.avatar,e+='"></div><div class="nickname">',e+=t.nick,e+='</div></div><div class="desc">',e+=t.content,e+='</div><div class="end">',e+=t.ago,e+=" - 产品类型 : ",e+="积分商品",e+="</div></div>"}),e},t.prototype.ajax=function(t){var e=this;$.ajax({url:"mall/point/detail",data:{goods_id:e.id},cache:!1}).then(t)},$.coinDetails=function(){return new t}}(),~function(){var t=function(){this.coinNumber=$('[data-selector="coin-number"]'),this.advBanner=$('[data-selector="adv-banner"]'),this.listsGroup=$('[data-selector="lists-group"]'),this.$loadMore=$("._load-more"),this.page=1,this.size=10,this.scroll=$.scroll()};t.prototype.init=function(){this.listenerLogin(),this.getUserCoin(),this.getCoinAdv(),this.main()},t.prototype.getUserCoin=function(){var t=this;return"undefined"!=typeof localStorage.login&&void async.waterfall([function(t){$.ajax({url:"member/info/point"}).then(t)}],function(e,i){return!e&&void t.coinNumber.text(Math.floor(i.data))})},t.prototype.getCoinAdv=function(){var t=this;async.waterfall([function(t){$.ajax({url:"ads/index/index",data:{area:0,position:1}}).then(t)},function(e,i){t.advHtml(e,i)}],function(e,i){if(t.swipe(),e)return $.api.toast(e)})},t.prototype.advHtml=function(t,e){e="function"==typeof e?e:function(){};var i=t.data.info,n="",a=this;n+='<div class="banner-wrap js-slider swipe"><div class="banner-group swipe-wrap">',i.forEach(function(t){return!(!t||"undefined"==typeof t)&&(n+='<div class="banner-item" style="background-image: url(\'',n+=t.thumb,void(n+="')\"></div>"))}),n+="</div></div>",a.advBanner.html(n),e()},t.prototype.swipe=function(){var t=new Swipe($(".js-slider")[0],{startSlide:0,speed:400,auto:3e3,continuous:!0,disableScroll:!1,stopPropagation:!1,callback:function(t,e){var i=$(e).siblings().length+1;t||(t=i),$(".js-banner-bar").width(t*(100/i)+"%")}});return t},t.prototype.listenerLogin=function(){var t=this;$.logEvent().listenerLogin().then(function(){t.getUserCoin()})},t.prototype.main=function(){var t=this;t.scroll.removeListenerToBottom(),async.waterfall([function(e){$.ajax({url:"mall/point/list",data:{page:t.page,size:t.size},cache:!1}).then(e)},function(e,i){t.appendHtml(e,i)},function(e,i){t.iScroll(e,i)}],function(e){return $.app.oval(),$.echo(),t.swipe(),e?$.api.toast(e):void(t.page+=1)})},t.prototype.iScroll=function(t,e){var i=this;return e=$.callback(e),!t.data.info||t.data.info.length<i.size?(i.$loadMore.text("后面没有了"),e()):(i.$loadMore.text("努力加载中"),i.scroll.addListenerToBottom(function(){i.main()}),void e())},t.prototype.listsHtml=function(t){var e="",i=t.data.info||"undefined"==typeof t.data.info?t.data.info:[];return i.forEach(function(t){e+='<div class="lists-item hot" data-event="openNewWin" data-params=\'{"name":"win_coin_details","param":{"id":"',e+=t.id,e+='"}}\'><div class="lists-img"><img src="../images/shop-item.jpg" data-echo="',e+=t.thumb,e+='" /></div><div class="desc"><p>',e+=t.title,e+='</p><div class="pink"><i class="icon-score"></i><span>',e+=t.offer_point,e+='积分</span></div></div><div class="tips">热门</div></div>'}),e},t.prototype.appendHtml=function(t,e){var i=this;1==i.page?i.listsGroup.html(i.listsHtml(t)):i.listsGroup.append(i.listsHtml(t)),e(null,t)},$.coinIndex=function(){return new t}}(),~function(){var t=function(){this.page=1,this.size=10,this.type=api.pageParam.type,this.$wrap=$('[data-selector="item-wrap"]'),this.scroll=$.scroll(),this.pullRefresh=$.pullRefresh(),this.$loadMore=$("._load-more")};return t.prototype.init=function(){this.main(),this.refresh()},t.prototype.refresh=function(){var t=this;t.pullRefresh.set(function(){t.main()})},t.prototype.main=function(){var t=this;t.page=1,t.one()},t.prototype.one=function(){var t=this;t.scroll.removeListenerToBottom(),async.waterfall([function(e){t.ajax(e)},function(e,i){t.append(e,i)},function(e,i){t.iScroll(e,i)}],function(e){return $.echo(),t.pullRefresh.close(),e?$.api.toast(e):void(t.page+=1)})},t.prototype.html=function(t){var e="";return t.forEach(function(t){e+='<div class="lists-item"><div class="case">',e+=t.reason,e+='</div><div class="time">',e+=t.create_time,e+='</div><div class="coin">+',e+=t.point,e+="</div></div>"}),e},t.prototype.append=function(t,e){var i=this,n=t.data.info;1==i.page&&i.$wrap.html(i.html(n)),1!=i.page&&i.$wrap.append(i.html(n)),e(null,t)},t.prototype.iScroll=function(t,e){var i=this;return e=$.callback(e),!t.data.info.length||t.data.info.length<i.size?(i.$loadMore.text("后面没有了"),e()):(i.$loadMore.text("努力加载中"),i.scroll.addListenerToBottom(function(){i.one()}),void e())},t.prototype["delete"]=function(t){var e=t.id;$.confirm("删除订单","是否删除此订单?注意：删除后不可恢复",function(t){return!!t&&void $('[data-selector="'+e+'"]').remove()})},t.prototype.ajax=function(t){t=$.callback(t);var e=this;$.ajax({url:"member/bill/point",data:{page:e.page,size:e.size,type:e.type}}).then(t)},$.coinInfoItem=function(){return new t}}(),~function(){var t=function(){this.$item=$('[data-selector="nav-item"]'),this.$bar=$('[data-selector="bar"]')};return t.prototype.init=function(){var t=this;t.openFrameGroup(),t.event()},t.prototype.openFrameGroup=function(){var t=this;api.openFrameGroup({name:"coin-info-group",background:"#f2f2f2",scrollEnabled:!0,rect:{x:0,y:90+$.api.statusSize(),w:"auto",h:"auto"},index:0,frames:[{name:"coin_info_group_in",url:"widget://html/coin/coin-info-item.html",bgColor:"#f2f2f2",customRefreshHeader:"UIPullRefresh",bounces:!0,vScrollBarEnabled:!1,hScrollBarEnabled:!1,pageParam:{type:"-1"}},{name:"coin_info_group_out",url:"widget://html/coin/coin-info-item.html",bgColor:"#f2f2f2",customRefreshHeader:"UIPullRefresh",bounces:!0,vScrollBarEnabled:!1,hScrollBarEnabled:!1,pageParam:{type:"1"}}]},function(e,i){return!i&&void t.changeBar(e.index)})},t.prototype.event=function(){var t=this;t.$item.on("tap",function(){var t=$(this).index();$.api.switchPageIndex("coin-info-group",t,!0)})},t.prototype.changeBar=function(t){var e=this;e.$bar.css({left:50*t+"%"})},$.coinInfo=function(){return new t}}(),~function(){var t=function(){this.page=1,this.size=10,this.type=2,this.$wrap=$('[data-selector="itemWrap"]'),this.scroll=$.scroll(),this.$loadMore=$("._load-more")};return t.prototype.init=function(){this.main()},t.prototype.main=function(){var t=this;t.page=1,t.one()},t.prototype.one=function(){var t=this;t.scroll.removeListenerToBottom(),async.waterfall([function(e){t.ajax(e)},function(e,i){t.append(e,i)},function(e,i){t.iScroll(e,i)}],function(e){return $.echo(),e?$.api.toast(e):void(t.page+=1)})},t.prototype.html=function(t){var e="",i=0;return t.forEach(function(t){e+='<div class="list-item" data-selector="',e+=t.id,e+='"><div class="list-item-top"><div class="top-left" data-echo-background="',e+=t.logo,e+='"></div><div class="top-right">',e+=t.name,e+="</div></div>",t.content.forEach(function(t){e+='<div class="list-item-center"><div class="center-item center-img" data-echo-background="',e+=t.goods_logo,e+='"></div><div class="center-item center-text"><div class="center-text-top"><div class="text-top-item">',e+=t.goods_title,e+='</div><div class="text-top-item text-top-right">共',e+=t.goods_sum||0,i+=parseInt(t.goods_sum)||0,e+='件</div></div><div class="center-text-center">购买套餐 ：默认</div><div class="center-text-bottom">积分兑换</div></div></div>'}),e+='<div class="all"><div class="all-in">共',e+=i,e+="件商品（共支付",e+=t.offer_point,e+="积分）</div></div>",e+='<div class="list-item-bottom"><div class="btn-group"><div class="btn-item" data-event="deleteOrder" data-params=\'{"id":"',e+=t.id,e+='"}\'>删除订单</div><div class="btn-item" data-event="openNewWin" data-params=\'{"name":"win_coin_chase","param":{"id":"',e+=t.id,e+="\"}}'>查看物流</div>",e+="</div></div></div>"}),e},t.prototype.append=function(t,e){var i=this,n=t.data.info;1==i.page&&i.$wrap.html(i.html(n)),1!=i.page&&i.$wrap.append(i.html(n)),e(null,t)},t.prototype.iScroll=function(t,e){var i=this;return e=$.callback(e),!t.data.info.length||t.data.info.length<i.size?(i.$loadMore.text("后面没有了"),e()):(i.$loadMore.text("努力加载中"),i.scroll.addListenerToBottom(function(){i.one()}),void e())},t.prototype["delete"]=function(t){var e=t.id;$.confirm("删除订单","是否删除此订单?注意：删除后不可恢复",function(t){return!!t&&void $('[data-selector="'+e+'"]').remove()})},t.prototype.ajax=function(t){t=$.callback(t);var e=this;$.ajax({url:"member/order/list",data:{page:e.page,size:e.size}}).then(t)},$.coinOrder=function(){return new t}}(),~function(){var t=function(){this.coinNumber=$('[data-selector="coin-number"]')};t.prototype.init=function(){this.listenerLogin(),this.getUserCoin()},t.prototype.getUserCoin=function(){var t=this;return"undefined"!=typeof localStorage.login&&void async.waterfall([function(t){$.ajax({url:"member/info/point"}).then(t)}],function(e,i){return!e&&void t.coinNumber.text(Math.floor(i.data))})},t.prototype.listenerLogin=function(){var t=this;$.logEvent().listenerLogin().then(function(){t.getUserCoin()})},$.homeCoin=function(){return new t}}(),~function(){var t=function(){this.resource="http://api.mlb.kfw001.com/city.json",this.UICityList=api.require("UICityList"),this.currentCity=JSON.parse(localStorage.city)};return t.prototype.init=function(){var t=this;t.main()},t.prototype.main=function(){var t=this;t.UICityList.open({rect:{x:0,y:45+$.api.statusSize()},resource:t.resource,styles:{searchBar:{bgColor:"#696969",cancelColor:"#E3E3E3"},location:{color:"#696969",size:12},sectionTitle:{bgColor:"#eee",color:"#000",size:12},item:{bgColor:"#fff",activeBgColor:"#696969",color:"#000",size:14,height:40},indicator:{bgColor:"#fff",color:"#696969"}},currentCity:"object"==typeof t.currentCity?t.currentCity.city.city:"未知",locationWay:"当前位置",hotTitle:"热门城市",placeholder:"输入城市名或首字母查询"},function(t,e){})},$.cityLists=function(){return new t}}(),~function(){var t=function(){};return t.prototype.init=function(){},$.setIndex=function(){return new t}}(),~function(){var t=function(){this.avatar=$('[data-selector="avatar"]'),this.bindTel=$('[data-selector="bineTel"]'),this.tel=$('[data-selector="tel"]'),this.code=$('[data-selector="code"]')};return t.prototype.init=function(){this.setAvatar(),this.listener_bind_tel()},t.prototype.setAvatar=function(){var t=this;return!!api.pageParam.avatar&&void t.avatar.css({"background-image":'url("'+api.pageParam.avatar+'")'})},t.prototype.listener_bind_tel=function(){var t=this;t.bindTel.on("tap",function(){t.telAjax()})},t.prototype.telAjax=function(){var t=this,e=t.tel.val(),i=t.code.val();return api.pageParam.token?void $.ajax({url:"member/login/bindtel",data:{tel:e,code:i,token:api.pageParam.token},success:function(t){$.api.toast("绑定成功"),localStorage.access_token=t.data.token,$.api.sendEvent("login",{}),setTimeout(function(){$.openWin({name:"root"})},500)},error:function(t){$.api.toast(t)}}):$.api.toast("token出现错误")},$.bindTel=function(){return new t}}(),~function(){var t=function(){this.submitBtn=$('[data-selector="forget-btn"]'),this.tel=$('[data-selector="tel"]'),this.code=$('[data-selector="code"]'),this.pwd=$('[data-selector="password"]')};t.prototype.init=function(){this.submit()},t.prototype.submit=function(){var t=this;t.submitBtn.on("tap",function(){var e=t.code.val(),i=t.pwd.val(),n=t.tel.val();return 11!=n.length?$.api.toast("手机号不正确"):i?e?6!=e.length?$.api.toast("验证码不正确"):void t.ajax({tel:n,password:i,code:e}):$.api.toast("验证码未填写"):$.api.toast("密码未填写")})},t.prototype.ajax=function(t){$.ajax({url:"member/info/password",data:t}).then(function(t,e){return t?$.api.toast(t):($.api.toast(e.msg),void $.api.closeWin())})},$.forgetPwd=function(){return new t}}(),~function(){var t=function(){this.$login=$('[data-selector="login"]'),this.$logout=$('[data-selector="logout"]'),this.$avatar=$('[data-selector="avatar"]'),this.$signature=$('[data-selector="signature"]'),this.$nick=$('[data-selector="nick"]')};return t.prototype.init=function(){this.getUserInfo(),this.listenerLog()},t.prototype.getUserInfo=function(){var t=this;async.waterfall([function(e){t.ajax(e)},function(e,i){t.setUserInfo(e,i)}],function(e){return e?(t.$login.hide(),t.$logout.show()):(t.$login.show(),void t.$logout.hide())})},t.prototype.ajax=function(t){$.ajax({url:"member/info/user"}).then(t)},t.prototype.setUserInfo=function(t,e){var i=t.data,n=this;n.$nick.html(i.nick||"佚名"),n.$signature.html(i.signature||"HI ，欢迎来美乐吧做客！"),n.$avatar.css({"background-image":'url("'+(i.avatar?i.avatar:"../images/icon.png")+'")'}),e(null,t)},t.prototype.listenerLog=function(){var t=this;$.logEvent().listenerLogin().then(function(){t.getUserInfo()}),$.logEvent().listenerLogin().then(function(){t.getUserInfo()})},$.homeUser=function(){return new t}}(),~function(){var t=function(){this.tel=$('[data-selector="tel"]')};t.prototype.sendSMSCode=function(t,e,i){var n=this,a=n.tel.val(),o=60,s=null;return a?void $.ajax({url:"common/code/sms",data:{tel:a,tip:e.tip},success:function(){$.api.toast("短信发送成功，请注意查收"),i.data("event","").addClass("active"),s=setInterval(function(){return o-=1,o<=0?(clearInterval(s),i.removeClass("active").html("点击发送"),!1):void i.html(o+"秒后重新发送")},1e3)},error:function(t){$.api.toast("短信发送失败："+t)}}):$.api.toast("手机号填写不正确")},$.userCommon=function(){return new t}}(),~function(){var t=function(){this.$btn=$('[data-selector="user-login-btn"]'),this.$tel=$('[data-selector="tel"]'),this.$pwd=$('[data-selector="password"]')};return t.prototype.init=function(){var t=this;t.$btn.on("tap",function(){t.login()})},t.prototype.login=function(){var t=this;async.waterfall([function(e){t.ajax(e)}],function(e,i){return e?$.api.toast(e):void t.login_success(i)})},t.prototype.ajax=function(t){var e=this,i=e.$tel.val(),n=e.$pwd.val();return i?n?void $.ajax({url:"member/login/login",data:{tel:i,password:n}}).then(t):t("密码未填写"):t("手机号不正确")},t.prototype.qqLogin=function(){var t=this,e=$.qq();e.init(),e.login(function(i){async.waterfall([function(e){t.qqAjax(i,e)}],function(i,n){return i?$.api.toast(i):n.data.need_tel?t.goBindTel({token:n.data.token,avatar:e.info.avatar}):void t.login_success(n)})})},t.prototype.qqAjax=function(t,e){$.ajax({url:"member/login/auth",data:t}).then(e)},t.prototype.login_success=function(t){$.logEvent().sendLogin(t),$.api.closeWin()},t.prototype.goBindTel=function(t){$.openWin({name:"wrl_bind_tel",param:t})},$.userLogin=function(){return new t}}(),~function(){var t=function(){this.submitBtn=$('[data-selector="regi-btn"]'),this.tel=$('[data-selector="tel"]'),this.code=$('[data-selector="code"]'),this.pwd=$('[data-selector="password"]'),this.pwdAg=$('[data-selector="password-again"]')};t.prototype.init=function(){this.submit()},t.prototype.submit=function(){var t=this;t.submitBtn.on("tap",function(){var e=t.code.val(),i=t.pwd.val(),n=t.pwdAg.val(),a=t.tel.val();return 11!=a.length?$.api.toast("手机号不正确"):i!==n?$.api.toast("两次输入的密码不同"):e?6!=e.length?$.api.toast("验证码不正确"):void t.ajax({tel:a,password:i,code:e}):$.api.toast("验证码未填写")})},t.prototype.ajax=function(t){$.ajax({url:"member/login/reg",data:t}).then(function(t,e){return t?$.api.toast(t):(localStorage.token=e.data.token,$.api.sendEvent("login",{msg:e.msg}),void setTimeout(function(){$.openWin({name:"root"})},500))})},$.userRegi=function(){return new t}}(),~function(){var t=function(){this.bMap=api.require("bMap"),this.url="common/location/city",this.callback};return t.prototype._getLocation=function(t){var e=this;t=$.callback(t),e.bMap.getLocation({accuracy:"100m",autoStop:!0,filter:1},function(e,i){t(i,e)})},t.prototype._getNameFromCoords=function(t,e){var i=this;e=$.callback(e),i.bMap.getNameFromCoords({lon:t.lon,lat:t.lat},function(t,i){e(i,t)})},t.prototype.city=function(t){var e=this,i=JSON.stringify(localStorage.city);return t=$.callback(t),"object"==typeof i?t(null,i):async.waterfall([function(t){e._getLocation(t)},function(t,i){e._getNameFromCoords(t,i)},function(t,i){e._cityId(t,i)}],t),e},t.prototype._cityId=function(t,e){var i=this;e=$.callback(e),$.ajax({url:i.url,data:{city:t.city.substring(0,2)}}).then(function(n,a){var o="undefined"!=typeof a?$.extend({},a.data,{address:t.address+t.poiList[0].name+"("+t.poiList[0].address+")",city:{city:t.city,id:a.data.city.id},lon:t.lon,lat:t.lat}):"undefined";i.cache(n,o),e(n,o)})},t.prototype.cache=function(t,e){t||"object"!=typeof e?localStorage.city="undefined":localStorage.city=JSON.stringify(e)},t.prototype.error=function(t){},$.bMap=function(){return new t}}(),~function(){var t=function(){this.callback};t.prototype.sendLogin=function(t){var e=this;$.api.sendEvent("login",t||{}),e.success(t)},t.prototype.listenerLogin=function(t){var e=this;return"undefined"==typeof t&&"function"==typeof t?$.api.listenerEvent("login",function(e){t(e)}):($.api.listenerEvent("login",function(t){e.callback(null,t)}),e)},t.prototype.sendLogout=function(t){var e=this;$.api.sendEvent("login",t||{}),e.success(t)},t.prototype.then=function(t){var e=this;t="function"==typeof t?t:function(){},e.callback=t},t.prototype.success=function(t){return $.api.toast(t.msg?t.msg:"未知错误"),localStorage.token=t.data.token,"undefined"==typeof t.data.is_login?localStorage.login="undefined":void(localStorage.login=t.data.token)},$.logEvent=function(){return new t}}(),~function(){var t=function(){};return t.prototype.set=function(t){t=$.callback(t),api.setCustomRefreshHeaderInfo({bgColor:"rgba(0,0,0,0)",image:$.config.pullRefresh},function(){$.api.toast("刷新成功"),t()})},t.prototype.close=function(){setTimeout(api.refreshHeaderLoadDone,500)},$.pullRefresh=function(){return new t}}(),~function(){var t=function(){this.qq,this.android={id:"1105410509",key:"7ki84UhA5hYwkVLv"},this.ios={id:"1105410523",key:"4CXeu1RlBP2R32kz"},this.info={type:1,auth_openid:"",auth_token:"",province:"",city:"",nick:"",sex:"",avatar:""}};return t.prototype.init=function(){var t=this;t.qq=api.require("qq")},t.prototype.install=function(t){var e=this;t="function"==typeof t?t:function(){},e.qq.installed(function(e,i){return e.status?void t():$.api.toast("您未安装腾讯QQ")})},t.prototype.login=function(t){var e=this;return t="function"==typeof t?t:function(){},"undefined"==typeof e.qq?$.api.toast("你忘了初始化"):void e.install(function(){e.get_user_info(t)})},t.prototype.get_user_info=function(t){var e=this;api.require("qq");e.qq.login({apiKey:"ios"==api.systemType?e.ios.id:e.android.id},function(i,n){return n?$.api.toast(n):(e.info.auth_openid=i.openId,e.info.auth_token=i.accessToken,void e.get_details_info(t))})},t.prototype.get_details_info=function(t){var e=this;e.qq.getUserInfo(function(i,n){return n?$.api.toast(n):(e.info.nick=i.info.nickname,e.info.avatar=i.info.figureurl_qq_2,e.info.sex="男"==i.info.gender?1:2,e.info.province=i.info.province,e.info.city=i.info.city,void t(e.info))})},t.prototype.shareUrl=function(t,e){var i=this;i.install(function(){i.qq.shareNews($.extend({},{apiKey:"ios"==api.systemType?i.ios.id:i.android.id,url:"https://baidu.com",title:"分享标题",description:"分享描述",imgUrl:"https://ss0.baidu.com/6ONWsjip0QIZ8tyhnq/it/u=1781221968,1734501883&fm=80",type:"QFriend"},t),function(t,i){e()})})},t.prototype.shareUrlToQFriend=function(t,e){var i=this;return e="function"==typeof e?e:function(){},"undefined"==typeof i.qq?$.api.toast("你忘了初始化"):"object"!=typeof t?$.api.toast("您的参数不正确"):(t.type="QFriend",void i.shareUrl(t,e))},t.prototype.shareUrlToQZone=function(t,e){var i=this;return e="function"==typeof e?e:function(){},"undefined"==typeof i.qq?$.api.toast("你忘了初始化"):"object"!=typeof t?$.api.toast("您的参数不正确"):(t.type="QZone",void i.shareUrl(t,e))},$.qq=function(){return new t}}(),~function(){return $.ads={html:function(t){if("object"!=typeof t||"undefined"==typeof t.data||"undefined"==t.data.info)return"";var e="",i=t.data.info;return e='<div class="banner-warp js-slider swipe"><div class="banner-group swipe-wrap">',i.forEach(function(t){e+='<div class="banner-item" style="background-image: url(\'',e+=t.thumb,e+="')\" ></div>"}),e+="</div></div>"},plate_html:function(t){if("object"!=typeof t||"undefined"==typeof t.data||"undefined"==t.data.info)return"";var e="",i=t.data.info;return e='<div class="brands-warp"><div class="brands-group">',i.forEach(function(t,i){return!(i>=3)&&(e+='<div class="brands-item" ><img src="../images/brand1.png" data-echo="',e+=t.thumb,void(e+='"/></div>'))}),e+="</div></div>"},bill_html:function(t){if("object"!=typeof t||"undefined"==typeof t.data||"undefined"==t.data.info)return"";var e="",i=t.data.info;return e='<div class="bill-warp"><div class="bill-group">',i.forEach(function(t,i){return!(i>=2)&&(e+='<div class="bill-item"><div class="bill-title">',e+=t.name,e+='</div><div class="bill-context"><img src="../images/home-index-bill-1.jpg" data-echo="',e+=t.thumb,void(e+='" /></div></div>'))}),e+="</div></div>"}}}(),~function(){var t=function(t){this.host="http://api.mlb.kfw001.com/",this.key="!@#kfwljwzhuchaofengyang20160802434",this.cacheTime=300,this.sign="",this.settings=t,this.settings.url=this.host+this.settings.url,this.callback="function"==typeof callback?callback:function(){},t.success||t.error?this.init():null};t.prototype.init=function(){var t=this;t.settings.data=$.extend({},t._default_data(),t.settings.data),t.ajax()},t.prototype.then=function(t){var e=this;e.callback=t,e.init()},t.prototype._default_data=function(){return{token:localStorage.token?localStorage.token:0,appid:"undefined"==typeof api?0:api.appId||0,deviceid:"undefined"==typeof api?0:api.deviceId||0}},t.prototype._sort=function(){var t=this,e=[];for(var i in t.settings.data)e.push(i);return e.sort()},t.prototype._signature=function(){var t=this,e=api.require("signature");return t._sort().forEach(function(e){t.sign+=e+t.settings.data[e]+"&"}),t.sign+=t.key,t.sign=e.md5Sync({data:t.sign}),t.sign},t.prototype._data=function(){var t=this;return t.settings.data=$.extend({},t.settings.data,{sign:t._signature()}),t.settings.data},t.prototype.ajax=function(){var t=this,e=$.extend({},{url:"",cache:!0,method:"POST",dataType:"JSON",timeout:5,success:function(){},error:function(){}},t.settings),i=t._data(),n=t.getCache();return e.cache&&n&&n.timestamp+t.cacheTime>t._timestamp()?(t.callback(null,n),e.success(n)):void api.ajax({url:e.url,cache:!0,method:e.method,dataType:e.dataType,timeout:e.timeout,data:{values:i}},function(i,n){return n?(t.callback(n.msg),e.error(n.msg)):100!=i.status?(t.callback(i.msg),e.error(i.msg)):void t.success(e,i)})},t.prototype.success=function(t,e){var i=this;t.cache&&i.setCache(e),i.callback(null,e),t.success(e)},t.prototype.setCache=function(t){var e=this;return"object"==typeof t&&(t=$.extend({},t,{timestamp:e._timestamp()}),t=JSON.stringify(t),localStorage.setItem(e.settings.url+e.sign,t))},t.prototype.getCache=function(){var t=this,e=localStorage.getItem(t.settings.url+t.sign);return!!e&&JSON.parse(e)},t.prototype._timestamp=function(){return Math.round((new Date).getTime()/1e3)},$.ajax=function(e){return"object"==typeof e&&e.url?new t(e):$.api.toast("参数错误：undefined")}}(),~function(){return $.callback=function(t){return t="function"==typeof t?t:function(){}}}(),~function(){$.echo=function(t){return t="function"==typeof t?t:function(){},"object"==typeof echo&&(echo.detach(),echo.init({offset:500,throttle:250,unload:!1,debounce:!0,callback:t}),void echo.render())}}(),~function(){var t=function(t){this.err=t,this.name=api.frameName,this.init()};return t.prototype.init=function(){var t=this;if(t.err="string"!=typeof t.err&&t.err,!t.err)return t.error()},t.prototype.error=function(){var t=this;$.api.toast(t.err),t.openNetError()},t.prototype.openNetError=function(){setTimeout(function(){api.openFrame({name:"net-error",url:"widget://html/common/net-error.html"})},500)},$.error=function(e){return e?new t(e):setTimeout(function(){$(".js-load").hide()},500)}}(),~function(){var t=function(){};t.prototype.win_url=function(){var t=this;t.win_frame({name:"frame_url",url:api.pageParam.url})},t.prototype.win_cargo=function(){var t=this;t.win_frame({name:"frame_cargo",url:"widget://html/cargo/cargo.html"})},t.prototype.win_bbs_details=function(){var t=this;t.win_frame({name:"frame_bbs_details",url:"widget://html/bbs/bbs-details.html"})},t.prototype.win_user_login=function(){var t=this;t.win_frame({name:"frame_login",url:"widget://html/user/user-login.html"})},t.prototype.win_bind_tel=function(){var t=this;t.win_frame({name:"frame_bind_tel",url:"widget://html/user/bind-tel.html"})},t.prototype.win_user_regi=function(){var t=this;t.win_frame({name:"frame_bind_tel",url:"widget://html/user/user-regi.html"})},t.prototype.win_forget_pwd=function(){var t=this;t.win_frame({name:"frame_forget_pwd",url:"widget://html/user/forget-pwd.html"})},t.prototype.win_coin_details=function(){var t=this;t.win_frame({name:"frame_coin_details",url:"widget://html/coin/coin-details.html"})},t.prototype.win_coin_assess=function(){var t=this;t.win_frame({name:"frame_coin_assess",url:"widget://html/coin/coin-assess.html"})},t.prototype.win_coin_info=function(){var t=this;t.win_frame({name:"frame_coin_info",url:"widget://html/coin/coin-info.html"})},t.prototype.win_coin_order=function(){var t=this;t.win_frame({name:"frame_coin_order",url:"widget://html/coin/coin-order.html"})},t.prototype.win_coin_chase=function(){var t=this;t.win_frame({name:"frame_coin_chase",url:"widget://html/coin/coin-chase.html"})},t.prototype.win_set_index=function(){var t=this;t.win_frame({name:"frame_set_index",url:"widget://html/set/set-index.html"})},t.prototype.win_set_user=function(){
var t=this;t.win_frame({name:"frame_set_user",url:"widget://html/set/set-user.html"})},t.prototype.win_address=function(){var t=this;t.win_frame({name:"frame_set_address",url:"widget://html/set/set-address.html"})},t.prototype.win_city_lists=function(){var t=this;t.win_frame({name:"frame_city_lists",url:"widget://html/common/city-lists.html"})},t.prototype.win_beauty_home=function(){var t=this;t.win_frame({name:"frame_beauty_home",url:"widget://html/beauty/beauty-home.html"})},t.prototype.win_beauty_details=function(){var t=this;t.win_frame({name:"frame_beauty_details",url:"widget://html/beauty/beauty-details.html"})},t.prototype.win_beauty_create_order=function(){var t=this;t.win_frame({name:"frame_beauty_create_order",url:"widget://html/beauty/beauty-create-order.html"})},t.prototype.win_pay=function(){var t=this;t.win_frame({name:"frame_pay",url:"widget://html/pay.html"})},t.prototype.win_frame=function(t){api.openFrame({name:t.name,url:t.url,rect:{x:0,y:$.api.statusSize(),w:"auto",h:"auto"},pageParam:api.pageParam,bounces:t.bounces||!1,bgColor:"#f2f2f2",vScrollBarEnabled:!1,hScrollBarEnabled:!1})},$.frame=new t}(),~function(){$.openWin=function(t){return"object"==typeof t&&t?"root"==t.name?api.openWin({name:"root"}):void api.openWin({name:t.name,url:"widget://html/win.html",pageParam:$.extend({},t.param||{},{main:t.name}),bgColor:"#e65c7c",reload:!0}):$.api.toast("尚未开发，请耐心等候")},$.win=function(){var t=api.pageParam.main;"function"==typeof $.frame[t]?$.frame[t](api.pageParam):$.api.toast("出现错误，可能是参数有误，或者是入口函数不存在")}}(),~function(){var t=function(){};return t.prototype.init=function(){},t.prototype.addListenerToBottom=function(t){t=$.callback(t),api.addEventListener({name:"scrolltobottom",extra:{threshold:$.config.threshold?$.config.threshold:30}},function(){t()})},t.prototype.removeListenerToBottom=function(){api.removeEventListener({name:"scrolltobottom"})},$.scroll=function(){return new t}}(),~function(){var t=function(t){this.MNActionButton,this.items=[{icon:"widget://res/share/wx-1.png",title:"微信朋友圈"},{icon:"widget://res/share/wx-2.png",title:"发送给朋友"},{icon:"widget://res/share/qq-1.png",title:"QQ好友"},{icon:"widget://res/share/qq-2.png",title:"QQ空间"},{icon:"widget://res/share/weibo.png",title:"新浪微博"},{icon:"widget://res/share/qrcode.png",highlight:"widget://res/MNActionButton/5.png",title:"二维码"},{icon:"widget://res/share/link.png",highlight:"widget://res/MNActionButton/6.png",title:"复制链接"}],this.callback};t.prototype.init=function(){return this.MNActionButton=api.require("MNActionButton"),this},t.prototype.open=function(t){var e=this;e.callback="function"==typeof t?t:function(){},e.MNActionButton.open({layout:{row:2,col:4,offset:0,colSpacing:"ios"==api.systemType?30:10},animation:!1,autoHide:!0,styles:{maskBg:"rgba(0,0,0,.35)",bg:"#fff",cancelButton:{bg:"#fff"},item:{titleColor:"#888",titleHighlight:"dd2727",titleSize:12},indicator:{color:"#c4c4c4",highlight:"#9e9e9e"}},items:e.items},function(t){return"cancel"==t.eventType?e.callback(!0):void e.callback(null,t.index,e.items[t.index])})},$.shareAction=function(){return new t}}(),~function(){var t=function(t,e,i,n){this.$container,this.title=t,this.text=e,this.callback="function"==typeof i?i:function(){},this.type=n,this.init()};t.prototype.init=function(){var t=this;t.ceater(),t.event()},t.prototype.html=function(){var t=this,e="";return e+='<div class="ui-alert show"><div class="ui-alert-wrap"></div><div class="ui-alert-toast"><div class="ui-alert-title"><div class="ui-alert-title-in">',e+=t.title||"",e+='</div></div><div class="ui-alert-context"><div class="ui-alert-context-in">',e+=t.text||"",e+='</div></div><div class="ui-alert-btn-group">',e+="alert"==t.type?'<div class="ui-alert-btn" data-type="1">确认</div>':'<div class="ui-alert-btn" data-type="0">取消</div><div class="ui-alert-btn" data-type="1">确认</div>',e+="</div></div></div>"},t.prototype.ceater=function(){var t=this;t.$container=document.createElement("div"),t.$container.className="ui-container",t.$container.innerHTML=t.html(),document.body.appendChild(t.$container)},t.prototype.event=function(){for(var t=this,e=t.$container.querySelectorAll(".ui-alert-btn"),i=0;i<e.length;i++)e[i].addEventListener("click",function(){var e=this;t.hide(!!parseInt(e.getAttribute("data-type")))},!1)},t.prototype.hide=function(t){var e=this;e.callback(t),e.$container.parentNode.removeChild(e.$container)},$.alert=function(e,i,n){return new t(e,i,n,"alert")},$.confirm=function(e,i,n){return new t(e,i,n,"confirm")}}(),~function(){var t=function(t,e){this.container="",this.$container="",this.settings=$.extend({},{title:"更改头像",item:[{icon:"icon-picture",name:"图片库",value:"library"},{icon:"icon-camera",name:"相机",value:"camera"}]},t),this.settings.callback=e,this.init()};t.prototype.init=function(){this.addHtml(),this.event()},t.prototype.addHtml=function(){var t=this;t.container=document.createElement("div");var e="";e+='<div class="_action-sheet"><div class="action-wrap" data-event="hide" data-params="false"></div><div class="action-sheet"><div class="action-sheet-title">',e+=t.settings.title,e+='</div><div class="action-sheet-item-group">',t.settings.item.forEach(function(t,i){e+='<div class="action-sheet-item',e+=t.icon?" "+t.icon:"",e+='" data-event="select" data-params="',e+=i,e+='">',e+=t.name,e+="</div>"}),e+="</div></div></div>",t.container.innerHTML=e,document.body.appendChild(t.container),t.$container=$(t.container).find("._action-sheet")},t.prototype.event=function(){var t=this;t.$container.on("tap","[data-event]",function(){var e=$(this),i=e.data("params");return t.hide(),"hide"==e.data("event")?t.settings.callback(!1):void t.settings.callback(t.settings.item[i])})},t.prototype.show=function(){var t=this;t.$container.addClass("show")},t.prototype.hide=function(t){t=!t||t;var e=this;return t?$(e.container).remove():void e.$container.removeClass("show")},$.actionSheet=function(e,i){return!("object"!=typeof e||!e||!e.item.length)&&(i="function"==typeof i?i:function(){},new t(e,i))}}(),~function(){var t=function(){this.$city=$('[data-selector="city-name"]'),this.$topAds=$('[data-selector="top-ads"]'),this.$plateAds=$('[data-selector="plate-ads"]'),this.$bill=$('[data-selector="bill-ads"]'),this.$beauty=$('[data-selector="beauty"]'),this.$loadMore=$("._load-more"),this.page=1,this.size=10,this.scroll=$.scroll(),this.bMap=$.bMap()};return t.prototype.init=function(){var t=this;t.bMap.city(function(e,i){if(e){var n=confirm("定位失败 : 请手动选择地区或者给予我们获取地理位置权限，为您提供更好的服务");n&&$.app["switch"]("openNewWin",{name:"win_city_lists"})}t.cityTips(e,i),t.top_ads(1),t.plate_ads(2),t.bill_ads(3),t.main()})},t.prototype.main=function(){var t=this;t.page=1,t.beauty()},t.prototype.cityTips=function(t,e){var i=this;i.$city.text(t?"未知":e.city.city),i.bMap.cache(t,e)},t.prototype.top_ads=function(t){var e=this;async.waterfall([function(i){e.ajax_ads(t,i)},function(t,i){e.ads_html(t,i)}],function(t,e){$.app.swipe()})},t.prototype.plate_ads=function(t){var e=this;async.waterfall([function(i){e.ajax_ads(t,i)},function(t,i){e.plate_html(t,i)}],function(t,e){$.echo()})},t.prototype.bill_ads=function(t){var e=this;async.waterfall([function(i){e.ajax_ads(t,i)},function(t,i){e.bill_html(t,i)}],function(t,e){$.echo()})},t.prototype.ajax_ads=function(t,e){var i=JSON.parse(localStorage.city);$.ajax({url:"ads/index/index",data:{area:"object"==typeof i?i.city.id:0,position:t}}).then(e)},t.prototype.ads_html=function(t,e){var i=this;i.$topAds.html($.ads.html(t)),e()},t.prototype.plate_html=function(t,e){var i=this,n=$.ads.plate_html(t);i.$plateAds.html(n),e()},t.prototype.bill_html=function(t,e){var i=this,n=$.ads.bill_html(t);i.$bill.html(n),e()},t.prototype.beauty=function(){var t=this;t.scroll.removeListenerToBottom(),async.waterfall([function(e){t.ajax(e)},function(e,i){t.beauty_html(e,i)},function(e,i){t.iScroll(e,i)}],function(e){return $.echo(),e?$.api.toast(e):void(t.page+=1)})},t.prototype.iScroll=function(t,e){var i=this;return e=$.callback(e),!t.data.info||t.data.info.length<i.size?(i.$loadMore.text("后面没有了"),e()):(i.$loadMore.text("努力加载中"),i.scroll.addListenerToBottom(function(){i.beauty()}),void e())},t.prototype.ajax=function(t){var e=this;t=$.callback(t);var i=JSON.parse(localStorage.city),n={longitude:"object"==typeof i?i.lon:0,latitude:"object"==typeof i?i.lat:0,page:e.page,size:e.size};$.ajax({url:"mall/shop/list",data:n}).then(t)},t.prototype.beauty_html=function(t,e){var i=this;e=$.callback(e),1==i.page?i.$beauty.html(i.html(t)):i.$beauty.append(i.html(t)),e(null,t)},t.prototype.html=function(t){if("object"!=typeof t||"undefined"==typeof t.data||"undefined"==t.data.info)return"";var e="",i=t.data.info;JSON.parse(localStorage.city);return e='<div class="list-group">',i.forEach(function(t){e+='<div class="list-item" data-event="openNewWin" data-params=\'{"name":"win_beauty_home","param":{"id":"',e+=t.id,e+='"}}\'><div class="list-item-left" data-echo-background="',e+=t.logo,e+='"></div><div class="list-item-right"><div class="list-item-title"><p>',e+=t.name,e+='</p></div><div class="list-item-info">',e+=t.description,e+='</div><div class="list-item-addr"><div class="addr-left">',e+="【地址】",e+=t.address,e+='</div><div class="addr-right"><i class="icon-place"></i><span>&lt;',e+=t.distance<0?Math.floor(1e3*t.distance)+"m":Math.floor(t.distance)+"km",e+='</span></div></div><div class="list-item-review">';for(var i=1;i<6;i++)e+=i<=t.star?'<i class="icon-star active"></i>':'<i class="icon-star"></i>';e+="<span>",e+=t.bbs_count||0,e+="人评价</span></div></div></div>"}),e+="</div>"},$.homeIndex=function(){return new t}}(),function(){var t=function(){this.foot=$("footer").find(".footer-item"),this.bbs=!0,this.bbsPageGroup=[]};t.prototype.init=function(){var t=this;t.openFramGroup(),t.listenerFoot(),t.listenerHeaderSwitchEvent(),t.changeBbsPageGroup()},t.prototype.listenerFoot=function(){var t=this;t.foot.on("click",function(){t.switchFoot($(this))})},t.prototype.openFramGroup=function(){api.openFrameGroup({name:"homeGroup",scrollEnabled:!1,preload:4,index:0,rect:{marginLeft:0,marginRight:0,marginTop:$.api.statusSize(),marginBottom:45},frames:[{name:"homeIndex",url:"widget://html/home-index.html",bounces:!1,bgColor:"#ededed",vScrollBarEnabled:!1,hScrollBarEnabled:!1},{name:"shopIndex",url:"widget://html/home-coin.html",bounces:!1,bgColor:"#ededed",vScrollBarEnabled:!1,hScrollBarEnabled:!1},{name:"beautyIndex",url:"widget://html/home-beauty.html",bounces:!1,bgColor:"#ededed",vScrollBarEnabled:!1,hScrollBarEnabled:!1},{name:"bbsIndex",url:"widget://html/home-bbs.html",bounces:!1,bgColor:"#ededed",vScrollBarEnabled:!1,hScrollBarEnabled:!1},{name:"personalIndex",url:"widget://html/home-user.html",bounces:!1,bgColor:"#ededed",vScrollBarEnabled:!1,hScrollBarEnabled:!1}]})},t.prototype.switchFoot=function(t){var e=this,i=t.index();t.addClass("active").siblings().removeClass("active");var n=t.find(".icon");$.each(e.foot.find(".icon"),function(t,e){$(e).attr("class","icon "+$(e).data("icon"))}),n.attr("class","icon "+n.data("active-icon")),$.api.switchPageIndex("homeGroup",i),$.api.hidePageGroup("bbsGroup"),api.setFrameAttr({name:"frame-coin-index",hidden:!0}),api.setFrameAttr({name:"frame-beauty-index",hidden:!0}),3==i&&e.openBbsGroup(),1==i&&e.openCoinIndex(),2==i&&e.openBeautyIndex()},t.prototype.openCoinIndex=function(){api.openFrame({name:"frame-coin-index",url:"widget://html/coin/coin-index.html",rect:{marginLeft:0,marginRight:0,marginTop:45+$.api.statusSize(),marginBottom:45},bounces:!1,bgColor:"#ededed",vScrollBarEnabled:!1,hScrollBarEnabled:!1})},t.prototype.openBeautyIndex=function(){api.openFrame({name:"frame-beauty-index",url:"widget://html/beauty/beauty-index.html",rect:{marginLeft:0,marginRight:0,marginTop:80+$.api.statusSize(),marginBottom:45},bgColor:"#ededed",vScrollBarEnabled:!1,hScrollBarEnabled:!1})},t.prototype.openBbsGroup=function(){var t=this;api.openFrameGroup({name:"bbsGroup",scrollEnabled:!0,index:0,rect:{marginLeft:0,marginRight:0,marginTop:$.api.statusSize()+89,marginBottom:45},frames:t.bbsPageGroup},function(t,e){$.api.sendEvent("bbsSwitchNav",{index:t.index})})},t.prototype.listenerHeaderSwitchEvent=function(){$.api.listenerEvent("bbsSwitchGroup",function(t){$.api.switchPageIndex("bbsGroup",t.index,!0)})},t.prototype.changeBbsPageGroup=function(){var t=this;$.api.listenerEvent("changeBbsPageGroup",function(e){t.bbsPageGroup=e.pageGroup})},$.home=function(){return new t}}();
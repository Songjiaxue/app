"use strict";!function(){var t=function(){this.host="http://api.mlb.kfw001.com",this.md5="kfw001_com"};t.prototype.sendEvent=function(t,e){return!!t&&(e=e?e:"",void api.sendEvent({name:t,extra:e}))},t.prototype.listenerEvent=function(t,e){return!!t&&(e="function"==typeof e?e:function(){},void api.addEventListener({name:t},function(t){e(t.value)}))},t.prototype.statusSize=function(){var t=0,e=api.systemType,i=api.systemVersion;if("ios"==e){var o=parseInt(i,10),n=api.fullScreen,a=api.iOS7StatusBarAppearance;o>=7&&!n&&a&&(t=20)}return"android"==e&&(i=parseFloat(i),i>=4.4)?t=20:t},t.prototype.switchPageIndex=function(t,e,i){return!!t&&(e="number"==typeof e?e:0,void api.setFrameGroupIndex({name:t,index:e,scroll:i||!1}))},t.prototype.hidePageGroup=function(t){return!!t&&void api.setFrameGroupAttr({name:t,hidden:!0})},t.prototype.toast=function(t,e,i){return!!t&&void api.toast({msg:t,duration:e||2e3,location:i||"bottom"})},t.prototype.closeWin=function(t,e,i){return t?void api.closeWin({name:t}):api.closeWin()},t.prototype.scrolltobottom=function(t,e){return t=t||!0,e="function"==typeof e?e:function(){},t?void api.addEventListener({name:"scrolltobottom",extra:{threshold:30}},function(t,i){e(t,i)}):api.removeEventListener({name:"scrolltobottom"})},t.prototype.getPicture=function(t,e){api.getPicture({sourceType:t||"type",encodingType:"jpg",mediaValue:"pic",destinationType:"url",allowEdit:!0,quality:50,targetWidth:100,saveToPhotoAlbum:!1},function(t,i){e(t)})},$.api=new t}($||($={})),function(){var t=function(){};return t.prototype.call=function(t){return"undefined"!=typeof t.tel&&t.tel?void $.confirm("是否拨打电话？","确定致电： "+t.tel+" ?",function(e){return!!e&&void api.call({type:"tel",number:t.tel})}):$.api.toast("您拨打的电话是空号")},t.prototype.removeLaunch=function(){api.removeLaunchView({animation:{type:"fade",duration:500}})},t.prototype.closeWin=function(){$.api.closeWin()},t.prototype.openShareAction=function(){var t=$.shareAction();t.init().open(function(t,e,i){if(t)return!1;var o=$.qq();switch(o.init(),e){case 2:o.shareUrlToQFriend({},function(){$.api.toast("分享成功")});break;case 3:o.shareUrlToQZone({},function(){$.api.toast("分享成功")});break;default:$.api.toast("尚未完善，请期待下一个版本~~~")}})},t.prototype.openPhotoBrowser=function(t){var e=api.require("photoBrowser");e.open({images:t.images,placeholderImg:"widget://images/cover.jpg",bgColor:"#000"},function(i,o){if(t.images.length<=i.index+1)return $.api.toast("1秒后自动关闭"),setTimeout(function(){e.close()},1e3),!1})},t.prototype["switch"]=function(t,e,i){var o=this;switch(t){case"call":o.call(e);break;case"bbsSwitchGroup":$.homeBbs().sendEvent(e||0);break;case"openNewWin":$.openWin(e);break;case"closeWin":o.closeWin(e);break;case"openShareAction":o.openShareAction(e);break;case"qqLogin":$.userLogin().qqLogin();break;case"sendSMSCode":$.userCommon().sendSMSCode(t,e,i);break;case"openPhotoBrowser":o.openPhotoBrowser(e);break;case"deleteOrder":$.coinOrder()["delete"](e);break;default:$.api.toast(t+"这个事件没有被定义")}},$.app=new t}($||($={})),function(){var t=function(){this.welcome=localStorage.welcome,this.accessToken,this.init()};t.prototype.init=function(){var t=this;t.accessToken="undefined"==typeof t.welcome?"undefined":JSON.parse(localStorage.token),t._token(),$.main()},t.prototype._token=function(){var t=this;return"object"!=typeof t.accessToken?t._reset_token():"undefined"==typeof t.accessToken.token||"undefined"==typeof t.accessToken.expire?t._reset_token():!(t.accessToken.expire-3600>t._time())&&($.api.toast("用户信息失效，已经登出登陆"),t._reset_token())},t.prototype._reset_token=function(){var t=this;localStorage.token=JSON.stringify({token:0,expire:t._time()+2592e3,login:!1})},t.prototype._time=function(){return Math.round((new Date).getTime()/1e3)},$.init=function(){return new t}}(),function(){var t=function(){this.$container=$(".js-container"),this.$container.on("tap","[data-event]",function(){var t=$(this),e=t.data("event"),i=t.data("params")||!1;$.app["switch"](e,i,t)})};t.prototype.success=function(){var t=$[i]();t.init()},t.prototype.error=function(){$.api.toast("入口函数$."+i+"不存在")};var e=new t,i=$("body").data("main");return $.main=function(){return"function"==typeof $[i]?e.success():e.error()}}(),~function(){var t=function(){this.FNScanner=api.require("FNScanner"),this.w=(document.body.clientWidth-200)/2};return t.prototype.init=function(){var t=this;t.openView()},t.prototype.openView=function(){var t=this;t.FNScanner.openView({autorotation:!0},function(e,i){if(e.content)window.location.href=e.content,t.FNScanner.closeView();else{setTimeout("alert('扫描失败！')",2e4)}})},t.prototype.setFrame=function(){var t=this;t.FNScanner.setFrame({x:t.w,y:200,w:200,h:200})},$.scanner=function(){return new t}}(),~function(){var t=function(){this.token=JSON.parse(localStorage.token),this.$url="widget://html/address/address-item.html"};return t.prototype.init=function(){var t=this;t._open()},t.prototype._open=function(){var t=this;t.token.login||(t.$url="widget://html/common/not-login.html"),api.openFrame({name:"frame-address-item",url:t.$url,rect:{marginTop:65,marginBottom:0,marginLeft:0,marginRight:0},bounces:!0,bgColor:"#ededed",vScrollBarEnabled:!1,hScrollBarEnabled:!1})},$.address=function(){return new t}}(),~function(){var t=function(){this.id=api.pageParam.id,this.type=api.pageParam.type,this.page=1,this.size=10,this.pullRefresh=$.pullRefresh(),this.scroll=$.scroll(),this.$loadMore=$("._load-more"),this.$assess=$('[data-selector="details-assess"]')};return t.prototype.init=function(){this.main(),this.refresh()},t.prototype.main=function(){this.page=1,this.one()},t.prototype.refresh=function(){var t=this;t.pullRefresh.set(function(){t.main()})},t.prototype.one=function(){var t=this;t.scroll.removeListenerToBottom(),t.pullRefresh.close(),async.waterfall([function(e){t.ajax(e)},function(e,i){t.innerHtml(e,i)},function(e,i){t.iScroll(e,i)}],function(e){return $.echo(),e?$.api.toast(e):void(t.page+=1)})},t.prototype.iScroll=function(t,e){var i=this;return e=$.callback(e),!t.info.length||t.info.length<i.size?(i.$loadMore.text("后面没有了"),e()):(i.$loadMore.text("努力加载中"),i.scroll.addListenerToBottom(function(){i.one()}),void e())},t.prototype._itemHtml=function(t){var e="",i="undefined"!=typeof t.info&&t.info.length?t.info:[];return i.forEach(function(t){e+='<div class="lists-item"><div class="title"><div class="head" data-echo-background="',e+=t.avatar,e+='"></div><div class="nickname">',e+=t.nick,e+='</div></div><div class="desc">',e+=t.content,e+='</div><div class="end">',e+=t.ago,e+=" - 产品类型 : ",e+="积分商品",e+="</div></div>"}),e},t.prototype.innerHtml=function(t,e){var i=this;e=$.callback(e),1==i.page&&i.$assess.html(i._itemHtml(t)),1!=i.page&&i.$assess.append(i._itemHtml(t)),e(null,t)},t.prototype.ajax=function(t){var e=this;t=$.callback(t),$.ajax({url:"mall/point/comment",cache:!1,data:{goods_id:e.id,type:e.type,page:e.page,size:e.size}}).then(t)},$.assessItem=function(){return new t}}(),~function(){var t=function(){this.id=api.pageParam.id,this.$item=$('[data-selector="nav-item"]')};return t.prototype.init=function(){var t=this;t.openFrameGroup(),t.event()},t.prototype.event=function(){var t=this;t.$item.on("tap",function(){var t=$(this).index();$.api.switchPageIndex("coin-assess-group",t,!0)})},t.prototype.changeItem=function(t){var e=this;e.$item.eq(t).addClass("active").siblings("").removeClass("active")},t.prototype.openFrameGroup=function(){var t=this;api.openFrameGroup({name:"coin-assess-group",background:"#f2f2f2",scrollEnabled:!0,rect:{x:0,y:110},index:0,frames:[{name:"coin-assess-group-1",url:"widget://html/assess/assess-item.html",bgColor:"#ededed",customRefreshHeader:"UIPullRefresh",bounces:!0,vScrollBarEnabled:!1,hScrollBarEnabled:!1,pageParam:{type:0,id:t.id}},{name:"coin-assess-group-2",url:"widget://html/assess/assess-item.html",bgColor:"#ededed",customRefreshHeader:"UIPullRefresh",bounces:!0,vScrollBarEnabled:!1,hScrollBarEnabled:!1,pageParam:{type:1,id:t.id}},{name:"coin-assess-group-1",url:"widget://html/assess/assess-item.html",bgColor:"#ededed",customRefreshHeader:"UIPullRefresh",bounces:!0,vScrollBarEnabled:!1,hScrollBarEnabled:!1,pageParam:{type:2,id:t.id}},{name:"coin-assess-group-2",url:"widget://html/assess/assess-item.html",bgColor:"#ededed",customRefreshHeader:"UIPullRefresh",bounces:!0,vScrollBarEnabled:!1,hScrollBarEnabled:!1,pageParam:{type:3,id:t.id}}]},function(e,i){return!i&&void t.changeItem(e.index)})},$.assess=function(){return new t}}(),~function(){var t=function(){this.pullRefresh=$.pullRefresh(),this.SCROLL=$.scroll(),this.page=1,this.size=10,this.$htmlContent=$('[data-selector="html-content"]'),this.$loadMore=$("._load-more"),this.$login=$('[data-selector="login"]')};return t.prototype.init=function(){var t=this;t.refresh(),t._main()},t.prototype._main=function(){var t=this;t.page=1,t._one()},t.prototype._one=function(){var t=this;t.SCROLL.removeListenerToBottom(),t.pullRefresh.close(),async.waterfall([function(e){t._ajax(e)},function(e,i){t._append_html(e,i)},function(e,i){t._iScroll(e,i)}],function(e){return $.echo(),e?t._error(e):void(t.page+=1)})},t.prototype._error=function(t){var e=this;if($.api.toast(t),e.$loadMore.hide(),"object"!=typeof t)return!1;switch(parseInt(t.status)){case 1e4:e._login()}},t.prototype._login=function(){var t=this;t.$login.removeClass("hide")},t.prototype.refresh=function(){var t=this;t.pullRefresh.set(function(){t._main()})},t.prototype._iScroll=function(t,e){var i=this;return e=$.callback(e),!t.count||t.count<i.size?(i.$loadMore.show().text("到底啦"),e()):(i.$loadMore.show().text("努力加载中"),i.SCROLL.addListenerToBottom(function(){i._one()}),void e())},t.prototype._ajax=function(t){var e=this;t=$.callback(t),$.ajax({url:"member/bbs/comment",data:{page:e.page,column_id:api.pageParam.id||0,size:e.size||10}}).then(t)},t.prototype._html=function(t){var e=t.count?t.info:[],i="";return e.forEach(function(e){i+='<div class="main-item"><div class="head"><div class="head-avatar" data-echo-background="',i+=t.user.avatar,i+='"></div><div class="head-name">',i+=t.user.nick,i+='</div></div><div class="content"><div class="content-talk">',i+=e.comment||"",i+='</div><div class="content-link"><div class="content-link-in">',i+=e.content||"",i+='</div></div><div class="content-tool"><div class="content-tool-item">',i+=e.ago,i+='</div><div class="content-tool-item icon-love"></div></div></div></div>'}),i},t.prototype._append_html=function(t,e){var i=this,o=1==i.page?"html":"append";i.$htmlContent[o](i._html(t)),e(null,t)},$.bbsComment=function(){return new t}}(),~function(){var t=function(){this.nav=$(".nav-item"),this.title=$('[data-selector="title"]'),this.bbsPageGroup,this.detailsContext=$('[data-selector="details-context"]'),this.assessContext=$('[data-selector="assess-context"]'),this.emtionsBtn=$('[data-selector="emotions-btn"]'),this.emtionsTarget=$('[data-selector="emtions-target"]'),this.closeEdit=$('[data-selector="close-edit"]'),this.sendEdit=$('[data-selector="send-edit"]'),this.detailsEdit=$('[data-selector="details-edit"]'),this.openEditBox=$('[data-selector="open-edit-box"]'),this.emtions()};return t.prototype.init=function(){var t=this;async.waterfall([function(e){t.getArticleDetails(e)},function(e,i){t.htmlBbsDetails(e,i)}],function(e,i){return $.echo(),e?t.notFind():void t.assessMain()})},t.prototype.getArticleDetails=function(t){var e=api.pageParam.id;return t=$.callback(t),"undefined"==typeof e?t("id不存在"):void $.ajax({url:"sit"==api.pageParam.type?"bbs/topic/detail":"bbs/article/detail",data:"sit"==api.pageParam.type?{topic_id:e}:{article_id:e}}).then(t)},t.prototype.returnArticleHtml=function(t){var e="";return"sit"==api.pageParam.type?(e+='<div class="details-title"><div class="head" data-echo-background="',e+=t.avatar||"../../images/img.png",e+='"></div><div class="nickname">',e+=t.nick||"佚名",e+="</div></div>","undefined"!=typeof t.cover&&(e+='<div class="details-img"><div class="img-group"><div class="img-item" data-echo-background="',e+=t.cover,e+='"></div></div>',"undefined"!=typeof t.thumbs&&t.thumbs.length&&(e+='<div class="img-more" data-event="openPhotoBrowser" data-params=\'{"images":[',t.thumbs.forEach(function(t){e+='"',e+=t.path,e+='",'}),e+='"'+t.cover+'"',e+=']}\'><i class="icon-picture"></i><span>点击查看所有图片</span></div></div>')),e+='<div class="details-desc">',e+=t.content,e+='</div><div class="details-tools"><div class="details-tools-in"><div class="details-tools-left"><div class="details-tools-time">',e+=t.ago||"冰河世纪",e+='</div><div class="details-tools-report">举报</div></div><div class="details-tools-right"><div class="details-tools-love"><span>(',e+=t.good||0,e+=')</span></div><div class="details-tools-share"><i class="icon-love"></i></div></div></div></div>'):(e+='<div class="details-title"><div class="nickname">',e+=t.title,e+='</div></div><div class="details-author"><div class="time">',e+="作者:",e+='</div><div class="name">',e+=t.writer||"佚名",e+='</div></div><div class="details-img pr">',e+=t.content,e+='</div><div class="details-tools"><div class="details-tools-in"><div class="details-tools-left"><div class="details-tools-time">',e+=t.ago,e+='</div><div class="details-tools-report">举报</div></div><div class="details-tools-right"><div class="details-tools-love"><span>(',e+=t.good,e+=')</span></div><div class="details-tools-share"><i class="icon-love"></i></div></div></div></div>'),e},t.prototype.htmlBbsDetails=function(t,e){var i=this;i.detailsContext.html(i.returnArticleHtml(t)),e(null,t)},t.prototype.assessMain=function(){var t=this;$.api.scrolltobottom(!1),async.waterfall([function(e){t.getAssessData(e)},function(e,i){return t.page-1?void t.appendAssess(e,i):t.htmlAssess(e,i)}],function(e,i){return $.echo(),i.count<t.size?t.appendNotFind():void $.api.scrolltobottom(!0,function(){t.page+=1,t.assessMain()})})},t.prototype.getAssessData=function(t){var e=this,i=api.pageParam.id;t=$.callback(t),$.ajax({url:"sit"==api.pageParam.type?"bbs/topic/comment":"bbs/article/comment",data:"sit"==api.pageParam.type?{topic_id:i,page:e.page||1}:{article_id:i,page:e.page||1},cache:!1}).then(t)},t.prototype.htmlAssess=function(t,e){var i=this;i.assessContext.html(i.assessItemHtml(t)),e(null,t)},t.prototype.appendAssess=function(t,e){var i=this;i.assessContext.append(i.assessItemHtml(t)),e(null,t)},t.prototype.assessItemHtml=function(t){var e="";return t=t.info||[],t.forEach(function(t,i){e+='<div class="details-assess-item"><div class="assess-title"><div class="head" data-echo-background="',e+=t.avatar||"../../images/img.png",e+='"></div><div class="nickname">',e+=t.nick,e+='</div><div class="report">投诉</div></div><div class="assess-desc">',e+=t.content?AnalyticEmotion(t.content):t.content,e+='</div><div class="assess-time">',e+=t.ago||"冰河世纪",e+="</div></div>"}),"undefined"!=typeof t&&t.length||(e='<div class="details-assess-no"></div>'),e},t.prototype.appendNotFind=function(t){return t?void this.load.html('<i class="icon-spin3 animate-spin"></i>'):this.load.html("后面没有了")},t.prototype.notFind=function(){this._undefined.show()},t.prototype.emtions=function(){var t=this;t.emtionsBtn.SinaEmotion(t.emtionsTarget),t.openEditBox.on("tap",function(){alert("openEditBox"),t.edittarget()}),t.closeEdit.on("tap",function(){t.edittarget()}),t.sendEdit.on("tap",function(){t.sendTalk()})},t.prototype.edittarget=function(){var t=this;return t.detailsEdit.hasClass("show")?void t.detailsEdit.removeClass("show"):t.detailsEdit.addClass("show")},t.prototype.sendTalk=function(){var t=this,e=t.emtionsTarget.val(),i=api.pageParam.id;return e?void $.ajax({url:"sit"==api.pageParam.type?"bbs/topic/talk":"bbs/article/talk",data:"sit"==api.pageParam.type?{topic_id:i,content:e}:{article_id:i,content:e},success:function(e){alert(e.msg),t.edittarget()},error:function(t){$.api.toast(t)}}):$.alert("您没有输入任何内容")},$.bbsDetails=function(){return new t}}(),~function(){var t=function(){};return t.prototype.init=function(){},$.bbsEdit=function(){return new t}}(),~function(){var t=function(){this.pullRefresh=$.pullRefresh(),this.SCROLL=$.scroll(),this.TOAST=$.toast(),this.page=1,this.size=10,this.$htmlContent=$('[data-selector="html-content"]'),this.$loadMore=$("._load-more"),this.$login=$('[data-selector="login"]')};return t.prototype.init=function(){var t=this;t.refresh(),t._main()},t.prototype._main=function(){var t=this;t.page=1,t._one()},t.prototype._one=function(){var t=this;t.SCROLL.removeListenerToBottom(),t.pullRefresh.close(),async.waterfall([function(e){t._ajax(e)},function(e,i){t._append_html(e,i)},function(e,i){t._iScroll(e,i)}],function(e){return $.echo(),t._end(),e?t._error(e):void(t.page+=1)})},t.prototype._error=function(t){var e=this;if($.api.toast(t),e.$loadMore.hide(),"object"!=typeof t)return!1;switch(parseInt(t.status)){case 1e4:e._login()}},t.prototype._login=function(){var t=this;t.$login.removeClass("hide")},t.prototype.refresh=function(){var t=this;t.pullRefresh.set(function(){t._main()})},t.prototype._iScroll=function(t,e){var i=this;return e=$.callback(e),!t.count||t.count<i.size?(i.$loadMore.show().text("到底啦"),e()):(i.$loadMore.show().text("努力加载中"),i.SCROLL.addListenerToBottom(function(){i._one()}),void e())},t.prototype._ajax=function(t){var e=this;t=$.callback(t),$.ajax({url:"member/bbs/zan",data:{page:e.page,column_id:api.pageParam.id||0,size:e.size||10}}).then(t)},t.prototype._html=function(t){var e=t.count?t.info:[],i="";return e.forEach(function(e){i+='<div class="main-item"><div class="head"><div class="head-avatar" data-echo-background="',i+=t.user.avatar,i+='"></div><div class="head-name">',i+=t.user.nick,i+='</div></div><div class="content"><div class="content-talk">',i+=e.comment||"",i+='</div><div class="content-link"><div class="content-link-in">',i+=e.content||"",i+='</div></div><div class="content-tool"><div class="content-tool-item">',i+=e.ago,i+='</div><div class="content-tool-item icon-love"></div></div></div></div>'}),i},t.prototype._append_html=function(t,e){var i=this,o=1==i.page?"html":"append";i.$htmlContent[o](i._html(t)),e(null,t)},t.prototype._end=function(){var t=this;setTimeout(function(){t.TOAST.load().Progress()},500)},$.bbsLaud=function(){return new t}}(),~function(){var t=function(){this.pullRefresh=$.pullRefresh(),this.SCROLL=$.scroll(),this.page=1,this.size=10,this.$htmlContent=$('[data-selector="html-content"]'),this.$loadMore=$("._load-more"),this.$login=$('[data-selector="login"]')};t.prototype.init=function(){var t=this;t.refresh(),t._main()},t.prototype._main=function(){var t=this;t.page=1,t._one()},t.prototype._one=function(){var t=this;t.SCROLL.removeListenerToBottom(),t.pullRefresh.close(),async.waterfall([function(e){t._ajax(e)},function(e,i){t._append_html(e,i)},function(e,i){t._iScroll(e,i)}],function(e){return $.echo(),e?t._error(e):void(t.page+=1)})},t.prototype._error=function(t){var e=this;if($.api.toast(t),e.$loadMore.hide(),"object"!=typeof t)return!1;switch(parseInt(t.status)){case 1e4:e._login()}},t.prototype._login=function(){var t=this;t.$login.removeClass("hide")},t.prototype.refresh=function(){var t=this;t.pullRefresh.set(function(){t._main()})},t.prototype._iScroll=function(t,e){var i=this;return e=$.callback(e),!t.count||t.count<i.size?(i.$loadMore.show().text("到底啦"),e()):(i.$loadMore.show().text("努力加载中"),i.SCROLL.addListenerToBottom(function(){i._one()}),void e())},t.prototype._ajax=function(t){var e=this;t=$.callback(t),$.ajax({url:"member/bbs/topic",data:{page:e.page,column_id:api.pageParam.id||0,size:e.size||10}}).then(t)},t.prototype._html=function(t){t=t.count?t.info:[];var e="";return t.forEach(function(t){e+='<div class="list-item"',e+=' data-event="openNewWin" data-params=\'{"name":"win_bbs_details","param":{"id":"',e+=t.id,e+='","type":"sit"}}\'><div class="list-item-head"><div class="head-left" data-echo-background="',e+=t.avatar,e+='"></div><div class="head-right">',e+=t.nick,e+='</div></div><div class="list-item-content"><div class="content-top">',e+=t.content,e+="</div>",t.cover&&(e+='<div class="content-center" data-echo-background="',e+=t.cover,e+='"></div>'),e+='<div class="content-bottom"><div class="content-bottom-left">',e+=t.ago,e+='</div><div class="content-bottom-right"><div class="right-item"><div class="icon icon-love"></div><div class="text">赞</div></div><div class="right-item">',e+='<div class="icon icon-talk"></div><div class="text">评论</div></div></div></div></div></div>'}),e},t.prototype._append_html=function(t,e){var i=this,o=1==i.page?"html":"append";i.$htmlContent[o](i._html(t)),e(null,t)},$.bbsMy=function(){return new t}}(),~function(){var t=function(){this.pullRefresh=$.pullRefresh(),this.SCROLL=$.scroll(),this.page=1,this.size=10,this.$htmlContent=$('[data-selector="html-content"]'),this.$loadMore=$("._load-more"),this.$toast=$("._toast")};t.prototype.init=function(){var t=this;t.refresh(),t._main()},t.prototype._main=function(){var t=this;t.page=1,t._one()},t.prototype._one=function(){var t=this;t.SCROLL.removeListenerToBottom(),t.pullRefresh.close(),async.waterfall([function(e){t._ajax(e)},function(e,i){t._append_html(e,i)},function(e,i){t._iScroll(e,i)}],function(e){return $.echo(),t._end(),e?$.api.toast(e):void(t.page+=1)})},t.prototype.refresh=function(){var t=this;t.pullRefresh.set(function(){t._main()})},t.prototype._iScroll=function(t,e){var i=this;return e=$.callback(e),!t.count||t.count<i.size?(i.$loadMore.text("到底啦"),e()):(i.$loadMore.text("努力加载中"),i.SCROLL.addListenerToBottom(function(){i._one()}),void e())},t.prototype._ajax=function(t){var e=this;t=$.callback(t),$.ajax({url:"bbs/article/list",data:{page:e.page,column_id:api.pageParam.id||0,size:e.size||10}}).then(t)},t.prototype._html=function(t){t=t.info||[];var e=this,i="";return t.forEach(function(t,o){i+='<div class="lists-item ',e.page-1&&(i+="animated fadeIn"),i+='" data-event="openNewWin" data-params=\'{"name":"',i+=t.is_link?"win_url":"win_bbs_details",i+='","param":{"url":"',i+=t.link,i+='","id":"',i+=t.id,i+='","type":"official"}}\'><div class="lists-head"><div class="head" data-echo-background="',i+=t.head||"../../images/img.png",i+='"></div><div class="nickname">',i+=t.writer,i+='</div></div><div class="lists-img" data-echo-background="',i+=t.thumb,i+='"></div><div class="lists-desc">',i+=t.description,i+='</div><div class="lists-tools"><div class="tools-group"><div class="tools-item">',i+=t.ago||"冰河世纪",i+='</div></div><div class="tools-group"><div class="tools-item"><div class="icon icon-share"></div></div><div class="tools-item ml15"><div class="icon icon-love "></div>',i+='<div class="pink">（',i+=t.good||"0",i+='）</div></div></div></div><div class="lists-review">',i+='<div class="review-warp"><div class="review-icon icon-mes"></div><div class="review-context">',t.comment=t.comment||[],t.comment.forEach(function(t){i+='<div class="review-item">',i+=t.nick+" : "+t.content,i+="</div> "}),i+='<div class="review-item">查看全部评论（',i+=t.comment_count||"0",i+="）</div></div></div></div></div>"}),i},t.prototype._append_html=function(t,e){var i=this,o=1==i.page?"html":"append";i.$htmlContent[o](i._html(t)),e(null,t)},t.prototype._end=function(){var t=this;setTimeout(function(){t.$toast.hide().siblings("._main").addClass("show")},500)},$.bbsOfficial=function(){return new t}}(),~function(){var t=function(){this.pullRefresh=$.pullRefresh(),this.SCROLL=$.scroll(),this.page=1,this.size=10,this.$htmlContent=$('[data-selector="html-content"]'),this.$loadMore=$("._load-more"),this.$toast=$("._toast")};t.prototype.init=function(){var t=this;t.refresh(),t._main()},t.prototype._main=function(){var t=this;t.page=1,t._one()},t.prototype._one=function(){var t=this;t.SCROLL.removeListenerToBottom(),t.pullRefresh.close(),async.waterfall([function(e){t._ajax(e)},function(e,i){t._append_html(e,i)},function(e,i){t._iScroll(e,i)}],function(e){$.echo(),t._end(),e||(t.page+=1)})},t.prototype.refresh=function(){var t=this;t.pullRefresh.set(function(){t._main()})},t.prototype._iScroll=function(t,e){var i=this;return e=$.callback(e),!t.count||t.count<i.size?(i.$loadMore.text("到底啦"),e()):(i.$loadMore.text("努力加载中"),i.SCROLL.addListenerToBottom(function(){i._one()}),void e())},t.prototype._ajax=function(t){var e=this;t=$.callback(t),$.ajax({url:"bbs/topic/list",data:{page:e.page,column_id:api.pageParam.id||0,size:e.size||10}}).then(t)},t.prototype._html=function(t){t=t.count?t.info:[];var e="";return t.forEach(function(t){e+='<div class="list-item"',e+=' data-event="openNewWin" data-params=\'{"name":"win_bbs_details","param":{"id":"',e+=t.id,e+='","type":"sit"}}\'><div class="list-item-head"><div class="head-left" data-echo-background="',e+=t.avatar,e+='"></div><div class="head-right">',e+=t.nick,e+='</div></div><div class="list-item-content"><div class="content-top">',e+=t.content,e+="</div>",t.cover&&(e+='<div class="content-center" data-echo-background="',e+=t.cover,e+='"></div>'),e+='<div class="content-bottom"><div class="content-bottom-left">',e+=t.ago,e+='</div><div class="content-bottom-right"><div class="right-item"><div class="icon icon-love"></div><div class="text">赞</div></div><div class="right-item">',e+='<div class="icon icon-talk"></div><div class="text">评论</div></div></div></div></div></div>'}),e},t.prototype._append_html=function(t,e){var i=this,o=1==i.page?"html":"append";i.$htmlContent[o](i._html(t)),e(null,t)},t.prototype._end=function(){var t=this;setTimeout(function(){t.$toast.hide().siblings("._main").addClass("show")},500)},$.bbsOther=function(){return new t}}(),~function(){var t=function(){this.$data=api.pageParam,this.$url="bbs/Article/column",this.$headerItem=$('[data-selector="header-item"]'),this.$nav=$('[data-selector="nav"]'),this.$indexNav=$('[data-selector="index-nav"]'),this.$personalNav=$('[data-selector="personal-nav"]')};t.prototype.init=function(){var t=this;t._main()},t.prototype._main=function(){var t=this;async.waterfall([function(e){t._append_column(e)}],function(){t._event()})},t.prototype._event=function(){var t=this;t.$indexNav.find(".nav-item").on("click",function(){var e=$(this),i=e.data("index");t._switch_bbs_group_index(!1,i)}),t.$personalNav.find(".nav-item").on("click",function(){var e=$(this),i=e.data("index");t._switch_bbs_group_index(!0,i)}),t._listener_switch_home_bbs_group(),t.$headerItem.on("click",function(){var e=$(this),i=e.index();return t._switch_bbs_header(e,i)})},t.prototype._switch_bbs_header=function(t,e){var i=this;e?i._switch_bbs_group_index(!0,i.$personalNav.find('.nav-item[class*="active"]').index()):i._switch_bbs_group_index(!1,i.$indexNav.find('.nav-item[class*="active"]').index())},t.prototype._switch_bbs_group_index=function(t,e){var i=this;t&&(e+=i.$data.info.length),$.api.switchPageIndex("home-bbs-group",e,!0)},t.prototype._listener_switch_home_bbs_group=function(){var t=this;$.api.listenerEvent("_event_switch_home_bbs_group",function(e){return e.index>=t.$data.count?t._switch_bbs_nav(t.$personalNav,e.index-t.$data.count,1):t._switch_bbs_nav(t.$indexNav,e.index,0)})},t.prototype._switch_bbs_nav=function(t,e,i){var o=this;o.$nav.eq(i).addClass("show").siblings().removeClass("show"),o.$headerItem.eq(i).addClass("active").siblings().removeClass("active"),t.find(".nav-item").eq(e).addClass("active").siblings().removeClass("active")},t.prototype.ajax=function(t){var e=this;t="function"==typeof t?t:function(){},$.ajax({url:e.$url}).then(function(i,o){return i?t(null,e._get_cache()):(e._cache(o),void t(i,o))})},t.prototype._column_html=function(){var t=this,e="";return t.$data.info.forEach(function(t,i){e+=0==i?'<div class="nav-item active" data-index="':'<div class="nav-item" data-index="',e+=i,e+='">',e+=t.name,e+="</div>"}),e},t.prototype._append_column=function(t){var e=this;t=$.callback(t),e.$indexNav.html(e._column_html()),t()},t.prototype.set_bbs_page_group=function(t){var e=[];return t.info.forEach(function(t,i){e.push({name:"frame-bbs-official-"+i,url:"widget://html/bbs/bbs-official.html",pageParam:{id:t.id},bounces:!0,bgColor:"#ededed",vScrollBarEnabled:!1,hScrollBarEnabled:!1,customRefreshHeader:"UIPullRefresh"})}),e.push({name:"frame-bbs-other-1",url:"widget://html/bbs/bbs-other.html",bounces:!0,bgColor:"#ededed",vScrollBarEnabled:!1,hScrollBarEnabled:!1,customRefreshHeader:"UIPullRefresh"}),e.push({name:"frame-bbs-my",url:"widget://html/bbs/bbs-my.html",bounces:!0,bgColor:"#ededed",vScrollBarEnabled:!1,hScrollBarEnabled:!1,customRefreshHeader:"UIPullRefresh"}),e.push({name:"frame-bbs-laud",url:"widget://html/bbs/bbs-laud.html",bounces:!0,bgColor:"#ededed",vScrollBarEnabled:!1,hScrollBarEnabled:!1,customRefreshHeader:"UIPullRefresh"}),e.push({name:"frame-bbs-comment",url:"widget://html/bbs/bbs-comment.html",bounces:!0,bgColor:"#ededed",vScrollBarEnabled:!1,hScrollBarEnabled:!1,customRefreshHeader:"UIPullRefresh"}),e},t.prototype._cache=function(t){localStorage.homeBBs=JSON.stringify(t)},t.prototype._get_cache=function(){return"undefined"==typeof localStorage.homeBBs&&(localStorage.homeBBs=JSON.stringify({info:[{id:0,name:"全部"}]})),JSON.parse(localStorage.homeBBs)},$.homeBbs=function(){return new t}}(),~function(){var t=function(){this.id=api.pageParam.id,this.shop_id=api.pageParam.shop_id||"undefined",this.wrap=$(".main.index")};return t.prototype.init=function(){var t=this;t.main()},t.prototype.main=function(){var t=this;async.waterfall([function(e){t.ajax(e)},function(e,i){t.setHtml(e,i)}],function(e,i){t.swipe()})},t.prototype.swipe=function(){$.app.swipe()},t.prototype.setHtml=function(t,e){var i=this,o="";o+=i._swipeHtml(t),o+=i._titleHtml(t),o+=i._tagHtml(t),o+=i._inforHtml(t),o+=i._assessHtml(t),o+=i._footerHtml(t),e(null,i.wrap.append(o))},t.prototype._swipeHtml=function(t){var e="",i=t.data;return"undefined"!=typeof i.thumb_url&&i.thumb_url.length?(e+='<div class="banner"><div class="banner-warp js-slider swipe"><div class="banner-group swipe-wrap">',i.thumb_url.forEach(function(t){e+='<div class="banner-item" style="background-image: url(\'',e+=t.path||0,e+="')\"></div>"}),e+="</div></div></div>"):'<div class="banner"><div class="banner-warp js-slider swipe"><div class="banner-group swipe-wrap"><div class="banner-item" style="background-image: url(\'../../images/info-banner.jpg\')"></div></div> </div> </div>'},t.prototype._titleHtml=function(t){var e=t.data,i="";return i+='<div class="details-title"><div class="price fl">¥ ',i+=e.offer_money||"",i+='</div><div class="price old fl">¥ ',i+=e.original_price||"",i+='</div><div class="price over fl">已售',i+=e.sales||0,i+="件</div></div>",i+='<div class="cargo-title">',i+=e.title||"",i+="</div>"},t.prototype._tagHtml=function(t){var e=t.data,i="";return i+='<div class="ui-tool-wrap"><div class="ui-tool"><div class="ui-tool-in clamp">美乐吧承诺：一旦发现商家宰客、欺客，经查明属实，将直接返现金2000元</div></div></div>',e.is_new||e.is_hot?(i+='<div class="ui-tool-wrap"><div class="ui-tool icon-gt border"><div class="ui-tool-in">',i+='<div class="ui-tool-group">',i+=e.is_new?'<div class="ui-tool-item"><div class="ui-tool-icon">新</div><div class="ui-tool-desc">新品推荐 </div></div>':"",i+=e.is_hot?'<div class="ui-tool-item"><div class="ui-tool-icon">热</div><div class="ui-tool-desc">热卖产品</div></div>':"",i+="</div></div></div></div>"):i},t.prototype._inforHtml=function(t){var e=t.data,i="";return"undefined"==typeof e.content?i:(i+='<div class="ui-tool-wrap"><div class="ui-tool icon-gt border"><div class="ui-tool-in"><div class="ui-tool-group">',i+='<div class="ui-tool-item"><div class="ui-tool-desc">详情</div></div></div></div></div>',i+='<div class="ui-tool-infor"><div class="ui-tool-infor-in">',i+=e.content||"",i+="</div></div></div>")},t.prototype._assessHtml=function(t){var e=t.data,i="";return"undefined"==e.comment?i:(i+='<div class="ui-tool-wrap" data-event="openNewWin" data-params=\'{"name":"win_coin_assess","param":{"id":"',i+=e.id,i+='"}}\'><div class="ui-tool icon-gt border"><div class="ui-tool-in"><div class="ui-tool-group">',i+='<div class="ui-tool-item"><div class="ui-tool-desc">宝贝评价（',i+=e.comment.length||0,i+="）</div></div></div></div></div>",e.comment.length?(i+='<div class="main assess"><div class="lists"><div class="lists-group">',e.comment.forEach(function(t){i+='<div class="lists-item"><div class="title"><div class="head" data-echo-background="',
i+=t.avatar,i+='"></div><div class="nickname">',i+=t.nick||"佚名",i+='</div></div><div class="desc">',i+=t.content,i+="</div>",i+='<div class="end">',i+=t.ago,i+="</div></div>"}),i+="</div></div></div>",i+="</div>"):i+="</div>")},t.prototype._footerHtml=function(t){var e=this,i=t.data,o="";return o+='<div class="footer"><div class="footer-group"><div class="footer-item" data-event="',o+=e.shop_id!==i.shop_id?"closeWin":"openNewWin",o+='" data-params=\'{"name":"win_beauty_home","param":{"id","',o+=i.shop_id,o+='"}}\'><div class="icon icon-cargo-home"></div><p>店铺</p></div>',o+='<div class="footer-item"><div class="icon icon-cargo-share"></div><p>分享</p></div>',o+='<div class="footer-item" data-event="call" data-params=\'{"tel","+8613082807225"}\'><div class="icon icon-coin-tel"></div><p>联系</p></div>',o+='<div class="footer-item" data-event="openNewWin" data-params=\'{"name":"',o+=1==i.type?"win_beauty_create_order":3==i.type?"win_item_create_order":"win_coin_create_order",o+='","param":{"id":"',o+=i.id,o+='","shop_id":"',o+=i.shop_id,o+="\"}}'>立即购买</div></div></div>"},t.prototype.ajax=function(t){var e=this;t=$.callback(t),$.ajax({url:"mall/goods/detail",data:{goods_id:e.id},cache:!1}).then(t)},$.beautyDetails=function(){return new t}}(),~function(){var t=function(){this.id=api.pageParam.id,this.$shopAds=$('[data-selector="shop-ads"]'),this.$item=$('[data-selector="item"]'),this.$goods=$('[data-selector="goods"]')};return t.prototype.init=function(){var t=this;t.ads(),t.mian()},t.prototype.mian=function(){var t=this;t._item(),t._goods()},t.prototype._item=function(){var t=this;async.waterfall([function(e){t.append_item(api.pageParam.item,e)}],function(e){return e?(t.$item.remove(),void t.$item.next('[class*="-title"]').remove()):$.echo()})},t.prototype.html=function(t){var e=this,i="";return t.forEach(function(t,o){return!(o>1)&&(i+='<div class="exhibit-item" data-event="openNewWin" data-params=\'{"name":"win_beauty_details","param":{"id":"',i+=t.id,i+='","shop_id":"',i+=e.id,i+='"}}\'><div class="img" data-echo-background="',i+=t.thumb,void(i+='"></div></div>'))}),i},t.prototype.append_item=function(t,e){var i=this;return e=$.callback(e),"undefined"!=typeof t&&t.length?(i.$item.html(i.html(t)),void e()):e("数据不存在")},t.prototype._goods=function(){var t=this;async.waterfall([function(e){t.append_goods(api.pageParam.goods,e)}],function(e,i){return e?(t.$item.remove(),void t.$item.next('[class*="-title"]').remove()):$.echo()})},t.prototype.append_goods=function(t,e){var i=this;return e=$.callback(e),"undefined"!=typeof t&&t.length?(i.$goods.html(i.html(t)),void e()):e("数据不存在")},t.prototype.ads=function(){var t=this;async.waterfall([function(e){t.ajax_shop_ads(e)},function(e,i){t.changeShopAds(e,i)}],function(e,i){return e?t.$shopAds.remove():void $.echo()})},t.prototype.ajax_shop_ads=function(t){var e=this;t=$.callback(t),$.ajax({url:"ads/index/shop",data:{id:e.is}}).then(t)},t.prototype.changeShopAds=function(t,e){var i=this;return e=$.callback(e),"undefined"!=typeof t.data&&"undefined"!=typeof t.data.info&&t.data.info.length?(i.$shopAds.attr("data-echo-background",t.data.info[0].thumb),void e()):e("数据不存在")},$.beautyHomeIndex=function(){return new t}}(),~function(){var t=function(){this.id=api.pageParam.id};return t.prototype.init=function(){},$.beautyHomeService=function(){return new t}}(),~function(){var t=function(){this.size=10,this.page=1,this.zone_id="",this.$loadMore=$("._load-more"),this.pullRefresh=$.pullRefresh(),this.homeIndex=$.homeIndex(),this.scroll=$.scroll()};return t.prototype.init=function(){this.main(),this.refresh()},t.prototype.main=function(){var t=this;t.page=1,t.one()},t.prototype.refresh=function(){var t=this;t.pullRefresh.set(function(){t.main()})},t.prototype.one=function(){var t=this;t.pullRefresh.close(),t.scroll.removeListenerToBottom(),async.waterfall([function(e){t.ajax(e)},function(e,i){t.homeIndex.beauty_html(e,i)},function(e,i){t.iScroll(e,i)}],function(e,i){return $.echo(),e?$.api.toast(e):void(t.page+=1)})},t.prototype.iScroll=function(t,e){var i=this;return e=$.callback(e),!t.data.info.length||t.data.info.length<i.size?(i.$loadMore.text("后面没有了"),e()):(i.$loadMore.text("努力加载中"),i.scroll.addListenerToBottom(function(){i.one()}),void e())},t.prototype.ajax=function(t){var e=this,i=JSON.parse(localStorage.city);t=$.callback(t),$.ajax({url:"mall/shop/list",data:$.extend({},"object"==typeof i?{longitude:i.lon,latitude:i.lat,city_id:i.city.id}:{longitude:0,latitude:0,city_id:0},{page:e.page,size:e.size,zone_id:e.zone_id})}).then(t)},$.beautyIndex=function(){return new t}}(),~function(){var t=function(){};return t.prototype.init=function(){},$.homeBeauty=function(){return new t}}(),~function(){var t=function(){this.$data=api.pageParam,this.$url="mall/point/detail",this.$html=$('[data-selector="html-content"]'),this.$tools=$('[data-selector="tools"]')};return t.prototype.init=function(){var t=this;t._main()},t.prototype._main=function(){var t=this;async.waterfall([function(e){t._ajax(e)},function(e,i){t._append_html(e,i)}],function(e,i){t._swipe(),t._event()})},t.prototype._event=function(){var t=this,e=$(window);e.on("scroll",function(){var i=e.scrollTop(),o=.75-i/200;t.$tools.css("opacity",o)})},t.prototype._swipe=function(){new Swipe($(".js-slider")[0],{startSlide:0,speed:400,auto:3e3,continuous:!0,disableScroll:!1,stopPropagation:!1})},t.prototype._append_html=function(t,e){var i=this,o="";o+=i._swipe_html(t),o+=i._title_html(t),o+=i._tag_html(t),o+=i._info_html(t),o+=i._assess_html(t),o+=i._footer_html(t),e(null,i.$html.append(o))},t.prototype._swipe_html=function(t){var e="";return"undefined"!=typeof t.thumb_url&&t.thumb_url.length?(e+='<div class="banner"><div class="banner-warp js-slider swipe"><div class="banner-group swipe-wrap">',t.thumb_url.forEach(function(t){e+='<div class="banner-item" style="background-image: url(\'',e+=t.path||"",e+="')\"></div>"}),e+="</div></div></div>"):'<div class="banner"><div class="banner-warp js-slider swipe"><div class="banner-group swipe-wrap"><div class="banner-item" style="background-image: url(\'../../images/info-banner.jpg\')"></div></div> </div> </div>'},t.prototype._title_html=function(t){var e="";return e+='<div class="details-title"><div class="price fl">¥ ',e+=t.offer_money||"100000",e+='</div><div class="price old fl">¥ ',e+=t.original_price||"10000",e+='</div><div class="price over fl">已售',e+=t.sales||0,e+="件</div></div>",e+='<div class="cargo-title">',e+=t.title||"",e+="</div>"},t.prototype._tag_html=function(t){var e="";return e+='<div class="ui-tool-wrap"><div class="ui-tool"><div class="ui-tool-in clamp">美乐吧承诺：一旦发现商家宰客、欺客，经查明属实，将直接返现金2000元</div></div></div>',t.is_new||t.is_hot?(e+='<div class="ui-tool-wrap"><div class="ui-tool icon-gt border"><div class="ui-tool-in">',e+='<div class="ui-tool-group">',e+=t.is_new?'<div class="ui-tool-item"><div class="ui-tool-icon">新</div><div class="ui-tool-desc">新品推荐 </div></div>':"",e+=t.is_hot?'<div class="ui-tool-item"><div class="ui-tool-icon">热</div><div class="ui-tool-desc">热卖产品</div></div>':"",e+="</div></div></div></div>"):e},t.prototype._info_html=function(t){var e="";return"undefined"==typeof t.content?e:(e+='<div class="ui-tool-wrap"><div class="ui-tool border icon-gt"><div class="ui-tool-in"><div class="ui-tool-group"><div class="ui-tool-item"><div class="ui-tool-desc">',e+="详情",e+='</div></div></div></div></div><div class="ui-tool-infor"><div class="ui-tool-infor">',e+=t.content,e+="</div></div></div>")},t.prototype._assess_html=function(t){var e="";return"undefined"!=t.comment&&t.comment.length?(e+='<div class="ui-tool-wrap" data-event="openNewWin" data-params=\'{"name":"win_assess","param":{"id":"',e+=t.id,e+='"}}\'><div class="ui-tool icon-gt border"><div class="ui-tool-in"><div class="ui-tool-group">',e+='<div class="ui-tool-item"><div class="ui-tool-desc">宝贝评价（',e+=t.comment.length||0,e+="）</div></div></div></div></div>",t.comment.length?(e+='<div class="main assess"><div class="lists"><div class="lists-group">',t.comment.forEach(function(t){e+='<div class="lists-item"><div class="title"><div class="head" data-echo-background="',e+=t.avatar,e+='"></div><div class="nickname">',e+=t.nick||"佚名",e+='</div></div><div class="desc">',e+=t.content,e+="</div>",e+='<div class="end">',e+=t.ago,e+="</div></div>"}),e+="</div></div></div>",e+="</div>"):e+="</div>"):e},t.prototype._footer_html=function(t){var e=this,i="";return i+='<div class="footer"><div class="footer-group"><div class="footer-item" data-event="',i+=e.$data.shop_id!==t.shop_id?"closeWin":"openNewWin",i+='" data-params=\'{"name":"win_beauty_home","param":{"id","',i+=t.shop_id,i+='"}}\'><div class="icon icon-cargo-home"></div><p>店铺</p></div>',i+='<div class="footer-item"><div class="icon icon-cargo-share"></div><p>分享</p></div>',i+='<div class="footer-item" data-event="call" data-params=\'{"tel","+8613082807225"}\'><div class="icon icon-coin-tel"></div><p>联系</p></div>',i+='<div class="footer-item" data-event="openNewWin" data-params=\'{"name":"win_coin_order","param":{"id":"',i+=t.id,i+='","shop_id":"',i+=t.shop_id,i+="\"}}'>立即购买</div></div></div>"},t.prototype._ajax=function(t){var e=this;t=$.callback(t),$.ajax({url:e.$url,data:{goods_id:e.$data.id},cache:!1}).then(t)},$.cargoCoin=function(){return new t}}(),~function(){var t=function(){this.$data=api.pageParam,this.$url="mall/goods/detail",this.$html=$('[data-selector="html-content"]'),this.$tools=$('[data-selector="tools"]')};return t.prototype.init=function(){var t=this;t._main()},t.prototype._main=function(){var t=this;async.waterfall([function(e){t._ajax(e)},function(e,i){t._append_html(e,i)}],function(e,i){t._swipe(),t._event()})},t.prototype._event=function(){var t=this,e=$(window);e.on("scroll",function(){var i=e.scrollTop(),o=.75-i/200;t.$tools.css("opacity",o)})},t.prototype._swipe=function(){new Swipe($(".js-slider")[0],{startSlide:0,speed:400,auto:3e3,continuous:!0,disableScroll:!1,stopPropagation:!1})},t.prototype._append_html=function(t,e){var i=this,o="";o+=i._swipe_html(t),o+=i._title_html(t),o+=i._tag_html(t),o+=i._info_html(t),o+=i._assess_html(t),o+=i._footer_html(t),e(null,i.$html.append(o))},t.prototype._swipe_html=function(t){var e="";return"undefined"!=typeof t.thumb_url&&t.thumb_url.length?(e+='<div class="banner"><div class="banner-warp js-slider swipe"><div class="banner-group swipe-wrap">',t.thumb_url.forEach(function(t){e+='<div class="banner-item" style="background-image: url(\'',e+=t.path||"",e+="')\"></div>"}),e+="</div></div></div>"):'<div class="banner"><div class="banner-warp js-slider swipe"><div class="banner-group swipe-wrap"><div class="banner-item" style="background-image: url(\'../../images/info-banner.jpg\')"></div></div> </div> </div>'},t.prototype._title_html=function(t){var e="";return e+='<div class="details-title"><div class="price fl">¥ ',e+=t.offer_money||"100000",e+='</div><div class="price old fl">¥ ',e+=t.original_price||"10000",e+='</div><div class="price over fl">已售',e+=t.sales||0,e+="件</div></div>",e+='<div class="cargo-title">',e+=t.title||"",e+="</div>"},t.prototype._tag_html=function(t){var e="";return e+='<div class="ui-tool-wrap"><div class="ui-tool"><div class="ui-tool-in clamp">美乐吧承诺：一旦发现商家宰客、欺客，经查明属实，将直接返现金2000元</div></div></div>',t.is_new||t.is_hot?(e+='<div class="ui-tool-wrap"><div class="ui-tool icon-gt border"><div class="ui-tool-in">',e+='<div class="ui-tool-group">',e+=t.is_new?'<div class="ui-tool-item"><div class="ui-tool-icon">新</div><div class="ui-tool-desc">新品推荐 </div></div>':"",e+=t.is_hot?'<div class="ui-tool-item"><div class="ui-tool-icon">热</div><div class="ui-tool-desc">热卖产品</div></div>':"",e+="</div></div></div></div>"):e},t.prototype._info_html=function(t){var e="";return"undefined"==typeof t.content?e:(e+='<div class="ui-tool-wrap"><div class="ui-tool border icon-gt"><div class="ui-tool-in"><div class="ui-tool-group"><div class="ui-tool-item"><div class="ui-tool-desc">',e+="详情",e+='</div></div></div></div></div><div class="ui-tool-infor"><div class="ui-tool-infor">',e+=t.content,e+="</div></div></div>")},t.prototype._assess_html=function(t){var e="";return"undefined"!=t.comment&&t.comment.length?(e+='<div class="ui-tool-wrap" data-event="openNewWin" data-params=\'{"name":"win_assess","param":{"id":"',e+=t.id,e+='"}}\'><div class="ui-tool icon-gt border"><div class="ui-tool-in"><div class="ui-tool-group">',e+='<div class="ui-tool-item"><div class="ui-tool-desc">宝贝评价（',e+=t.comment.length||0,e+="）</div></div></div></div></div>",t.comment.length?(e+='<div class="main assess"><div class="lists"><div class="lists-group">',t.comment.forEach(function(t){e+='<div class="lists-item"><div class="title"><div class="head" data-echo-background="',e+=t.avatar,e+='"></div><div class="nickname">',e+=t.nick||"佚名",e+='</div></div><div class="desc">',e+=t.content,e+="</div>",e+='<div class="end">',e+=t.ago,e+="</div></div>"}),e+="</div></div></div>",e+="</div>"):e+="</div>"):e},t.prototype._footer_html=function(t){var e=this,i="";return i+='<div class="footer"><div class="footer-group"><div class="footer-item" data-event="',i+=e.$data.shop_id!==t.shop_id?"closeWin":"openNewWin",i+='" data-params=\'{"name":"win_beauty_home","param":{"id","',i+=t.shop_id,i+='"}}\'><div class="icon icon-cargo-home"></div><p>店铺</p></div>',i+='<div class="footer-item"><div class="icon icon-cargo-share"></div><p>分享</p></div>',i+='<div class="footer-item" data-event="call" data-params=\'{"tel","+8613082807225"}\'><div class="icon icon-coin-tel"></div><p>联系</p></div>',i+='<div class="footer-item" data-event="openNewWin" data-params=\'{"name":"win_goods_order","param":{"id":"',i+=t.id,i+='","shop_id":"',i+=t.shop_id,i+="\"}}'>立即购买</div></div></div>"},t.prototype._ajax=function(t){var e=this;t=$.callback(t),$.ajax({url:e.$url,data:{goods_id:e.$data.id},cache:!1}).then(t)},$.cargoGoods=function(){return new t}}(),~function(){var t=function(){};return t.prototype.init=function(){},$.coinChase=function(){return new t}}(),~function(){var t=function(){this.id=api.pageParam.id,this.$thumb=$('[data-selector="thumb-banner"]'),this.$info=$('[data-selector="details-info"]'),this.$title=$('[data-selector="details-title"]'),this.$tag=$('[data-selector="details-tag"]'),this.$content=$('[data-selector="details-content"]'),this.$assess=$('[data-selector="details-assess"]'),this.$assessCount=$('[data-selector="assess-count"]')};return t.prototype.init=function(){var t=this;t.main()},t.prototype.main=function(){var t=this;async.waterfall([function(e){t.ajax(e)},function(e,i){t.setThumb(e,i)},function(e,i){t.setInfo(e,i)},function(e,i){t.setTitle(e,i)},function(e,i){t.setTag(e,i)},function(e,i){t.setContent(e,i)},function(e,i){t.setAssess(e,i)}],function(t,e){return t?$.api.toast(t):($.echo(),void $.app.swipe())})},t.prototype.setThumb=function(t,e){var i=this;i.$thumb.html(i.thumbBannerHtml(t)),e(null,t)},t.prototype.thumbBannerHtml=function(t){var e=t.data.thumb_url||[],i="";return i+='<div class="banner-warp js-slider swipe"><div class="banner-group swipe-wrap">',e.forEach(function(t){i+='<div class="banner-item" data-echo-background="',i+=t.path,i+='"></div>'}),i+="</div></div>"},t.prototype.setInfo=function(t,e){var i=this;i.$info.html(i.infoHtml(t)),e(null,t)},t.prototype.infoHtml=function(t){var e="",i=t.data;return e+='<div class="price fl icon icon-score">',e+=i.offer_point,e+='</div><div class="price over fl small">已售',e+=i.sales,e+='</div><div class="price over fl small">剩余',e+=i.stock,e+="</div>"},t.prototype.setTitle=function(t,e){var i=this;i.$title.text(t.data.title),e(null,t)},t.prototype.setTag=function(t,e){var i=this;i.$tag.html(i.tagHtml(t)),e(null,t)},t.prototype.tagHtml=function(t){var e="",i=t.data;return e+='<div class="ui-tool icon-gt border"><div class="ui-tool-in"><div class="ui-tool-group">',i.is_new&&(e+='<div class="ui-tool-item"><div class="ui-tool-icon">新</div><div class="ui-tool-desc">新品推荐</div></div>'),i.is_hot&&(e+='<div class="ui-tool-item"><div class="ui-tool-icon">热</div><div class="ui-tool-desc">热门兑换</div></div>'),e+="</div></div></div>"},t.prototype.setContent=function(t,e){var i=this;e=$.callback(e),i.$content.html(t.data.content||""),e(null,t)},t.prototype.setAssessAount=function(t){var e=this,i='<div class="ui-tool-item" data-event="openNewWin" data-params=\'{"name":"win_coin_assess","param":{"id":"';i+=e.id,i+='"}}\'><div class="ui-tool-desc">宝贝评价（',i+=t.data.comment_count,i+="）</div></div>",e.$assessCount.html(i)},t.prototype.setAssess=function(t,e){var i=this;e=$.callback(e),i.setAssessAount(t),i.$assess.html(i.assessHtml(t)),e(null,t)},t.prototype.assessHtml=function(t){var e="",i="undefined"!=typeof t.data.comment&&t.data.comment.length?t.data.comment:[];return i.forEach(function(t){e+='<div class="lists-item"><div class="title"><div class="head" data-echo-background="',e+=t.avatar,e+='"></div><div class="nickname">',e+=t.nick,e+='</div></div><div class="desc">',e+=t.content,e+='</div><div class="end">',e+=t.ago,e+=" - 产品类型 : ",e+="积分商品",e+="</div></div>"}),e},t.prototype.ajax=function(t){var e=this;$.ajax({url:"mall/point/detail",data:{goods_id:e.id},cache:!1}).then(t)},$.coinDetails=function(){return new t}}(),~function(){var t=function(){this.userLocation=JSON.parse(localStorage.userLocation),this.advBanner=$('[data-selector="adv-banner"]'),this.listsGroup=$('[data-selector="lists-group"]'),this.$loadMore=$("._load-more"),this.page=1,this.size=10,this.pullRefresh=$.pullRefresh(),this.scroll=$.scroll(),this.TOAST=$.toast()};t.prototype.init=function(){this._main(),this._refresh()},t.prototype._refresh=function(){var t=this;t.pullRefresh.set(function(){t._main()})},t.prototype._main=function(){var t=this;t.get_coin_adv(),t.page=1,t._one()},t.prototype._one=function(){var t=this;t.scroll.removeListenerToBottom(),t.pullRefresh.close(),async.waterfall([function(e){$.ajax({url:"mall/point/list",data:{page:t.page,size:t.size},cache:!1}).then(e)},function(e,i){t.appendHtml(e,i)},function(e,i){t.iScroll(e,i)}],function(e){return $.echo(),t._end(),e?$.api.toast(e):void(t.page+=1)})},t.prototype.get_coin_adv=function(){var t=this;async.waterfall([function(e){$.ajax({url:"ads/ads/list",data:{city_id:t.userLocation.city.id,position:1,size:5}}).then(e)},function(e,i){t.advHtml(e,i)}],function(e,i){return!e&&void t.swipe()})},t.prototype.advHtml=function(t,e){e="function"==typeof e?e:function(){};var i=t.info,o="",n=this;o+='<div class="banner-wrap js-slider swipe"><div class="banner-group swipe-wrap">',i.forEach(function(t){return!(!t||"undefined"==typeof t)&&(o+='<div class="banner-item" style="background-image: url(\'',o+=t.thumb,void(o+="')\"></div>"))}),o+="</div></div>",n.advBanner.html(o),e()},t.prototype.swipe=function(){var t=new Swipe($(".js-slider")[0],{startSlide:0,speed:400,auto:3e3,continuous:!0,disableScroll:!1,stopPropagation:!1,compatWithPullToRefresh:!0,frameName:api.frameName,callback:function(t,e){}});return t},t.prototype.iScroll=function(t,e){var i=this;return e=$.callback(e),!t.count||t.count<i.size?(i.$loadMore.text("后面没有了"),e()):(i.$loadMore.text("努力加载中"),i.scroll.addListenerToBottom(function(){i._one()}),void e())},t.prototype.listsHtml=function(t){var e="",i=t.info||"undefined"==typeof t.info?t.info:[];return i.forEach(function(t){e+='<div class="lists-item hot" data-event="openNewWin" data-params=\'{"name":"win_cargo_coin","param":{"id":"',e+=t.id,e+='"}}\'><div class="lists-img"><img src="../images/shop-item.jpg" data-echo="',e+=t.thumb,e+='" /></div><div class="desc"><p>',e+=t.title,e+='</p><div class="pink"><i class="icon-score"></i><span>',e+=t.offer_point,e+='积分</span></div></div><div class="tips">热门</div></div>'}),e},t.prototype.appendHtml=function(t,e){var i=this;i.listsGroup[1==i.page?"html":"append"](i.listsHtml(t)),e(null,t)},t.prototype._end=function(){var t=this;setTimeout(function(){t.TOAST.load().Progress()},500)},$.coinIndex=function(){return new t}}(),~function(){var t=function(){this.page=1,this.size=10,this.type=api.pageParam.type,this.$wrap=$('[data-selector="item-wrap"]'),this.scroll=$.scroll(),this.pullRefresh=$.pullRefresh(),this.$loadMore=$("._load-more")};return t.prototype.init=function(){this._main(),this._refresh()},t.prototype._refresh=function(){var t=this;t.pullRefresh.set(function(){t._main()})},t.prototype._main=function(){var t=this;t.page=1,t._one()},t.prototype._one=function(){var t=this;t.scroll.removeListenerToBottom(),async.waterfall([function(e){t._ajax(e)},function(e,i){t._append(e,i)},function(e,i){t._iscroll(e,i)}],function(e){return $.echo(),t.pullRefresh.close(),e?$.api.toast(e):void(t.page+=1)})},t.prototype._html=function(t){var e="";return t.info.forEach(function(t){e+='<div class="lists-item"><div class="case">',e+=t.reason,e+='</div><div class="time">',e+=t.create_time,e+='</div><div class="coin">+',e+=t.point,e+="</div></div>"}),e},t.prototype._append=function(t,e){var i=this,o=1==i.page?"html":"append";i.$wrap[o](i._html(t)),e(null,t)},t.prototype._iscroll=function(t,e){var i=this;return e=$.callback(e),!t.count||t.count<i.size?(i.$loadMore.text("后面没有了"),e()):(i.$loadMore.text("努力加载中"),i.scroll.addListenerToBottom(function(){i._one()}),void e())},t.prototype._delete=function(t){var e=t.id;$.confirm("删除订单","是否删除此订单?注意：删除后不可恢复",function(t){return!!t&&void $('[data-selector="'+e+'"]').remove()})},t.prototype._ajax=function(t){t=$.callback(t);var e=this;$.ajax({url:"member/bill/point",data:{page:e.page,size:e.size,type:e.type}}).then(t)},$.coinInfoItem=function(){return new t}}(),~function(){var t=function(){this.token=JSON.parse(localStorage.token),this.$item=$('[data-selector="nav-item"]'),this.$bar=$('[data-selector="bar"]')};return t.prototype.init=function(){var t=this;return t._event(),t.token.login?t.openFrameGroup():void t._open_login()},t.prototype.openFrameGroup=function(){var t=this;api.openFrameGroup({name:"coin-info-group",background:"#f2f2f2",scrollEnabled:!0,rect:{x:0,y:105,w:"auto",h:"auto"},index:0,frames:[{name:"coin_info_group_in",url:"widget://html/coin/coin-info-item.html",bgColor:"#f2f2f2",customRefreshHeader:"UIPullRefresh",bounces:!0,vScrollBarEnabled:!1,hScrollBarEnabled:!1,pageParam:{type:"-1"}},{name:"coin_info_group_out",url:"widget://html/coin/coin-info-item.html",bgColor:"#f2f2f2",customRefreshHeader:"UIPullRefresh",bounces:!0,vScrollBarEnabled:!1,hScrollBarEnabled:!1,pageParam:{type:"1"}}]},function(e,i){return!i&&void t._changeBar(e.index)})},t.prototype._event=function(){var t=this;t.$item.on("tap",function(){var t=$(this).index();$.api.switchPageIndex("coin-info-group",t,!0)})},t.prototype._open_login=function(){api.openFrame({name:"frame_login",url:"widget://html/common/not-login.html",rect:{x:0,y:65},vScrollBarEnabled:!1,hScrollBarEnabled:!1})},t.prototype._changeBar=function(t){var e=this;e.$bar.css({left:50*t+"%"})},$.coinInfo=function(){return new t}}(),~function(){var t=function(){this.page=1,this.size=10,this.type=2,this.$wrap=$('[data-selector="itemWrap"]'),this.scroll=$.scroll(),this.$loadMore=$("._load-more")};return t.prototype.init=function(){this._main()},t.prototype._main=function(){var t=this;t.page=1,t._one()},t.prototype._one=function(){var t=this;t.scroll.removeListenerToBottom(),async.waterfall([function(e){t._ajax(e)},function(e,i){t._append(e,i)},function(e,i){t._iScroll(e,i)}],function(e){return $.echo(),e?$.api.toast(e):void(t.page+=1)})},t.prototype._html=function(t){var e="",i=0;return t=!t.count||[],t.forEach(function(t){e+='<div class="list-item" data-selector="',e+=t.id,e+='"><div class="list-item-top"><div class="top-left" data-echo-background="',e+=t.logo,e+='"></div><div class="top-right">',e+=t.name,e+="</div></div>",t.content.forEach(function(t){e+='<div class="list-item-center"><div class="center-item center-img" data-echo-background="',e+=t.goods_logo,e+='"></div><div class="center-item center-text"><div class="center-text-top"><div class="text-top-item">',e+=t.goods_title,e+='</div><div class="text-top-item text-top-right">共',e+=t.goods_sum||0,i+=parseInt(t.goods_sum)||0,e+='件</div></div><div class="center-text-center">购买套餐 ：默认</div><div class="center-text-bottom">积分兑换</div></div></div>'}),e+='<div class="all"><div class="all-in">共',e+=i,e+="件商品（共支付",e+=t.offer_point,e+="积分）</div></div>",e+='<div class="list-item-bottom"><div class="btn-group"><div class="btn-item" data-event="deleteOrder" data-params=\'{"id":"',e+=t.id,e+='"}\'>删除订单</div><div class="btn-item" data-event="openNewWin" data-params=\'{"name":"win_coin_chase","param":{"id":"',e+=t.id,e+="\"}}'>查看物流</div>",e+="</div></div></div>"}),e},t.prototype._append=function(t,e){var i=this;i.$wrap[1==i.page?"html":"append"](i._html(t)),e(null,t)},t.prototype._iScroll=function(t,e){var i=this;return e=$.callback(e),!t.count||t.count<i.size?(i.$loadMore.text("到底啦"),e()):(i.$loadMore.text("努力加载中"),i.scroll.addListenerToBottom(function(){i._one()}),void e())},t.prototype["delete"]=function(t){t.id},t.prototype._ajax=function(t){t=$.callback(t);var e=this;$.ajax({url:"member/order/list",data:{page:e.page,size:e.size}}).then(t)},$.coinOrderItem=function(){return new t}}(),~function(){var t=function(){this.token=JSON.parse(localStorage.token)};t.prototype.init=function(){var t=this;return t.token.login?t._open_frame():void t._open_login()},t.prototype._open_frame=function(){api.openFrame({name:"frame_coin_order-item",url:"widget://html/coin/coin-order-item.html",rect:{x:0,y:65},vScrollBarEnabled:!1,hScrollBarEnabled:!1})},t.prototype._open_login=function(){api.openFrame({name:"frame_login",url:"widget://html/common/not-login.html",rect:{x:0,y:65},vScrollBarEnabled:!1,hScrollBarEnabled:!1})}}(),~function(){var t=function(){this.coinNumber=$('[data-selector="coin-number"]'),this.token=JSON.parse(localStorage.token)};t.prototype.init=function(){this._listener_login(),this._get_user_coin()},t.prototype._get_user_coin=function(){var t=this;return!!t.token.login&&void async.waterfall([function(t){$.ajax({url:"member/info/point"}).then(t)}],function(e,i){return!e&&void t.coinNumber.text(Math.floor(i||0))})},t.prototype._listener_login=function(){var t=this;$.logEvent().listenerLogin().then(function(){t._get_user_coin()})},$.homeCoin=function(){return new t}}(),~function(){return $.ads={html:function(t){if("object"!=typeof t||"undefined"==typeof t.data||"undefined"==t.data.info)return"";var e="",i=t.data.info;return e='<div class="banner-warp js-slider swipe"><div class="banner-group swipe-wrap">',i.forEach(function(t){e+='<div class="banner-item" style="background-image: url(\'',e+=t.thumb,e+="')\" ></div>"}),e+="</div></div>"},plate_html:function(t){if("object"!=typeof t||"undefined"==typeof t.data||"undefined"==t.data.info)return"";var e="",i=t.data.info;return e='<div class="brands-warp"><div class="brands-group">',i.forEach(function(t,i){return!(i>=3)&&(e+='<div class="brands-item" ><img src="../images/brand1.png" data-echo="',e+=t.thumb,void(e+='"/></div>'))}),e+="</div></div>"},bill_html:function(t){if("object"!=typeof t||"undefined"==typeof t.data||"undefined"==t.data.info)return"";var e="",i=t.data.info;return e='<div class="bill-warp"><div class="bill-group">',i.forEach(function(t,i){return!(i>=2)&&(e+='<div class="bill-item"><div class="bill-title">',e+=t.name,e+='</div><div class="bill-context"><img src="../images/home-index-bill-1.jpg" data-echo="',e+=t.thumb,void(e+='" /></div></div>'))}),e+="</div></div>"}}}(),~function(){var t=function(t){this.host="http://api.mlb.kfw001.com/",this.key="!@#kfwljwzhuchaofengyang20160802434",this.token=JSON.parse(localStorage.token).token,this.cacheTime=300,this.sign="",this.settings=t,this.settings.url=this.host+this.settings.url,this.callback="function"==typeof callback?callback:function(){},t.success||t.error?this.init():null};t.prototype.init=function(){var t=this;t.settings.data=$.extend({},t._default_data(),t.settings.data),t.ajax()},t.prototype.then=function(t){var e=this;e.callback=t,e.init()},t.prototype._default_data=function(){var t=this;return{token:t.token,appid:"undefined"==typeof api?0:api.appId||0,deviceid:"undefined"==typeof api?0:api.deviceId||0}},t.prototype._sort=function(){var t=this,e=[];for(var i in t.settings.data)e.push(i);return e.sort()},t.prototype._signature=function(){var t=this,e=api.require("signature");return t._sort().forEach(function(e){t.sign+=e+t.settings.data[e]+"&"}),t.sign+=t.key,t.sign=e.md5Sync({data:t.sign}),t.sign},t.prototype._data=function(){var t=this;return t.settings.data=$.extend({},t.settings.data,{sign:t._signature()}),t.settings.data},t.prototype.ajax=function(){var t=this,e=$.extend({},{url:"",cache:!1,method:"POST",dataType:"JSON",timeout:5,success:function(){},error:function(){}},t.settings),i=t._data(),o=t.getCache();return e.cache&&o&&o.timestamp+t.cacheTime>t._timestamp()?(t.callback(null,o),e.success(o)):void api.ajax({url:e.url,cache:!0,method:e.method,dataType:e.dataType,timeout:e.timeout,data:{values:i,files:e.files}},function(i,o){return o?(o={status:0,msg:o.msg},t.callback(o),e.error(o)):200!=i.status?(o={status:i.status,msg:i.msg},t.callback(o),e.error(o)):(i="undefined"==typeof i.data?"undefined":i.data,void t.success(e,i))})},t.prototype.success=function(t,e){var i=this;t.cache&&i.setCache(e),i.callback(null,e),t.success(e)},t.prototype.setCache=function(t){var e=this;return"object"==typeof t&&(t=$.extend({},t,{timestamp:e._timestamp()}),t=JSON.stringify(t),localStorage.setItem(e.settings.url+e.sign,t))},t.prototype.getCache=function(){var t=this,e=localStorage.getItem(t.settings.url+t.sign);return!!e&&JSON.parse(e)},t.prototype._timestamp=function(){return Math.round((new Date).getTime()/1e3)},$.ajax=function(e){return"object"==typeof e&&e.url?new t(e):$.api.toast("参数错误：undefined")}}(),~function(){return $.callback=function(t){return t="function"==typeof t?t:function(){}}}(),~function(){$.echo=function(t){return t="function"==typeof t?t:function(){},"object"==typeof echo&&(echo.detach(),echo.init({offset:500,throttle:250,unload:!1,debounce:!0,callback:t}),void echo.render())}}(),~function(){var t=function(t){this.token=JSON.parse(localStorage.token),this.name=t.name,this.param=t.param,this.url=t.url,this.animation={type:"push",subType:"from_right",duration:250}};t.prototype.open=function(){var t=this;api.openWin({name:t.name,url:t.url,animation:t.animation,pageParam:t.param,vScrollBarEnabled:!1,hScrollBarEnabled:!1})},t.prototype.win_welcome=function(){var t=this;t.animation={type:"fade",subType:"from_right",duration:300},t.url="widget://html/common/welcome.html",t.open()},t.prototype.win_coin_info=function(){var t=this;t.url="widget://html/coin/coin-info.html",t.open()},t.prototype.win_user_login=function(){var t=this;t.url="widget://html/user/user-login.html",t.open()},t.prototype.win_cargo_coin=function(){var t=this;t.url="widget://html/cargo/cargo-coin.html",t.open()},t.prototype.win_user_register=function(){var t=this;t.url="widget://html/user/user-register.html",t.open()},t.prototype.win_user_password=function(){var t=this;t.url="widget://html/user/user-password.html",t.open()},t.prototype.win_bbs_details=function(){var t=this;t.url="widget://html/bbs/bbs-details.html",t.open()},t.prototype.win_store_home=function(){var t=this;t.url="widget://html/store/store-home.html",t.open()},t.prototype.win_assess=function(){var t=this;t.url="widget://html/assess/assess.html",t.open()},t.prototype.win_cargo_goods=function(){var t=this;t.url="widget://html/cargo/cargo-goods.html",t.open()},t.prototype.win_goods_order=function(){var t=this;return t.token.login?(t.url="widget://html/order/goods-order.html",void t.open()):t.win_user_login()},t.prototype.win_coin_order=function(){var t=this;return t.token.login?(t.url="widget://html/order/coin-order.html",void t.open()):t.win_user_login()},t.prototype.win_pay=function(){var t=this;t.url="widget://html/pay/pay.html",t.open()},t.prototype.win_coin_pay=function(){var t=this;t.url="widget://html/pay/coin-pay.html",t.open()},t.prototype.win_set_index=function(){var t=this;t.url="widget://html/set/set-index.html",t.open()},t.prototype.win_set_user=function(){var t=this;
t.url="widget://html/set/set-user.html",t.token.login||(t.url="widget://html/common/nothings.html"),t.open()},t.prototype.win_set_sex=function(){var t=this;t.url="widget://html/set/set-sex.html",t.open()},t.prototype.win_set_nick=function(){var t=this;t.url="widget://html/set/set-nick.html",t.open()},t.prototype.win_set_tel=function(){var t=this;t.url="widget://html/set/set-tel.html",t.open()},t.prototype.win_set_avatar=function(){var t=this;t.url="widget://html/set/set-avatar.html",t.open()},t.prototype.win_address=function(){var t=this;t.url="widget://html/address/address.html",t.open()},$.openWin=function(e){if("object"!=typeof e||!e)return $.api.toast("尚未开发，请耐心等候");if("root"==e.name)return api.openWin({name:"root"});var i=new t(e);"function"==typeof i[e.name]?i[e.name]():$.api.toast(e.name+" is undefined")}}(),~function(){var t=function(){};return t.prototype.init=function(){},t.prototype.addListenerToBottom=function(t){t=$.callback(t),api.addEventListener({name:"scrolltobottom",extra:{threshold:$.config.threshold?$.config.threshold:30}},function(){t()})},t.prototype.removeListenerToBottom=function(){api.removeEventListener({name:"scrolltobottom"})},$.scroll=function(){return new t}}(),~function(){var t=function(t){this.MNActionButton,this.items=[{icon:"widget://res/share/wx-1.png",title:"微信朋友圈"},{icon:"widget://res/share/wx-2.png",title:"发送给朋友"},{icon:"widget://res/share/qq-1.png",title:"QQ好友"},{icon:"widget://res/share/qq-2.png",title:"QQ空间"},{icon:"widget://res/share/weibo.png",title:"新浪微博"},{icon:"widget://res/share/qrcode.png",highlight:"widget://res/MNActionButton/5.png",title:"二维码"},{icon:"widget://res/share/link.png",highlight:"widget://res/MNActionButton/6.png",title:"复制链接"}],this.callback};t.prototype.init=function(){return this.MNActionButton=api.require("MNActionButton"),this},t.prototype.open=function(t){var e=this;e.callback="function"==typeof t?t:function(){},e.MNActionButton.open({layout:{row:2,col:4,offset:0,colSpacing:"ios"==api.systemType?30:10},animation:!1,autoHide:!0,styles:{maskBg:"rgba(0,0,0,.35)",bg:"#fff",cancelButton:{bg:"#fff"},item:{titleColor:"#888",titleHighlight:"dd2727",titleSize:12},indicator:{color:"#c4c4c4",highlight:"#9e9e9e"}},items:e.items},function(t){return"cancel"==t.eventType?e.callback(!0):void e.callback(null,t.index,e.items[t.index])})},$.shareAction=function(){return new t}}(),~function(){var t=function(){this.$getCode=$(".weui-vcode-btn"),this.$tel=$('input[name="tel"]'),this.$url="common/code/sms",this.time=60,this.init()};return t.prototype.init=function(){var t=this;t._event()},t.prototype._event=function(){var t=this;t.$getCode.on("tap",function(){var e=$(this),i=t.$tel.val()||"",o=e.data("tip")||"";t._ajax(i,o,function(i,o){return i?$.api.toast("短信发送失败"):($.api.toast("短信发送成功，请注意查收"),void t._loop(e))})})},t.prototype._loop=function(t){var e=this;return t.off("tap").text(e.time+"秒后重新获取"),e.time-=1,e.time<=0?(t.text("获取验证码"),e._event()):void setTimeout(function(){e._loop(t)},1e3)},t.prototype._ajax=function(t,e,i){var o=this,n={};t?n.tel=t:null,e?n.tps=e:null,$.ajax({url:o.$url,data:n}).then(i)},$.smsCode=function(){return new t}}(),~function(){var t=function(t,e,i,o){this.$container,this.title=t,this.text=e,this.callback="function"==typeof i?i:function(){},this.type=o,this.init()};t.prototype.init=function(){var t=this;t.ceater(),t.event()},t.prototype.html=function(){var t=this,e="";return e+='<div class="ui-alert show"><div class="ui-alert-wrap"></div><div class="ui-alert-toast"><div class="ui-alert-title"><div class="ui-alert-title-in">',e+=t.title||"",e+='</div></div><div class="ui-alert-context"><div class="ui-alert-context-in">',e+=t.text||"",e+='</div></div><div class="ui-alert-btn-group">',e+="alert"==t.type?'<div class="ui-alert-btn" data-type="1">确认</div>':'<div class="ui-alert-btn" data-type="0">取消</div><div class="ui-alert-btn" data-type="1">确认</div>',e+="</div></div></div>"},t.prototype.ceater=function(){var t=this;t.$container=document.createElement("div"),t.$container.className="ui-container",t.$container.innerHTML=t.html(),document.body.appendChild(t.$container)},t.prototype.event=function(){for(var t=this,e=t.$container.querySelectorAll(".ui-alert-btn"),i=0;i<e.length;i++)e[i].addEventListener("click",function(){var e=this;t.hide(!!parseInt(e.getAttribute("data-type")))},!1)},t.prototype.hide=function(t){var e=this;e.callback(t),e.$container.parentNode.removeChild(e.$container)},$.alert=function(e,i,o){return new t(e,i,o,"alert")},$.confirm=function(e,i,o){return new t(e,i,o,"confirm")}}(),~function(){var t=function(t,e){this.container="",this.$container="",this.settings=$.extend({},{title:"更改头像",item:[{icon:"icon-picture",name:"图片库",value:"library"},{icon:"icon-camera",name:"相机",value:"camera"}]},t),this.settings.callback=e,this.init()};t.prototype.init=function(){this.addHtml(),this.event()},t.prototype.addHtml=function(){var t=this;t.container=document.createElement("div");var e="";e+='<div class="_action-sheet"><div class="action-wrap" data-event="hide" data-params="false"></div><div class="action-sheet"><div class="action-sheet-title">',e+=t.settings.title,e+='</div><div class="action-sheet-item-group">',t.settings.item.forEach(function(t,i){e+='<div class="action-sheet-item',e+=t.icon?" "+t.icon:"",e+='" data-event="select" data-params="',e+=i,e+='">',e+=t.name,e+="</div>"}),e+="</div></div></div>",t.container.innerHTML=e,document.body.appendChild(t.container),t.$container=$(t.container).find("._action-sheet")},t.prototype.event=function(){var t=this;t.$container.on("tap","[data-event]",function(){var e=$(this),i=e.data("params");return t.hide(),"hide"==e.data("event")?t.settings.callback(!1):void t.settings.callback(t.settings.item[i])})},t.prototype.show=function(){var t=this;t.$container.addClass("show")},t.prototype.hide=function(t){t=!t||t;var e=this;return t?$(e.container).remove():void e.$container.removeClass("show")},$.actionSheet=function(e,i){return!("object"!=typeof e||!e||!e.item.length)&&(i="function"==typeof i?i:function(){},new t(e,i))}}(),~function(){var t=function(){this.$toast=$("._toast")};return t.prototype.init=function(){},t.prototype.success=function(){var t=this,e=t.$toast.find("#success");return!e.hasClass("show")&&(e.addClass("show"),void setTimeout(function(){e.removeClass("show"),$.app["switch"]("closeWin")},500))},t.prototype.load=function(){var t=this,e=t.$toast.find("#load");return{show:function(){return e.addClass("show")},hide:function(){return e.removeClass("show")},Progress:function(){return e.removeClass("show"),t.$toast.siblings("._main").addClass("show")}}},$.toast=function(){return new t}}(),~function(){return $.config={pullRefresh:{},threshold:30}}(),~function(){var t=function(){this.$bbsGroup=api.pageParam,this.$nav=$('[data-selector="nav"]')};return t.prototype.init=function(){var t=this;t._event()},t.prototype._event=function(){var t=this;t.$nav.on("tap",function(){var e=$(this),i=e.index(),o=e.siblings("");t._switch_icon(e,i,o)})},t.prototype._switch_icon=function(t,e,i){var o=this;return!t.hasClass("active")&&(t.addClass("active").find(".icon").addClass(t.data("active-icon")).removeClass(t.data("icon")),i.removeClass("active"),i.forEach(function(t){var e=$(t);e.find(".icon").addClass(e.data("icon")).removeClass(e.data("active-icon"))}),$.api.switchPageIndex("home-page-group",e),void o._switch_page(e))},t.prototype._switch_page=function(t){var e=this;switch(e._hide_home_page(),t){case 1:e._open_coin_home();break;case 2:e._open_store_lists();break;case 3:e._open_bbs_home()}},t.prototype._open_bbs_home=function(){var t=this;api.openFrameGroup({name:"home-bbs-group",background:"#ededed",scrollEnabled:!0,rect:{marginLeft:0,marginTop:110,marginBottom:45,marginRight:0},index:0,frames:t.$bbsGroup},function(t,e){$.api.sendEvent("_event_switch_home_bbs_group",{index:t.index})})},t.prototype._open_coin_home=function(){api.openFrame({name:"coin_home",url:"widget://html/coin/coin-index.html",rect:{marginLeft:0,marginTop:65,marginBottom:45,marginRight:0},bounces:!1,bgColor:"#ededed",vScrollBarEnabled:!1,hScrollBarEnabled:!1})},t.prototype._open_store_lists=function(){api.openFrame({name:"store_lists",url:"widget://html/store/store-lists.html",rect:{marginLeft:0,marginTop:100,marginBottom:45,marginRight:0},bounces:!1,bgColor:"#ededed",vScrollBarEnabled:!1,hScrollBarEnabled:!1})},t.prototype._hide_home_page=function(){api.setFrameAttr({name:"coin_home",hidden:!0}),api.setFrameGroupAttr({name:"home-bbs-group",hidden:!0}),api.setFrameAttr({name:"store_lists",hidden:!0})},$.homeFooter=function(){return new t}}(),~function(){var t=function(){this.userLocation=api.pageParam,this.$cityName=$('[data-selector="city-name"]'),this.advertisingData={banner:"",brands:"",bill:""},this.$banner=$('[data-selector="banner"]'),this.$brands=$('[data-selector="brands"]'),this.$bill=$('[data-selector="bill"]'),this.$storeLists=$('[data-selector="store-lists"]'),this.$moreStore=$('[data-selector="more-store"]'),this.$STORELISTS=$.storeLists(),this.$SCROLL=$.scroll(),this.$BMAP=$.bMap()};return t.prototype.init=function(){var t=this;t._listener_remove_launch(),t.main()},t.prototype.main=function(){var t=this;async.waterfall([function(e){t._set_city_name(t.userLocation,e)},function(e){t._advertising(e)}],function(e,i){t.ajax()})},t.prototype._store_lists=function(t){var e=this;t=$.callback(t),e.$SCROLL.removeListenerToBottom(),async.waterfall([function(t){e.$STORELISTS.ajax(t)},function(t,i){e._append_store_lists_html(t,i)},function(t,i){e.$STORELISTS._store_lists_end(t,i)}],function(i,o){return t(),!i&&void e.$SCROLL.addListenerToBottom(function(){e._store_lists()})})},t.prototype._append_store_lists_html=function(t,e){var i=this,e=$.callback(e),o="html",n=i.$STORELISTS._store_lists_html(t);1!=i.$STORELISTS.page&&(o="append"),i.$STORELISTS.$storeLists[o](n),e(null,t)},t.prototype._advertising=function(t){var e=this,t=$.callback(t);async.waterfall([function(t){e._get_advertising_data(t)},function(t,i){e._set_advertising_html(t,i)}],function(i,o){e.swipe(),t()})},t.prototype._get_advertising_data=function(t){var e=this,t=$.callback(t),i=localStorage["home-index-advertising"];return"undefined"!=typeof i?t(null,JSON.parse(i)):void e.ajax()},t.prototype._set_advertising_html=function(t,e){var i=this,e=$.callback(e);i._banner_html(t.banner),i._brands_html(t.brands),i._bill_html(t.bill),e()},t.prototype._banner_html=function(t){var e=this,i="";return t?(i+='<div class="banner-warp js-slider swipe"><div class="banner-group swipe-wrap">',t.info.forEach(function(t){i+='<div class="banner-item" style="background-image: url(\'',i+=t.thumb,i+="')\"></div>"}),i+="</div></div>",void e.$banner.html(i)):e.$banner.remove()},t.prototype._brands_html=function(t){var e=this,i="";return t?(i+='<div class="title"> —  品牌推荐  —</div><div class="brands"><div class="brands-in"><div class="brands-warp"><div class="brands-group">',t.info.forEach(function(t){i+='<div class="brands-item" style="background-image: url(\'',i+=t.thumb,i+="')\"></div>"}),i+="</div></div></div></div>",void e.$brands.html(i)):e.$brands.remove()},t.prototype._bill_html=function(t){var e=this,i="";return t?(i+='<div class="bill"><div class="bill-in"><div class="bill-warp"><div class="bill-group">',t.info.forEach(function(t){i+='<div class="bill-item"><div class="bill-title">',i+=t.name||"",i+='</div><div class="bill-context" style="background-image: url(\'',i+=t.thumb,i+="')\"></div></div>"}),i+="</div></div></div></div>",void e.$bill.html(i)):e.$bill.remove()},t.prototype.ajax=function(){var t=this;async.waterfall([function(e){t.ajax_banner(e)},function(e){t.ajax_brands(e)},function(e){t.ajax_bill(e)}],function(e,i){localStorage["home-index-advertising"]=JSON.stringify(t.advertisingData),t._advertising()})},t.prototype.ajax_banner=function(t){var e=this,t=$.callback(t);$.ajax({url:"ads/ads/list",data:{position:1,size:5,city_id:e.userLocation.city.id}}).then(function(i,o){return i?t():(e.advertisingData.banner=o,void t())})},t.prototype.ajax_brands=function(t){var e=this,t=$.callback(t);$.ajax({url:"ads/ads/list",data:{position:2,size:3,city_id:e.userLocation.city.id}}).then(function(i,o){return i?t():(e.advertisingData.brands=o,void t())})},t.prototype.ajax_bill=function(t){var e=this,t=$.callback(t);$.ajax({url:"ads/ads/list",data:{position:3,size:2,city_id:e.userLocation.city.id}}).then(function(i,o){return i?t():(e.advertisingData.bill=o,void t())})},t.prototype._set_city_name=function(t,e){var i=this,e=$.callback(e);i.$cityName.text(i.userLocation.city.city),e()},t.prototype.swipe=function(){new Swipe($(".js-slider")[0],{startSlide:0,speed:400,auto:3e3,continuous:!0,disableScroll:!1,stopPropagation:!1})},t.prototype._listener_remove_launch=function(){var t=this;$.api.listenerEvent("removeLaunch",function(){setTimeout(function(){t._get_user_location()},1e3)})},t.prototype._get_user_location=function(){var t=this;async.waterfall([function(e){t.$BMAP._get_user_location(e)},function(e,i){t.userLocation=$.extend({},t.userLocation,e),i()},function(t){$.ajax({url:"common/location/ip"}).then(t)},function(e,i){t.userLocation=$.extend({},t.userLocation,e),i()}],function(e,i){e&&$.api.toast(e),localStorage.userLocation=JSON.stringify(t.userLocation),t.$STORELISTS=$.storeLists(),t.$moreStore.css({height:"0px"}),t._store_lists()})},$.homeIndex=function(){return new t}}(),~function(){var t=function(){this.BBS=$.homeBbs(),this.userLocation,this.bbsPageGroup};return t.prototype.init=function(){var t=this;t._default_location(),t.main()},t.prototype.main=function(){var t=this;async.waterfall([function(e){t.BBS.ajax(e)},function(e,i){t.bbs_page_group(e,i)},function(e,i){t.open_home_page_group(e,i)},function(e){t.open_home_footer(e)},function(e){t._welcome(e)}],function(t,e){})},t.prototype.open_home_footer=function(t){var e=this;t=$.callback(t),api.openFrame({name:"home-footer",url:"widget://html/home-footer.html",rect:{x:0,y:api.winHeight-45,w:"auto",h:45},bounces:!1,bgColor:"#ffffff",vScrollBarEnabled:!1,hScrollBarEnabled:!1,pageParam:e.bbsPageGroup}),t()},t.prototype._welcome=function(t){var t=$.callback(t);$.app["switch"]("openNewWin",{name:"win_welcome",param:{type:"undefined"==typeof localStorage.welcome}}),t()},t.prototype.open_home_page_group=function(t,e){var i=this;e=$.callback(e),api.openFrameGroup({name:"home-page-group",scrollEnabled:!1,preload:4,index:0,rect:{marginLeft:0,marginRight:0,marginTop:20,marginBottom:45},frames:[{name:"home-index",url:"widget://html/home-index.html",bounces:!1,bgColor:"#ededed",vScrollBarEnabled:!1,hScrollBarEnabled:!1,pageParam:i.userLocation},{name:"coin-index",url:"widget://html/home-coin.html",bounces:!1,bgColor:"#ededed",vScrollBarEnabled:!1,hScrollBarEnabled:!1},{name:"beauty-index",url:"widget://html/home-beauty.html",bounces:!1,bgColor:"#ededed",vScrollBarEnabled:!1,hScrollBarEnabled:!1},{name:"bbs-index",url:"widget://html/home-bbs.html",bounces:!1,bgColor:"#ededed",pageParam:t,vScrollBarEnabled:!1,hScrollBarEnabled:!1},{name:"user-index",url:"widget://html/home-user.html",bounces:!1,bgColor:"#ededed",vScrollBarEnabled:!1,hScrollBarEnabled:!1}]},function(t){}),e()},t.prototype.bbs_page_group=function(t,e){var i=this,e=$.callback(e);i.bbsPageGroup=i.BBS.set_bbs_page_group(t),e(null,t)},t.prototype._default_location=function(){var t=this;"undefined"==typeof localStorage.userLocation&&(localStorage.userLocation=JSON.stringify({city:{city:"杭州",id:87},zone:[{zone:"上城区",id:844},{zone:"下城区",id:845},{zone:"江干区",id:846},{zone:"拱墅区",id:847},{zone:"西湖区",id:848},{zone:"滨江区",id:849},{zone:"萧山区",id:850},{zone:"余杭区",id:851},{zone:"桐庐县",id:852},{zone:"淳安县",id:853},{zone:"建德市",id:854},{zone:"富阳市",id:855},{zone:"临安市",id:856}],lon:"120.187777",lat:"30.286864"})),t.userLocation=JSON.parse(localStorage.userLocation)},t.prototype._load=function(){$.api.listenerEvent("open-load",function(t){api.openFrame({name:"frame-load",url:"widget://html/common/load.html",rect:$.extend({},{y:20,x:0,width:"auto",height:"auto"},"undefined"==typeof t.rect?{}:t.rect),pageParam:"undefined"==typeof t.msg?"加载中···":t.msg,bounces:!1,bgColor:"#ededed",vScrollBarEnabled:!1,hScrollBarEnabled:!1,animation:{type:"fade",subType:"from_right",duration:300}})}),$.api.listenerEvent("close-load",function(){api.setFrameAttr({name:"frame-load",hidden:!0})})},$.home=function(){return new t}}(),~function(){var t=function(){return this.bMap=api.require("bMap"),this};return t.prototype._get_user_location=function(t){var e=this;t=$.callback(t),e.bMap.getLocation({accuracy:"100m",autoStop:!0,filter:1},function(e,i){t(i,e)})},$.bMap=function(){return new t}}(),~function(){var t=function(){this.callback=function(){}};t.prototype.sendLogin=function(t){var e=this;e.success(t),$.api.sendEvent("_event_login",t||{})},t.prototype.listenerLogin=function(t){var e=this;return"undefined"==typeof t&&"function"==typeof t?$.api.listenerEvent("_event_login",function(e){t(e)}):($.api.listenerEvent("_event_login",function(t){e.callback(null,t)}),e)},t.prototype.sendLogout=function(t){var e=this;$.api.sendEvent("login",t||{}),e.success(t)},t.prototype.success=function(t){$.api.toast("登陆成功"),localStorage.token=JSON.stringify(t)},t.prototype.then=function(t){this.callback=$.callback(t)},$.logEvent=function(){return new t}}(),~function(){var t=function(){};return t.prototype.set=function(t){t=$.callback(t),api.setCustomRefreshHeaderInfo({bgColor:"rgba(0,0,0,0)",image:$.config.pullRefresh},function(){$.api.toast("刷新成功"),t()})},t.prototype.close=function(){setTimeout(api.refreshHeaderLoadDone,500)},$.pullRefresh=function(){return new t}}(),~function(){var t=function(){this.qq=api.require("qq"),this.android={id:"1105410509",key:"7ki84UhA5hYwkVLv"},this.ios={id:"1105410523",key:"4CXeu1RlBP2R32kz"},this.info={type:1,auth_openid:"",auth_token:"",province:"",city:"",nick:"",sex:"",avatar:""}};return t.prototype.install=function(t){var e=this;t="function"==typeof t?t:function(){},e.qq.installed(function(e,i){return e.status?void t():$.api.toast("您未安装腾讯QQ")})},t.prototype.login=function(t){var e=this;return t="function"==typeof t?t:function(){},"undefined"==typeof e.qq?$.api.toast("你忘了初始化"):void e.install(function(){e.get_user_info(t)})},t.prototype.get_user_info=function(t){var e=this;api.require("qq");e.qq.login({apiKey:"ios"==api.systemType?e.ios.id:e.android.id},function(i,o){return o?$.api.toast(o):(e.info.auth_openid=i.openId,e.info.auth_token=i.accessToken,void e.get_details_info(t))})},t.prototype.get_details_info=function(t){var e=this;e.qq.getUserInfo(function(i,o){return o?$.api.toast(o):(e.info.nick=i.info.nickname,e.info.avatar=i.info.figureurl_qq_2,e.info.sex="男"==i.info.gender?1:2,e.info.province=i.info.province,e.info.city=i.info.city,void t(e.info))})},t.prototype.shareUrl=function(t,e){var i=this;i.install(function(){i.qq.shareNews($.extend({},{apiKey:"ios"==api.systemType?i.ios.id:i.android.id,url:"https://baidu.com",title:"分享标题",description:"分享描述",imgUrl:"https://ss0.baidu.com/6ONWsjip0QIZ8tyhnq/it/u=1781221968,1734501883&fm=80",type:"QFriend"},t),function(t,i){e()})})},t.prototype.shareUrlToQFriend=function(t,e){var i=this;return e="function"==typeof e?e:function(){},"undefined"==typeof i.qq?$.api.toast("你忘了初始化"):"object"!=typeof t?$.api.toast("您的参数不正确"):(t.type="QFriend",void i.shareUrl(t,e))},t.prototype.shareUrlToQZone=function(t,e){var i=this;return e="function"==typeof e?e:function(){},"undefined"==typeof i.qq?$.api.toast("你忘了初始化"):"object"!=typeof t?$.api.toast("您的参数不正确"):(t.type="QZone",void i.shareUrl(t,e))},$.qq=function(){return new t}}(),~function(){var t=function(){this.shop_id=api.pageParam.shop_id||"undefined",this.id=api.pageParam.id||"undefined",this.type=1,this.number=1,this.defaultAddressHtml="",this.$address=$('[data-selector="address"]'),this.$beauty=$('[data-selector="beauty"]'),this.$changeNumber=$('[data-selector="change-number"]'),this.$number=$('[data-selector="number"]'),this.$price=$('[data-selector="all-price"]'),this.$submit=$('[data-selector="submit"]')};return t.prototype.init=function(){this.main()},t.prototype.main=function(){var t=this;async.waterfall([function(e){t.ajax(e)},function(e,i){t.setHtml(e,i)},function(e,i){t._event(e,i)}],function(t,e){if($.echo(),t)return $.api.toast(t)})},t.prototype.setHtml=function(t,e){var i=this;i.$address.html(i._defaultAddressHtml(t)),i.$beauty.html(i._storeInfoHtml(t)),e(null,t)},t.prototype._defaultAddressHtml=function(t){var e=this,i="";return"undefined"==typeof t.shop?"":(t=t.shop,i+='<div class="beauty-address"><div class="info"><div class="nick">',i+=t.name,i+='</div><div class="tel">',i+=t.phone,i+='</div></div><div class="address-info">',i+=t.address,i+="</div></div>",i+='<div class="icon gt icon-gt"></div>',e.defaultAddressHtml=i,i)},t.prototype._storeInfoHtml=function(t){var e="";return"undefined"==typeof t.shop?e:(e+='<div class="title icon-gt"><div class="head" data-echo-background="',e+=t.shop.logo,e+='"></div> <p>',e+=t.shop.name,e+="</p></div>","undefined"==typeof t.goods?e:(t.goods.forEach(function(t){e+='<div class="context"><div class="head" data-echo-background="',e+=t.thumb,e+='"></div><div class="info"><div class="info-title">',e+=t.title,e+='</div><div class="info-desc">无描述</div><div class="info-price">¥',e+=t.offer_money,e+="</div></div></div>"}),e))},t.prototype._event=function(t,e){var i=this;e=$.callback(e);var o=t.goods[0].max_buy,n=t.goods[0].offer_money;i.$price.html("¥"+i.number*n),i.$changeNumber.on("tap",function(){var t=$(this).data("params");"less"==t&&i.number>0&&(i.number-=1),"add"==t&&i.number<o&&(i.number+=1),i.$number.val(i.number),i.$price.html("¥"+i.number*n)}),i.$number.on("change",function(){var t=$(this);t.val()>o&&(i.number=o),t.val(i.number),i.$price.html("¥"+i.number*n)}),i.$submit.on("tap",function(){async.waterfall([function(t){i.order_ajax(t)}],function(t,e){return t?$.api.toast(t):void $.app["switch"]("openNewWin",{name:"win_coin_pay",param:{id:e}})})}),e()},t.prototype.ajax=function(t){var e=this;$.ajax({url:"mall/order/cart",data:{shop_id:e.shop_id,type:e.type,goods:'{"'+e.id+'":"'+e.number+'"}'}}).then(t)},t.prototype.order_ajax=function(t){var e=this,i={shop_id:e.shop_id,type:1,goods:'{"'+e.id+'":"'+e.number+'"}'};$.ajax({url:"mall/order/make",data:i,cache:!1}).then(t)},$.coinOrder=function(){return new t}}(),~function(){var t=function(){this.shop_id=api.pageParam.shop_id||"undefined",this.id=api.pageParam.id||"undefined",this.type=1,this.number=1,this.defaultAddressHtml="",this.$address=$('[data-selector="address"]'),this.$beauty=$('[data-selector="beauty"]'),this.$changeNumber=$('[data-selector="change-number"]'),this.$number=$('[data-selector="number"]'),this.$price=$('[data-selector="all-price"]'),this.$submit=$('[data-selector="submit"]')};return t.prototype.init=function(){this.main()},t.prototype.main=function(){var t=this;async.waterfall([function(e){t.ajax(e)},function(e,i){t.setHtml(e,i)},function(e,i){t._event(e,i)}],function(t,e){if($.echo(),t)return $.api.toast(t)})},t.prototype.setHtml=function(t,e){var i=this;i.$address.html(i._defaultAddressHtml(t)),i.$beauty.html(i._storeInfoHtml(t)),e(null,t)},t.prototype._defaultAddressHtml=function(t){var e=this,i="";return"undefined"==typeof t.shop?"":(t=t.shop,i+='<div class="beauty-address"><div class="info"><div class="nick">',i+=t.name,i+='</div><div class="tel">',i+=t.phone,i+='</div></div><div class="address-info">',i+=t.address,i+="</div></div>",i+='<div class="icon gt icon-gt"></div>',e.defaultAddressHtml=i,i)},t.prototype._storeInfoHtml=function(t){var e="";return"undefined"==typeof t.shop?e:(e+='<div class="title icon-gt"><div class="head" data-echo-background="',e+=t.shop.logo,e+='"></div> <p>',e+=t.shop.name,e+="</p></div>","undefined"==typeof t.goods?e:(t.goods.forEach(function(t){e+='<div class="context"><div class="head" data-echo-background="',e+=t.thumb,e+='"></div><div class="info"><div class="info-title">',e+=t.title,e+='</div><div class="info-desc">无描述</div><div class="info-price">¥',e+=t.offer_money,e+="</div></div></div>"}),e))},t.prototype._event=function(t,e){var i=this;e=$.callback(e);var o=parseInt(t.goods[0].max_buy),n=parseInt(t.goods[0].offer_money);i.$price.html("¥"+i.number*n),i.$changeNumber.on("tap",function(){var t=$(this).data("params");"less"==t&&i.number>0&&(i.number-=1),"add"==t&&i.number<o&&(i.number+=1),i.$number.val(i.number),i.$price.html("¥"+i.number*n)}),i.$number.on("change",function(){var t=$(this);t.val()>o&&(i.number=o),t.val(i.number),i.$price.html("¥"+i.number*n)}),i.$submit.on("tap",function(){async.waterfall([function(t){i.order_ajax(t)}],function(t,e){return t?$.api.toast(t):void $.app["switch"]("openNewWin",{name:"win_pay",param:{id:e}})})}),e()},t.prototype.ajax=function(t){var e=this;$.ajax({url:"mall/order/cart",data:{shop_id:e.shop_id,type:e.type,goods:'{"'+e.id+'":"'+e.number+'"}'}}).then(t)},t.prototype.order_ajax=function(t){var e=this,i={shop_id:e.shop_id,type:1,goods:'{"'+e.id+'":"'+e.number+'"}'};$.ajax({url:"mall/order/make",data:i,cache:!1}).then(t)},$.goodsOrder=function(){return new t}}(),function(){var t=function(){this.id=api.pageParam.id,this.$radio=$('input[type="radio"]'),this.$info=$('[data-selector="info"]'),this.$pay=$('[data-selector="pay"]'),this.pay_type=1,this.aliPay=api.require("aliPay")};return t.prototype.init=function(){this.main()},t.prototype.main=function(){var t=this;async.waterfall([function(e){t.ajax(e)},function(e,i){t.appendHtml(e,i)},function(e,i){t.event(i)}],function(t,e){if($.echo(),t)return $.api.toast(t)})},t.prototype.ajax=function(t){var e=this;$.ajax({url:"mall/order/confirm",data:{order_id:e.id}}).then(t)},t.prototype.appendHtml=function(t,e){var i=this;e(null,i.$info.html(i.html(t)))},t.prototype.html=function(t){var e="";return"object"!=typeof t?e:(e+='<div class="head" data-echo-background="',e+=t.logo,e+='"></div><div class="info"><div class="info-in"><div class="money">应付款：<span>¥',e+=t.offer_money||"出现错误",e+='</span></div><div class="code">订单编号：',e+=t.order_sn||"00000000000000000000",e+="</div></div> </div>")},t.prototype.event=function(t){var e=this;e.$pay.on("tap",function(){e._pay()})},t.prototype._pay=function(){var t=this;async.waterfall([function(e){t.ajax_pay(e)}],function(t,e){return t?$.api.toast("出现错误"):void $.api.toast("支付成功")})},t.prototype.ajax_pay=function(t){var e=this;$.ajax({url:"mall/pay/point",data:{order_id:e.id,pay_type:e.pay_type}}).then(t)},$.coinPay=function(){return new t}}(),function(){var t=function(){this.id=api.pageParam.id,this.$radio=$('input[type="radio"]'),this.$info=$('[data-selector="info"]'),this.$pay=$('[data-selector="pay"]'),this.pay_type=1,this.aliPay=api.require("aliPay")};return t.prototype.init=function(){this.main()},t.prototype.main=function(){var t=this;alert(JSON.stringify(t.id)),async.waterfall([function(e){t.ajax(e)},function(e,i){t.appendHtml(e,i)},function(e,i){t.event(i)}],function(t,e){if($.echo(),t)return $.api.toast(t)})},t.prototype.ajax=function(t){var e=this;$.ajax({url:"mall/order/confirm",data:{order_id:e.id}}).then(t)},t.prototype.appendHtml=function(t,e){var i=this;e(null,i.$info.html(i.html(t)))},t.prototype.html=function(t){var e="";return"object"!=typeof t?e:(e+='<div class="head" data-echo-background="',e+=t.logo,e+='"></div><div class="info"><div class="info-in"><div class="money">应付款：<span>¥',e+=t.offer_money||"出现错误",e+='</span></div><div class="code">订单编号：',e+=t.order_sn||"00000000000000000000",e+="</div></div> </div>")},t.prototype.event=function(t){var e=this;e.$radio.on("change",function(){var t=$(this);e.pay_type=parseInt(t.val()),$(".radio").removeClass("active"),t.parent().addClass("active")}),e.$pay.on("tap",function(){e._pay()}),t()},t.prototype._pay=function(){var t=this;async.waterfall([function(e){t.ajax_pay(e)},function(e,i){switch(t.pay_type){case 1:t.aliPayOrder(e,i);break;default:i("暂未实现")}}],function(t,e){return t?$.api.toast(t):void alert(JSON.stringify(e))})},t.prototype.ajax_pay=function(t){var e=this;$.ajax({url:"mall/pay/start",data:{order_id:e.id,pay_type:e.pay_type}}).then(t)},t.prototype.aliPayOrder=function(t,e){var i=this;i.aliPay.payOrder({orderInfo:t},function(t,i){e(i,t)})},$.pay=function(){return new t}}(),~function(){var t=function(){this.resource="http://api.mlb.kfw001.com/city.json",this.UICityList=api.require("UICityList"),this.currentCity=JSON.parse(localStorage.city)};return t.prototype.init=function(){var t=this;t.main()},t.prototype.main=function(){var t=this;t.UICityList.open({rect:{x:0,y:45+$.api.statusSize()},resource:t.resource,styles:{searchBar:{bgColor:"#696969",cancelColor:"#E3E3E3"},location:{color:"#696969",size:12},sectionTitle:{bgColor:"#eee",color:"#000",size:12},item:{bgColor:"#fff",activeBgColor:"#696969",color:"#000",size:14,height:40},indicator:{bgColor:"#fff",color:"#696969"}},currentCity:"object"==typeof t.currentCity?t.currentCity.city.city:"未知",locationWay:"当前位置",hotTitle:"热门城市",placeholder:"输入城市名或首字母查询"},function(t,e){})},$.cityLists=function(){return new t}}(),~function(){var t=function(){this.$data=api.pageParam,this.$FNImageClip=api.require("FNImageClip"),this.$imageUrl="common/upload/image",this.$url="member/info/modify",this.$submit=$('[data-selector="submit"]')};return t.prototype.init=function(){var t=this;t._main()},t.prototype._main=function(){var t=this;t._open(),t._event()},t.prototype._open=function(){var t=this;t.$FNImageClip.open({rect:{x:0,y:65,w:api.winWidth,h:api.winHeight},srcPath:t.$data.src,style:{mask:"rgba(0,0,0,.5)",clip:{w:300,x:(api.winWidth-300)/2,y:(api.winHeight-300)/2,appearance:"circular",borderColor:"#ffffff",borderWidth:1}},mode:"image"})},t.prototype._event=function(){var t=this;t.$submit.on("tap",function(){t._upload()})},t.prototype._upload=function(){var t=this;async.waterfall([function(e){t._save(e)},function(e,i){t._upload_image(e,i)},function(e,i){t._ajax(e,i)}],function(e){return e?$.api.toast(JSON.stringify(e.msg||e)):void t._send()})},t.prototype._send=function(){$.api.sendEvent("-event-refresh-set-user",{}),alert("上传成功"),setTimeout(function(){$.app.closeWin()},500)},t.prototype._save=function(t){var e=this;e.$FNImageClip.save({destPath:"fs://meileba/imageClip/avatar.jpg",quality:1},function(e,i){t(i,e)})},t.prototype._upload_image=function(t,e){var i=this;return t.destPath&&"undefined"!=typeof t.destPath?void $.ajax({url:i.$imageUrl,files:{image:t.destPath}}).then(e):e("文件保存失败")},t.prototype._ajax=function(t,e){var i=this;e=$.callback(e),$.ajax({url:i.$url,data:{avatar:t[0].path}}).then(e)},$.setAvatar=function(){return new t}}(),~function(){var t=function(){this.$login=JSON.parse(localStorage.token),this.$text=$('[data-selector="text"]')};return t.prototype.init=function(){var t=this;t._main()},t.prototype._main=function(){var t=this;t.$login.login?t._login():t._logout()},t.prototype._login=function(){var t=this;t.$text.text("登出").on("tap",function(){t._out()})},t.prototype._out=function(){alert("登出")},t.prototype._logout=function(){var t=this;t.$text.text("登录").on("tap",function(){$.app["switch"]("openNewWin",{name:"win_user_login"})})},$.setIndex=function(){return new t}}(),~function(){var t=function(){this.$submit=$('[data-selector="submit"]'),this.$nick=$('[data-selector="nick"]'),this.TOAST=$.toast(),this.$url="member/info/modify"};return t.prototype.init=function(){var t=this;t._main()},t.prototype._main=function(){var t=this;t._event()},t.prototype._event=function(){var t=this;t.$submit.on("tap",function(){t._one()})},t.prototype._one=function(){var t=this;t.TOAST.load().show(),async.waterfall([function(e){t._ajax(e)}],function(e,i){return t.TOAST.load().hide(),e?$.api.toast(e.msg||e):(t._send(),void t.TOAST.success())})},t.prototype._send=function(){$.api.sendEvent("-event-refresh-set-user",{})},t.prototype._ajax=function(t){var e=this,i=e.$nick.val();return t=$.callback(t),i?void $.ajax({url:e.$url,data:{nick:i}}).then(t):t("昵称未填写")},$.setNick=function(){return new t}}(),~function(){var t=function(){this.$sex=$('[data-selector="sex"]'),this.TOAST=$.toast(),this.$url="member/info/modify"};return t.prototype.init=function(){var t=this;
t._main()},t.prototype._main=function(){var t=this;t._event()},t.prototype._event=function(){var t=this;t.$sex.on("tap",function(){var e=$(this),i=e.data("sex");t._one(i)})},t.prototype._one=function(t){var e=this;e.TOAST.load().show(),async.waterfall([function(i){e._ajax(t,i)}],function(t,i){return e.TOAST.load().hide(),t?$.api.toast(JSON.stringify(t.msg||t)):(e._send(),void e.TOAST.success())})},t.prototype._send=function(){$.api.sendEvent("-event-refresh-set-user",{})},t.prototype._ajax=function(t,e){var i=this;e=$.callback(e),$.ajax({url:i.$url,data:{sex:t}}).then(e)},$.setSex=function(){return new t}}(),~function(){var t=function(){this.$old=$('[data-selector="old-tel"]'),this.$tel=$('[data-selector="tel"]'),this.$code=$('[data-selector="code"]'),this.$submit=$('[data-selector="submit"]'),this.SMS=$.smsCode(),this.TOAST=$.toast(),this.$url="member/info/tel"};return t.prototype.init=function(){this._main()},t.prototype._main=function(){var t=this;t._event()},t.prototype._event=function(){var t=this;t.$submit.on("tap",function(){t._one()})},t.prototype._one=function(){var t=this;t.TOAST.load().show(),async.waterfall([function(e){t._ajax(e)}],function(e){return t.TOAST.load().hide(),e?$.api.toast(e.msg||e):(t._send(),void t.TOAST.success())})},t.prototype._send=function(){$.api.sendEvent("-event-refresh-set-user",{})},t.prototype._ajax=function(t){var e=this,i={old_tel:e.$old.val(),tel:e.$tel.val(),code:e.$code.val()};return 11==i.old_tel.length&&11==i.tel.length&&i.code?void $.ajax({url:e.$url,data:i}).then(t):t("请仔细填写")},$.setTel=function(){return new t}}(),~function(){var t=function(){this.$url="member/info/user",this.$avatar=$('[data-selector="avatar"]'),this.$nick=$('[data-selector="nick"]'),this.$sex=$('[data-selector="sex"]'),this.$tel=$('[data-selector="tel"]'),this.$birth=$('[data-selector="birth"]'),this.$actionSheet={}};return t.prototype.init=function(){this._main(),this._refresh()},t.prototype._main=function(){var t=this;async.waterfall([function(e){t._ajax(e)},function(e,i){t._set_html(e,i)}],function(e,i){e||t._event()})},t.prototype._event=function(){var t=this;t.$avatar.off("tap").on("tap",function(){t._action_sheet()})},t.prototype._set_html=function(t,e){var i=this;e=$.callback(e),t.avatar?i.$avatar.find(".content").css("background-image",'url("'+t.avatar+'")'):null,t.nick?i.$nick.find(".content").text(t.nick):null,i.$sex.find(".content").text(parseInt(t.sex)?1==parseInt(t.sex)?"男":"女":"保密"),t.tel?i.$tel.find(".content").text(t.tel):null,t.birth?i.$birth.find(".content").text(t.birth):null,e(null,t)},t.prototype._refresh=function(){var t=this;$.api.listenerEvent("-event-refresh-set-user",function(){t._main()})},t.prototype._ajax=function(t){t=$.callback(t);var e=this;$.ajax({url:e.$url}).then(t)},t.prototype._action_sheet=function(){var t=this;t.$actionSheet=$.actionSheet({title:"更改头像",item:[{icon:"icon-picture",name:"图片库",value:"library"},{icon:"icon-camera",name:"相机",value:"camera"}]},function(e){e&&t._get_img(e)}).show()},t.prototype._get_img=function(t){api.getPicture({sourceType:t.value||"camera",encodingType:"jpg",mediaValue:"pic",destinationType:"url",allowEdit:!1,quality:100,saveToPhotoAlbum:!0},function(t,e){return t&&t.data&&!e?void $.app["switch"]("openNewWin",{name:"win_set_avatar",param:{src:t.data}}):$.api.toast(e||"出现错误")})},$.setUser=function(){return new t}}(),~function(){var t=function(){this.$url="mall/shop/goods",this.$data=api.pageParam,this.pullRefresh=$.pullRefresh(),this.SCROLL=$.scroll(),this.page=1,this.size=10,this.$html=$('[data-selector="html-content"]'),this.$loadMore=$("._load-more")};return t.prototype.init=function(){this._main(),this._refresh()},t.prototype._refresh=function(){var t=this;t.pullRefresh.set(function(){t._main()})},t.prototype._main=function(){var t=this;t.page=1,t._one()},t.prototype._one=function(){var t=this;t.SCROLL.removeListenerToBottom(),t.pullRefresh.close(),async.waterfall([function(e){t._ajax(e)},function(e,i){t._append_html(e,i)},function(e,i){t._iScroll(e,i)}],function(e,i){return $.echo(),e?$.api.toast(e):void(t.page+=1)})},t.prototype._append_html=function(t,e){var i=this;e=$.callback(e),i.$html[i.page<=1?"html":"append"](i._html(t)),e(null,t)},t.prototype._html=function(t){var e=this,i="";return t=t.info?t.info:[],t.forEach(function(t){i+='<div class="service-item" data-event="openNewWin" data-params=\'{"name":"',i+=1==t.type?"win_cargo_goods":2==t.type?"win_cargo_item":"",i+='","param":{"id":"',i+=t.id,i+='","shop_id":"',i+=e.$data.id,i+='"}}\'><div class="thumb" data-echo-background="',i+=t.thumb||"",i+='"></div><div class="title">',i+=t.title||"",i+='</div><div class="price">¥<span>',i+=t.offer_money,i+='</span></div><div class="number">月销量  ',i+=t.sales,i+="</div></div>"}),i},t.prototype._iScroll=function(t,e){var i=this;return e=$.callback(e),!t.count||t.count<i.size?(i.$loadMore.text("后面没有了"),e()):(i.$loadMore.text("努力加载中"),i.SCROLL.addListenerToBottom(function(){i._one()}),void e())},t.prototype._ajax=function(t){var e=this;t=$.callback(t),$.ajax({url:e.$url,data:{shop_id:e.$data.id,page:e.page,size:e.size}}).then(t)},$.storeBeauty=function(){return new t}}(),~function(){var t=function(){this.$url="mall/shop/activity",this.$data=api.pageParam,this.pullRefresh=$.pullRefresh(),this.SCROLL=$.scroll(),this.page=1,this.size=10,this.$html=$('[data-selector="html-content"]'),this.$loadMore=$("._load-more")};return t.prototype.init=function(){this._main(),this._refresh()},t.prototype._refresh=function(){var t=this;t.pullRefresh.set(function(){t._main()})},t.prototype._main=function(){var t=this;t.page=1,t._one()},t.prototype._one=function(){var t=this;t.SCROLL.removeListenerToBottom(),t.pullRefresh.close(),async.waterfall([function(e){t._ajax(e)},function(e,i){t._append_html(e,i)},function(e,i){t._iScroll(e,i)}],function(e,i){return $.echo(),e?$.api.toast(e):void(t.page+=1)})},t.prototype._append_html=function(t,e){var i=this;e=$.callback(e),i.$html[i.page<=1?"html":"append"](i._html(t)),e(null,t)},t.prototype._html=function(t){var e="";return t=t.info?t.info:[],t.forEach(function(t){e+='<div class="benefit-item"><div class="title">',e+=t.title||"",e+='</div><div class="thumb" data-echo-background="',e+=t.thumb||"",e+='"></div><div class="desc">',e+=t.description||"",e+='</div><div class="read">查看全部</div></div>'}),e},t.prototype._iScroll=function(t,e){var i=this;return e=$.callback(e),!t.count||t.count<i.size?(i.$loadMore.text("后面没有了"),e()):(i.$loadMore.text("努力加载中"),i.SCROLL.addListenerToBottom(function(){i._one()}),void e())},t.prototype._ajax=function(t){var e=this;t=$.callback(t),$.ajax({url:e.$url,data:{shop_id:e.$data.id,page:e.page,size:e.size}}).then(t)},$.storeBenefit=function(){return new t}}(),~function(){var t=function(){this.$data=api.pageParam,this.$title=$('[data-selector="title"]'),this.$cover=$('[data-selector="cover"]'),this.$nav=$('[data-selector="nav-item"]')};return t.__proto__.$url="mall/shop/index",t.prototype.init=function(){var t=this;t._main()},t.prototype._main=function(){var t=this;async.waterfall([function(e){t._ajax(e)},function(e,i){t._set_store_cover(e,i)}],function(e,i){e||(t._open_store_group(i),t._event())})},t.prototype._set_store_cover=function(t,e){var i=this;return e=$.callback(e),t.info&&"object"==typeof t.info?(i.$title.text(t.info.name||"绝世好店"),t.info.thumbs.length&&t.info.thumbs[0].path?(i.$cover.css("background-image",'url("'+t.info.thumbs[0].path+'")'),e(null,t)):e(null,t)):e(null,t)},t.prototype._ajax=function(e){var i=this;e=$.callback(e),$.ajax({url:t.$url,data:{shop_id:i.$data.id||0}}).then(e)},t.prototype._open_store_group=function(t){var e=this;t=$.extend({},t,e.$data),api.openFrameGroup({name:"-group-store-home",background:"#ededed",scrollEnabled:!0,rect:{x:0,y:203,w:"auto",h:"auto"},index:0,frames:[{name:"-frame-store-index",url:"widget://html/store/store-index.html",bgColor:"#ededed",pageParam:t,vScrollBarEnabled:!1,hScrollBarEnabled:!1,bounces:!1},{name:"-frame-store-beauty",url:"widget://html/store/store-beauty.html",bgColor:"#ededed",pageParam:e.$data,vScrollBarEnabled:!1,hScrollBarEnabled:!1,customRefreshHeader:"UIPullRefresh"},{name:"-frame-store-benefit",url:"widget://html/store/store-benefit.html",bgColor:"#ededed",pageParam:e.$data,vScrollBarEnabled:!1,hScrollBarEnabled:!1,customRefreshHeader:"UIPullRefresh"},{name:"-frame-store-index",url:"widget://html/store/store-introduction.html",bgColor:"#ededed",pageParam:e.$data,vScrollBarEnabled:!1,hScrollBarEnabled:!1,bounces:!1}]},function(t,i){return!i&&void e._switch_nav(t.index||0)})},t.prototype._switch_nav=function(t){var e=this;e.$nav.removeClass("active").eq(t).addClass("active")},t.prototype._event=function(){var t=this;t.$nav.on("tap",function(){var t=$(this).index();$.api.switchPageIndex("-group-store-home",t,!0)}),$.api.listenerEvent("-event-store-scroll",function(t){})},$.storeHome=function(){return new t}}(),~function(){var t=function(){this.$data=api.pageParam,this.adsHtml="",this.$htmlContent=$('[data-selector="html-content"]')};return t.__proto__.$ads_url="",t.prototype.init=function(){var t=this;t._main()},t.prototype._main=function(){var t=this;async.waterfall([function(e){t._ads(e)},function(e){t._one(e)}],function(t,e){$.echo()})},t.prototype._one=function(t){var e=this;t=$.callback(t),e.$htmlContent.html(e._html()),t()},t.prototype._html=function(){var t=this,e="";return e+=t._goods_html(),e+=t._item_html()},t.prototype._item_html=function(){var t=this,e="";return"object"==typeof t.$data.item&&t.$data.item&&t.$data.item.length?(e+='<div class="exhibit">',e+=t.adsHtml,e+='<div class="exhibit-group">',t.$data.item.forEach(function(t){return!!t.thumb&&(e+='<div class="exhibit-item"><div class="img" data-echo-background="',e+=t.thumb,void(e+='"></div></div>'))}),e+="</div>",e+='<div class="exhibit-title"><p>店内最受女性欢迎的镇店王牌项目！</p><p class="more icon-gt">更多</p></div>',e+="</div>"):e},t.prototype._goods_html=function(){var t=this,e="";return"object"==typeof t.$data.goods&&t.$data.goods&&t.$data.goods.length?(e+='<div class="exhibit">',e+='<div class="ads" data-event="openNewWin" data-params=\'{"name":"win_cargo_goods","param":{"id":"',e+=t.$data.goods[0].id,e+='","shop_id":"',e+=t.$data.id,e+='"}}\' data-selector="shop-ads" data-echo-background="',e+=t.$data.goods[0].thumb,e+='"><div class="hot shop"></div></div>',e+='<div class="exhibit-group">',t.$data.goods.forEach(function(i,o){return 0!=o&&(!!i.thumb&&(e+='<div class="exhibit-item" data-event="openNewWin" data-params=\'{"name":"win_cargo_goods","param":{"id":"',e+=i.id,e+='","shop_id":"',e+=t.$data.id,e+='"}}\'><div class="img" data-echo-background="',e+=i.thumb,void(e+='"></div></div>')))}),e+="</div>",e+='<div class="exhibit-title"><p>2016年最受欢迎项目，即抢即划算 ！</p><p class="more icon-gt">更多</p></div>',e+="</div>"):e},t.prototype._ads=function(t){var e=this;t=$.callback(t),async.waterfall([function(t){e._ajax_ads(t)},function(t,i){e._set_ads_html(t,i)}],function(e,i){return t()})},t.prototype._ajax_ads=function(t){return(t=$.callback(t))(null,{})},t.prototype._set_ads_html=function(t,e){var i=this,o="";o+='<div class="ads" data-echo-background="',o+="../../images/shopInfo-index-banner1.jpg",o+='"><div class="hot meileba"></div></div>',i.adsHtml=o,e()},$.storeIndex=function(){return new t}}(),~function(){var t=function(){this.$data=api.pageParam,this.$url="mall/shop/detail",this.$html=$('[data-selector="html-content"]')};return t.prototype.init=function(){var t=this;t._main()},t.prototype._main=function(){var t=this;async.waterfall([function(e){t._ajax(e)},function(e,i){t._append_html(e,i)}],function(t,e){$.echo(),t&&$.api.toast(t)})},t.prototype._append_html=function(t,e){var i=this,o="";o+=i._info_html(t),o+=i._staff_html(t),o+=i._brand_html(t),e(null,i.$html.html(o))},t.prototype._info_html=function(t){var e="";return t.shop?(e+='<div class="main-item"><div class="title">联系我们 </div><div class="info">',t.shop.phone&&(e+="<p><span>客服电话：",e+=t.shop.phone,e+='</span><span data-event="call" data-params=\'{"tel" :"',e+=t.shop.phone,e+="\"}'>立即拨打&gt;&gt;</span></p>"),t.shop.address&&(e+="<p><span>详细地址：",e+=t.shop.address,e+='</span><span data-event="openNewWin" data-params=\'{"name":"win_map","param":{"lon":"',e+=t.shop.longitude,e+='","lat":"',e+=t.shop.latitude,e+="\"}}'>导航前往&gt;&gt;</span></p>"),e+="</div></div>",t.shop.info?e:(e+='<div class="main-item"><div class="title">商家介绍 </div><div class="content">',e+=t.shop.info,e+="</div></div>")):e},t.prototype._staff_html=function(t){var e="";return t.staff&&t.staff.length?(e+=' <div class="main-item"><div class="title">美容师 </div><div class="content">',t.staff.forEach(function(t,i){return!(i>=3)&&(e+=' <div class="content-item"><div class="content-item-in" data-echo-background="',e+=t.thumb,void(e+='"></div></div>'))}),e+="</div></div>"):e},t.prototype._brand_html=function(t){var e="";return t.brand&&t.brand.length?(e+=' <div class="main-item"><div class="title">品牌推荐 </div><div class="content">',t.brand.forEach(function(t,i){return!(i>=3)&&(e+=' <div class="content-item"><div class="content-item-in" data-echo-background="',e+=t.thumb,void(e+='"></div></div>'))}),e+="</div></div>"):e},t.prototype._ajax=function(t){var e=this;$.ajax({url:e.$url,data:{shop_id:e.$data.id}}).then(t)},$.storeIntroduction=function(){return new t}}(),~function(){var t=function(){this.userLocation=JSON.parse(localStorage.userLocation),this.page=1,this.size=10,this.zoneId="undefined",this.$storeLists=$('[data-selector="store-lists"]'),this.$loadMore=$("._load-more"),this.SCROLL=$.scroll(),this.pullRefresh=$.pullRefresh(),this.TOAST=$.toast()};return t.prototype.init=function(){var t=this;t._refresh(),t._main()},t.prototype._refresh=function(){var t=this;t.pullRefresh.set(function(){t._main()})},t.prototype._main=function(){var t=this;t.page=1,t._one()},t.prototype._one=function(){var t=this;t.pullRefresh.close(),t.SCROLL.removeListenerToBottom(),async.waterfall([function(e){t.ajax(e)},function(e,i){t._append(e,i)},function(e,i){t._iScroll(e,i)}],function(e,i){return $.echo(),t._end(),!e&&void(t.page+=1)})},t.prototype._append=function(t,e){var i=this;i.$storeLists[1==i.page?"html":"append"](i._store_lists_html(t)),e(null,t)},t.prototype._iScroll=function(t,e){var i=this;return e=$.callback(e),!t.info.length||t.info.length<i.size?(i.$loadMore.text("后面没有了"),e()):(i.$loadMore.text("努力加载中"),i.SCROLL.addListenerToBottom(function(){i._one()}),void e())},t.prototype._store_lists_html=function(t){var e="";return"object"!=typeof t||t.count<=0?e:(t.info.forEach(function(t){e+='<div class="list-item" data-event="openNewWin" data-params=\'{"name":"win_store_home","param":{"id":"',e+=t.id,e+='"}}\'><div class="list-item-left" data-echo-background="',e+=t.logo,e+='"></div><div class="list-item-right"><div class="list-item-title"><p>',e+=t.name,e+='</p></div><div class="list-item-info">',e+=t.description,e+='</div><div class="list-item-addr"><div class="addr-left">【地址】',e+=t.address,e+='</div><div class="addr-right"><i class="icon-place"></i><span>&lt;',e+=t.distance<1?Math.floor(1e3*t.distance)+"m":Math.floor(t.distance)+"km",e+='</span></div></div><div class="list-item-review">',[1,2,3,4,5].forEach(function(i){return e+=i<=t.star?'<i class="icon-star active"></i>':'<i class="icon-star"></i>'}),e+="<span>"+t.bbs_count+"人评价</span>",e+="</div></div></div>"}),e)},t.prototype._store_lists_end=function(t,e){var i=this;return $.echo(),"object"!=typeof t||t.count<10?e(i.$loadMore.text("到底啦")):(i.page+=1,void e())},t.prototype.ajax=function(t){var e=this;t=$.callback(t),$.ajax({url:"mall/shop/list",data:{longitude:e.userLocation.lon,latitude:e.userLocation.lat,city_id:e.userLocation.city.id,zone_id:"undefined"==e.zoneId?"":e.zoneId,page:e.page,size:e.size}}).then(t)},t.prototype._end=function(){var t=this;setTimeout(function(){t.TOAST.load().Progress()},500)},$.storeLists=function(){return new t}}(),~function(){var t=function(){this.$login=$('[data-selector="login"]'),this.$logout=$('[data-selector="logout"]'),this.$avatar=$('[data-selector="avatar"]'),this.$signature=$('[data-selector="signature"]'),this.$nick=$('[data-selector="nick"]')};return t.prototype.init=function(){this._main(),this._listener_log()},t.prototype._main=function(){var t=this;t._user_info()},t.prototype._user_info=function(){var t=this;async.waterfall([function(e){t._ajax(e)},function(e,i){t._set_user_info(e,i)}],function(e){return $.api.toast(e),e?(t.$login.hide(),t.$logout.show()):(t.$login.show(),void t.$logout.hide())})},t.prototype._ajax=function(t){$.ajax({url:"member/info/user"}).then(t)},t.prototype._set_user_info=function(t,e){var i=this;i.$nick.html(t.nick||"佚名"),i.$signature.html(t.signature||"HI ，欢迎来美乐吧做客！"),i.$avatar.css({"background-image":'url("'+(t.avatar?t.avatar:"../images/icon.png")+'")'}),e(null,t)},t.prototype._listener_log=function(){var t=this;$.logEvent().listenerLogin().then(function(){t._user_info()}),$.logEvent().listenerLogin().then(function(){t._user_info()})},$.homeUser=function(){return new t}}(),~function(){var t=function(){this.tel=$('[data-selector="tel"]')};t.prototype.sendSMSCode=function(t,e,i){var o=this,n=o.tel.val(),a=60,s=null;return n?void $.ajax({url:"common/code/sms",data:{tel:n,tip:e.tip},success:function(){$.api.toast("短信发送成功，请注意查收"),i.data("event","").addClass("active"),s=setInterval(function(){return a-=1,a<=0?(clearInterval(s),i.removeClass("active").html("点击发送"),!1):void i.html(a+"秒后重新发送")},1e3)},error:function(t){$.api.toast("短信发送失败："+t)}}):$.api.toast("手机号填写不正确")},$.userCommon=function(){return new t}}(),~function(){var t=function(){this.$url="member/login/login",this.$tel=$('[data-selector="tel"]'),this.$pwd=$('[data-selector="pwd"]'),this.$submit=$('[data-selector="submit"]'),this.$logEvent=$.logEvent()};return t.prototype.init=function(){alert("login"),this._event()},t.prototype._event=function(){var t=this;t.$submit.on("tap",function(){t._login()})},t.prototype._login=function(){var t=this;async.waterfall([function(e){t._ajax(e)}],function(e,i){return e?$.api.toast(e):void t.$logEvent.sendLogout(i)})},t.prototype._ajax=function(t){var e=this;t=$.callback(t);var i={tel:e.$tel.val(),password:e.$pwd.val()};return 11==i.tel.length&&i.password?void $.ajax({url:e.$url,data:i}).then(t):t("用户名或者密码不正确")},$.userLogin=function(){return new t}}(),~function(){var t=function(){this.$url="member/info/password",this.$codeUrl="common/code/tel",this.$code=$('[data-selector="code"]'),this.$pwd=$('[data-selector="pwd"]'),this.$submit=$('[data-selector="submit"]'),this.SMS=$.smsCode(),this.TOAST=$.toast()};return t.prototype.init=function(){this._main()},t.prototype._main=function(){var t=this;t.SMS.$url=t.$codeUrl,t._event()},t.prototype._event=function(){var t=this;t.$submit.on("tap",function(){t._one()})},t.prototype._one=function(){var t=this;t.TOAST.load().show(),async.waterfall([function(e){t._ajax(e)}],function(e){return t.TOAST.load().hide(),e?$.api.toast(JSON.stringify(e.msg||e)):void t.TOAST.success()})},t.prototype._ajax=function(t){var e=this,i={code:e.$code.val(),password:e.$pwd.val(),repassword:e.$pwd.val()};return t=$.callback(t),6==i.code.length&&i.password?void $.ajax({url:e.$url,data:i}).then(t):t("填写不完整")},$.userPassWord=function(){return new t}}(),~function(){var t=function(){this.width=api.winWidth,this.type=api.pageParam.type,this.time=4,this.$url="ads/ads/begin",this.$welcome=$('[data-selector="welcome"]'),this.$advertising=$('[data-selector="advertising"]'),this.$btn=$('[data-selector="btn"]'),this.$cover=$('[data-selector="cover"]'),this.$bg=$('[data-selector="bg"]')};return t.prototype.init=function(){var t=this;return t._event(),t.type?t._welcome_page():void t._advertising_page()},t.prototype._event=function(){var t=this;api.addEventListener({name:"keyback"},function(t,e){}),t.$btn.on("click",function(){if(t._close(),t.type)return localStorage.welcome="1"})},t.prototype._welcome_page=function(){var t=this;t.$welcome.addClass("show"),t._swipe(),setTimeout(function(){$.app.removeLaunch()},250)},t.prototype._advertising_page=function(){var t=this;t.$cover.height(265*t.width/1080),async.waterfall([function(e){t.ajax(e)},function(e,i){t._img_load(e,i)}],function(e,i){t.$advertising.addClass("show"),t._time_loop(),setTimeout(function(){$.app.removeLaunch()},250)})},t.prototype._time_loop=function(){var t=this;return t.time<=0?t._close():(t.time-=1,t.$btn.text(t.time),void setTimeout(function(){t._time_loop()},1e3))},t.prototype._swipe=function(){var t=new Swipe($(".js-slider")[0],{startSlide:0,speed:250,auto:0,continuous:!1,disableScroll:!0,stopPropagation:!0});return t},t.prototype._close=function(){api.closeWin({animation:{type:"fade",subType:"from_right",duration:500}}),api.setFullScreen({fullScreen:!1}),api.setStatusBarStyle({style:"light"}),$.api.sendEvent("removeLaunch",{})},t.prototype._img_load=function(t,e){var i=this,e=$.callback(e),o=new Image;return"undefined"==typeof t.thumb?e():(o.src=t.thumb,o.onload=function(){i.$bg.css("background-image",'url("'+o.src+'")'),e()},void(o.onerror=function(){e()}))},t.prototype.ajax=function(t){var e=this,t=$.callback(t);$.ajax({url:e.$url}).then(t)},$.welcome=function(){return new t}}();